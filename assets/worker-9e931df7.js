var Oh=Object.defineProperty;var Fh=(te,At,fe)=>At in te?Oh(te,At,{enumerable:!0,configurable:!0,writable:!0,value:fe}):te[At]=fe;var it=(te,At,fe)=>(Fh(te,typeof At!="symbol"?At+"":At,fe),fe);(function(){"use strict";var te=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},At={},fe={get exports(){return At},set exports(r){At=r}};(function(r){(function(t,e){r.exports?r.exports=e():t.nearley=e()})(te,function(){function t(h,u,c){return this.id=++t.highestId,this.name=h,this.symbols=u,this.postprocess=c,this}t.highestId=0,t.prototype.toString=function(h){var u=typeof h>"u"?this.symbols.map(l).join(" "):this.symbols.slice(0,h).map(l).join(" ")+" ● "+this.symbols.slice(h).map(l).join(" ");return this.name+" → "+u};function e(h,u,c,p){this.rule=h,this.dot=u,this.reference=c,this.data=[],this.wantedBy=p,this.isComplete=this.dot===h.symbols.length}e.prototype.toString=function(){return"{"+this.rule.toString(this.dot)+"}, from: "+(this.reference||0)},e.prototype.nextState=function(h){var u=new e(this.rule,this.dot+1,this.reference,this.wantedBy);return u.left=this,u.right=h,u.isComplete&&(u.data=u.build(),u.right=void 0),u},e.prototype.build=function(){var h=[],u=this;do h.push(u.right.data),u=u.left;while(u.left);return h.reverse(),h},e.prototype.finish=function(){this.rule.postprocess&&(this.data=this.rule.postprocess(this.data,this.reference,o.fail))};function s(h,u){this.grammar=h,this.index=u,this.states=[],this.wants={},this.scannable=[],this.completed={}}s.prototype.process=function(h){for(var u=this.states,c=this.wants,p=this.completed,f=0;f<u.length;f++){var d=u[f];if(d.isComplete){if(d.finish(),d.data!==o.fail){for(var m=d.wantedBy,y=m.length;y--;){var b=m[y];this.complete(b,d)}if(d.reference===this.index){var M=d.rule.name;(this.completed[M]=this.completed[M]||[]).push(d)}}}else{var M=d.rule.symbols[d.dot];if(typeof M!="string"){this.scannable.push(d);continue}if(c[M]){if(c[M].push(d),p.hasOwnProperty(M))for(var w=p[M],y=0;y<w.length;y++){var v=w[y];this.complete(d,v)}}else c[M]=[d],this.predict(M)}}},s.prototype.predict=function(h){for(var u=this.grammar.byName[h]||[],c=0;c<u.length;c++){var p=u[c],f=this.wants[h],d=new e(p,0,this.index,f);this.states.push(d)}},s.prototype.complete=function(h,u){var c=h.nextState(u);this.states.push(c)};function i(h,u){this.rules=h,this.start=u||this.rules[0].name;var c=this.byName={};this.rules.forEach(function(p){c.hasOwnProperty(p.name)||(c[p.name]=[]),c[p.name].push(p)})}i.fromCompiled=function(p,u){var c=p.Lexer;p.ParserStart&&(u=p.ParserStart,p=p.ParserRules);var p=p.map(function(d){return new t(d.name,d.symbols,d.postprocess)}),f=new i(p,u);return f.lexer=c,f};function n(){this.reset("")}n.prototype.reset=function(h,u){this.buffer=h,this.index=0,this.line=u?u.line:1,this.lastLineBreak=u?-u.col:0},n.prototype.next=function(){if(this.index<this.buffer.length){var h=this.buffer[this.index++];return h===`
`&&(this.line+=1,this.lastLineBreak=this.index),{value:h}}},n.prototype.save=function(){return{line:this.line,col:this.index-this.lastLineBreak}},n.prototype.formatError=function(h,u){var c=this.buffer;if(typeof c=="string"){var p=c.split(`
`).slice(Math.max(0,this.line-5),this.line),f=c.indexOf(`
`,this.index);f===-1&&(f=c.length);var d=this.index-this.lastLineBreak,m=String(this.line).length;return u+=" at line "+this.line+" col "+d+`:

`,u+=p.map(function(b,M){return y(this.line-p.length+M+1,m)+" "+b},this).join(`
`),u+=`
`+y("",m+d)+`^
`,u}else return u+" at index "+(this.index-1);function y(b,M){var w=String(b);return Array(M-w.length+1).join(" ")+w}};function o(h,u,c){if(h instanceof i)var p=h,c=u;else var p=i.fromCompiled(h,u);this.grammar=p,this.options={keepHistory:!1,lexer:p.lexer||new n};for(var f in c||{})this.options[f]=c[f];this.lexer=this.options.lexer,this.lexerState=void 0;var d=new s(p,0);this.table=[d],d.wants[p.start]=[],d.predict(p.start),d.process(),this.current=0}o.fail={},o.prototype.feed=function(h){var u=this.lexer;u.reset(h,this.lexerState);for(var c;;){try{if(c=u.next(),!c)break}catch(T){var m=new s(this.grammar,this.current+1);this.table.push(m);var p=new Error(this.reportLexerError(T));throw p.offset=this.current,p.token=T.token,p}var f=this.table[this.current];this.options.keepHistory||delete this.table[this.current-1];var d=this.current+1,m=new s(this.grammar,d);this.table.push(m);for(var y=c.text!==void 0?c.text:c.value,b=u.constructor===n?c.value:c,M=f.scannable,w=M.length;w--;){var v=M[w],z=v.rule.symbols[v.dot];if(z.test?z.test(b):z.type?z.type===c.type:z.literal===y){var F=v.nextState({data:b,token:c,isToken:!0,reference:d-1});m.states.push(F)}}if(m.process(),m.states.length===0){var p=new Error(this.reportError(c));throw p.offset=this.current,p.token=c,p}this.options.keepHistory&&(f.lexerState=u.save()),this.current++}return f&&(this.lexerState=u.save()),this.results=this.finish(),this},o.prototype.reportLexerError=function(h){var u,c,p=h.token;return p?(u="input "+JSON.stringify(p.text[0])+" (lexer error)",c=this.lexer.formatError(p,"Syntax error")):(u="input (lexer error)",c=h.message),this.reportErrorCommon(c,u)},o.prototype.reportError=function(h){var u=(h.type?h.type+" token: ":"")+JSON.stringify(h.value!==void 0?h.value:h),c=this.lexer.formatError(h,"Syntax error");return this.reportErrorCommon(c,u)},o.prototype.reportErrorCommon=function(h,u){var c=[];c.push(h);var p=this.table.length-2,f=this.table[p],d=f.states.filter(function(y){var b=y.rule.symbols[y.dot];return b&&typeof b!="string"});if(d.length===0)c.push("Unexpected "+u+`. I did not expect any more input. Here is the state of my parse table:
`),this.displayStateStack(f.states,c);else{c.push("Unexpected "+u+`. Instead, I was expecting to see one of the following:
`);var m=d.map(function(y){return this.buildFirstStateStack(y,[])||[y]},this);m.forEach(function(y){var b=y[0],M=b.rule.symbols[b.dot],w=this.getSymbolDisplay(M);c.push("A "+w+" based on:"),this.displayStateStack(y,c)},this)}return c.push(""),c.join(`
`)},o.prototype.displayStateStack=function(h,u){for(var c,p=0,f=0;f<h.length;f++){var d=h[f],m=d.rule.toString(d.dot);m===c?p++:(p>0&&u.push("    ^ "+p+" more lines identical to this"),p=0,u.push("    "+m)),c=m}},o.prototype.getSymbolDisplay=function(h){return a(h)},o.prototype.buildFirstStateStack=function(h,u){if(u.indexOf(h)!==-1)return null;if(h.wantedBy.length===0)return[h];var c=h.wantedBy[0],p=[h].concat(u),f=this.buildFirstStateStack(c,p);return f===null?null:[h].concat(f)},o.prototype.save=function(){var h=this.table[this.current];return h.lexerState=this.lexerState,h},o.prototype.restore=function(h){var u=h.index;this.current=u,this.table[u]=h,this.table.splice(u+1),this.lexerState=h.lexerState,this.results=this.finish()},o.prototype.rewind=function(h){if(!this.options.keepHistory)throw new Error("set option `keepHistory` to enable rewinding");this.restore(this.table[h])},o.prototype.finish=function(){var h=[],u=this.grammar.start,c=this.table[this.table.length-1];return c.states.forEach(function(p){p.rule.name===u&&p.dot===p.rule.symbols.length&&p.reference===0&&p.data!==o.fail&&h.push(p)}),h.map(function(p){return p.data})};function a(h){var u=typeof h;if(u==="string")return h;if(u==="object"){if(h.literal)return JSON.stringify(h.literal);if(h instanceof RegExp)return"character matching "+h;if(h.type)return h.type+" token";if(h.test)return"token matching "+String(h.test);throw new Error("Unknown symbol type: "+h)}}function l(h){var u=typeof h;if(u==="string")return h;if(u==="object"){if(h.literal)return JSON.stringify(h.literal);if(h instanceof RegExp)return h.toString();if(h.type)return"%"+h.type;if(h.test)return"<"+String(h.test)+">";throw new Error("Unknown symbol type: "+h)}}return{Parser:o,Grammar:i,Rule:t}})})(fe);var Ir=At,Ys={},Nr={get exports(){return Ys},set exports(r){Ys=r}};(function(r){(function(t,e){r.exports?r.exports=e():t.moo=e()})(te,function(){var t=Object.prototype.hasOwnProperty,e=Object.prototype.toString,s=typeof new RegExp().sticky=="boolean";function i(g){return g&&e.call(g)==="[object RegExp]"}function n(g){return g&&typeof g=="object"&&!i(g)&&!Array.isArray(g)}function o(g){return g.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function a(g){var S=new RegExp("|"+g);return S.exec("").length-1}function l(g){return"("+g+")"}function h(g){if(!g.length)return"(?!)";var S=g.map(function(A){return"(?:"+A+")"}).join("|");return"(?:"+S+")"}function u(g){if(typeof g=="string")return"(?:"+o(g)+")";if(i(g)){if(g.ignoreCase)throw new Error("RegExp /i flag not allowed");if(g.global)throw new Error("RegExp /g flag is implied");if(g.sticky)throw new Error("RegExp /y flag is implied");if(g.multiline)throw new Error("RegExp /m flag is implied");return g.source}else throw new Error("Not a pattern: "+g)}function c(g,S){return g.length>S?g:Array(S-g.length+1).join(" ")+g}function p(g,S){for(var A=g.length,B=0;;){var C=g.lastIndexOf(`
`,A-1);if(C===-1||(B++,A=C,B===S)||A===0)break}var k=B<S?0:A+1;return g.substring(k).split(`
`)}function f(g){for(var S=Object.getOwnPropertyNames(g),A=[],B=0;B<S.length;B++){var C=S[B],k=g[C],V=[].concat(k);if(C==="include"){for(var H=0;H<V.length;H++)A.push({include:V[H]});continue}var D=[];V.forEach(function(R){n(R)?(D.length&&A.push(m(C,D)),A.push(m(C,R)),D=[]):D.push(R)}),D.length&&A.push(m(C,D))}return A}function d(g){for(var S=[],A=0;A<g.length;A++){var B=g[A];if(B.include){for(var C=[].concat(B.include),k=0;k<C.length;k++)S.push({include:C[k]});continue}if(!B.type)throw new Error("Rule has no type: "+JSON.stringify(B));S.push(m(B.type,B))}return S}function m(g,S){if(n(S)||(S={match:S}),S.include)throw new Error("Matching rules cannot also include states");var A={defaultType:g,lineBreaks:!!S.error||!!S.fallback,pop:!1,next:null,push:null,error:!1,fallback:!1,value:null,type:null,shouldThrow:!1};for(var B in S)t.call(S,B)&&(A[B]=S[B]);if(typeof A.type=="string"&&g!==A.type)throw new Error("Type transform cannot be a string (type '"+A.type+"' for token '"+g+"')");var C=A.match;return A.match=Array.isArray(C)?C:C?[C]:[],A.match.sort(function(k,V){return i(k)&&i(V)?0:i(V)?-1:i(k)?1:V.length-k.length}),A}function y(g){return Array.isArray(g)?d(g):f(g)}var b=m("error",{lineBreaks:!0,shouldThrow:!0});function M(g,S){for(var A=null,B=Object.create(null),C=!0,k=null,V=[],H=[],D=0;D<g.length;D++)g[D].fallback&&(C=!1);for(var D=0;D<g.length;D++){var R=g[D];if(R.include)throw new Error("Inheritance is not allowed in stateless lexers");if(R.error||R.fallback){if(A)throw!R.fallback==!A.fallback?new Error("Multiple "+(R.fallback?"fallback":"error")+" rules not allowed (for token '"+R.defaultType+"')"):new Error("fallback and error are mutually exclusive (for token '"+R.defaultType+"')");A=R}var U=R.match.slice();if(C)for(;U.length&&typeof U[0]=="string"&&U[0].length===1;){var et=U.shift();B[et.charCodeAt(0)]=R}if(R.pop||R.push||R.next){if(!S)throw new Error("State-switching options are not allowed in stateless lexers (for token '"+R.defaultType+"')");if(R.fallback)throw new Error("State-switching options are not allowed on fallback tokens (for token '"+R.defaultType+"')")}if(U.length!==0){C=!1,V.push(R);for(var pt=0;pt<U.length;pt++){var Ot=U[pt];if(i(Ot)){if(k===null)k=Ot.unicode;else if(k!==Ot.unicode&&R.fallback===!1)throw new Error("If one rule is /u then all must be")}}var Ft=h(U.map(u)),mt=new RegExp(Ft);if(mt.test(""))throw new Error("RegExp matches empty string: "+mt);var ft=a(Ft);if(ft>0)throw new Error("RegExp has capture groups: "+mt+`
Use (?: … ) instead`);if(!R.lineBreaks&&mt.test(`
`))throw new Error("Rule should declare lineBreaks: "+mt);H.push(l(Ft))}}var Rt=A&&A.fallback,Se=s&&!Rt?"ym":"gm",yt=s||Rt?"":"|";k===!0&&(Se+="u");var It=new RegExp(h(H)+yt,Se);return{regexp:It,groups:V,fast:B,error:A||b}}function w(g){var S=M(y(g));return new T({start:S},"start")}function v(g,S,A){var B=g&&(g.push||g.next);if(B&&!A[B])throw new Error("Missing state '"+B+"' (in token '"+g.defaultType+"' of state '"+S+"')");if(g&&g.pop&&+g.pop!=1)throw new Error("pop must be 1 (in token '"+g.defaultType+"' of state '"+S+"')")}function z(g,S){var A=g.$all?y(g.$all):[];delete g.$all;var B=Object.getOwnPropertyNames(g);S||(S=B[0]);for(var C=Object.create(null),k=0;k<B.length;k++){var V=B[k];C[V]=y(g[V]).concat(A)}for(var k=0;k<B.length;k++)for(var V=B[k],H=C[V],D=Object.create(null),R=0;R<H.length;R++){var U=H[R];if(U.include){var et=[R,1];if(U.include!==V&&!D[U.include]){D[U.include]=!0;var pt=C[U.include];if(!pt)throw new Error("Cannot include nonexistent state '"+U.include+"' (in state '"+V+"')");for(var Ot=0;Ot<pt.length;Ot++){var Ft=pt[Ot];H.indexOf(Ft)===-1&&et.push(Ft)}}H.splice.apply(H,et),R--}}for(var mt=Object.create(null),k=0;k<B.length;k++){var V=B[k];mt[V]=M(C[V],!0)}for(var k=0;k<B.length;k++){for(var ft=B[k],Rt=mt[ft],Se=Rt.groups,R=0;R<Se.length;R++)v(Se[R],ft,mt);for(var yt=Object.getOwnPropertyNames(Rt.fast),R=0;R<yt.length;R++)v(Rt.fast[yt[R]],ft,mt)}return new T(mt,S)}function F(g){for(var S=typeof Map<"u",A=S?new Map:Object.create(null),B=Object.getOwnPropertyNames(g),C=0;C<B.length;C++){var k=B[C],V=g[k],H=Array.isArray(V)?V:[V];H.forEach(function(D){if(typeof D!="string")throw new Error("keyword must be string (in keyword '"+k+"')");S?A.set(D,k):A[D]=k})}return function(D){return S?A.get(D):A[D]}}var T=function(g,S){this.startState=S,this.states=g,this.buffer="",this.stack=[],this.reset()};T.prototype.reset=function(g,S){return this.buffer=g||"",this.index=0,this.line=S?S.line:1,this.col=S?S.col:1,this.queuedToken=S?S.queuedToken:null,this.queuedText=S?S.queuedText:"",this.queuedThrow=S?S.queuedThrow:null,this.setState(S?S.state:this.startState),this.stack=S&&S.stack?S.stack.slice():[],this},T.prototype.save=function(){return{line:this.line,col:this.col,state:this.state,stack:this.stack.slice(),queuedToken:this.queuedToken,queuedText:this.queuedText,queuedThrow:this.queuedThrow}},T.prototype.setState=function(g){if(!(!g||this.state===g)){this.state=g;var S=this.states[g];this.groups=S.groups,this.error=S.error,this.re=S.regexp,this.fast=S.fast}},T.prototype.popState=function(){this.setState(this.stack.pop())},T.prototype.pushState=function(g){this.stack.push(this.state),this.setState(g)};var $=s?function(g,S){return g.exec(S)}:function(g,S){var A=g.exec(S);return A[0].length===0?null:A};T.prototype._getGroup=function(g){for(var S=this.groups.length,A=0;A<S;A++)if(g[A+1]!==void 0)return this.groups[A];throw new Error("Cannot find token type for matched text")};function Z(){return this.value}if(T.prototype.next=function(){var g=this.index;if(this.queuedGroup){var S=this._token(this.queuedGroup,this.queuedText,g);return this.queuedGroup=null,this.queuedText="",S}var A=this.buffer;if(g!==A.length){var V=this.fast[A.charCodeAt(g)];if(V)return this._token(V,A.charAt(g),g);var B=this.re;B.lastIndex=g;var C=$(B,A),k=this.error;if(C==null)return this._token(k,A.slice(g,A.length),g);var V=this._getGroup(C),H=C[0];return k.fallback&&C.index!==g?(this.queuedGroup=V,this.queuedText=H,this._token(k,A.slice(g,C.index),g)):this._token(V,H,g)}},T.prototype._token=function(g,S,A){var B=0;if(g.lineBreaks){var C=/\n/g,k=1;if(S===`
`)B=1;else for(;C.exec(S);)B++,k=C.lastIndex}var V={type:typeof g.type=="function"&&g.type(S)||g.defaultType,value:typeof g.value=="function"?g.value(S):S,text:S,toString:Z,offset:A,lineBreaks:B,line:this.line,col:this.col},H=S.length;if(this.index+=H,this.line+=B,B!==0?this.col=H-k+1:this.col+=H,g.shouldThrow){var D=new Error(this.formatError(V,"invalid syntax"));throw D}return g.pop?this.popState():g.push?this.pushState(g.push):g.next&&this.setState(g.next),V},typeof Symbol<"u"&&Symbol.iterator){var L=function(g){this.lexer=g};L.prototype.next=function(){var g=this.lexer.next();return{value:g,done:!g}},L.prototype[Symbol.iterator]=function(){return this},T.prototype[Symbol.iterator]=function(){return new L(this)}}return T.prototype.formatError=function(g,S){if(g==null)var A=this.buffer.slice(this.index),g={text:A,offset:this.index,lineBreaks:A.indexOf(`
`)===-1?0:1,line:this.line,col:this.col};var B=2,C=Math.max(g.line-B,1),k=g.line+B,V=String(k).length,H=p(this.buffer,this.line-g.line+B+1).slice(0,5),D=[];D.push(S+" at line "+g.line+" col "+g.col+":"),D.push("");for(var R=0;R<H.length;R++){var U=H[R],et=C+R;D.push(c(String(et),V)+"  "+U),et===g.line&&D.push(c("",V+g.col+1)+"^")}return D.join(`
`)},T.prototype.clone=function(){return new T(this.states,this.state)},T.prototype.has=function(g){return!0},{compile:w,states:z,error:Object.freeze({error:!0}),fallback:Object.freeze({fallback:!0}),keywords:F}})})(Nr);var Dr=Ys;function en(r){return r[0]}const E=Dr.compile({returnSymbol:/return/,nullSymbol:/null/,thisSymbol:/this/,ifSymbol:/if/,thenSymbol:/then/,elseSymbol:/else/,switchSymbol:/switch/,caseSymbol:/case/,arrow:/->/,longArrow:/-->/,openBracket:/\(/,closedBracket:/\)/,openCurlyBracket:/{/,closedCurlyBracket:/}/,point:/\./,comma:/,/,colon:/:/,smallerEqual:/<=/,greaterEqual:/>=/,smaller:/</,greater:/>/,doubleEqual:/==/,equal:/=/,unequal:/!=/,and:/&&/,or:/\|\|/,not:/!/,parallel:/\|/,int:/0[Xx][\da-fA-F]+|0[bB][01]+/,number:/-?\d+(?:\.\d+)?/,string:/"[^"]*"/,boolean:/true|false/,plus:/\+/,minus:/-/,multiply:/\*/,percent:/%/,divide:/\//,identifier:/[a-zA-Z_$@']+\w*/,ws:{match:/\s+/,lineBreaks:!0}}),Lr={Lexer:E,ParserRules:[{name:"DescriptionsDefinition$ebnf$1",symbols:[]},{name:"DescriptionsDefinition$ebnf$1",symbols:["DescriptionsDefinition$ebnf$1","DescriptionDefinition"],postprocess:r=>r[0].concat([r[1]])},{name:"DescriptionsDefinition",symbols:["ws","DescriptionsDefinition$ebnf$1"],postprocess:([,r])=>r.reduce((t,[e,s])=>(t[e]=s,t),{})},{name:"DescriptionDefinition$ebnf$1$subexpression$1$ebnf$1",symbols:["InitialVariables"],postprocess:en},{name:"DescriptionDefinition$ebnf$1$subexpression$1$ebnf$1",symbols:[],postprocess:()=>null},{name:"DescriptionDefinition$ebnf$1$subexpression$1",symbols:[E.has("openBracket")?{type:"openBracket"}:openBracket,"ws","DescriptionDefinition$ebnf$1$subexpression$1$ebnf$1",E.has("closedBracket")?{type:"closedBracket"}:closedBracket,"ws"]},{name:"DescriptionDefinition$ebnf$1",symbols:["DescriptionDefinition$ebnf$1$subexpression$1"],postprocess:en},{name:"DescriptionDefinition$ebnf$1",symbols:[],postprocess:()=>null},{name:"DescriptionDefinition",symbols:[E.has("identifier")?{type:"identifier"}:identifier,"ws","DescriptionDefinition$ebnf$1",E.has("openCurlyBracket")?{type:"openCurlyBracket"}:openCurlyBracket,"ws","NounDefinitions",E.has("closedCurlyBracket")?{type:"closedCurlyBracket"}:closedCurlyBracket,"ws"],postprocess:([{value:r},,t,,,e])=>[r,{initialVariables:(t==null?void 0:t[2])??{},nouns:e,rootNounIdentifier:Object.keys(e)[0]}]},{name:"InitialVariables$ebnf$1",symbols:[]},{name:"InitialVariables$ebnf$1$subexpression$1",symbols:["InitialVariable",E.has("comma")?{type:"comma"}:comma,"ws"]},{name:"InitialVariables$ebnf$1",symbols:["InitialVariables$ebnf$1","InitialVariables$ebnf$1$subexpression$1"],postprocess:r=>r[0].concat([r[1]])},{name:"InitialVariables",symbols:["InitialVariables$ebnf$1","InitialVariable"],postprocess:([r,t])=>[...r.map(([e])=>e),t].reduce((e,[s,i])=>(e[s]=i,e),{})},{name:"InitialVariable",symbols:[E.has("identifier")?{type:"identifier"}:identifier,"ws",E.has("colon")?{type:"colon"}:colon,"ws","Constant","ws"],postprocess:([{value:r},,,,t])=>[r,t]},{name:"NounDefinitions$ebnf$1",symbols:[]},{name:"NounDefinitions$ebnf$1$subexpression$1",symbols:["NounDefinition",E.has("ws")?{type:"ws"}:ws]},{name:"NounDefinitions$ebnf$1",symbols:["NounDefinitions$ebnf$1","NounDefinitions$ebnf$1$subexpression$1"],postprocess:r=>r[0].concat([r[1]])},{name:"NounDefinitions",symbols:["NounDefinitions$ebnf$1","NounDefinition","ws"],postprocess:([r,t])=>[...r.map(([e])=>e),t].reduce((e,[s,i])=>(e[s]={transformation:i},e),{})},{name:"NounDefinition",symbols:[E.has("identifier")?{type:"identifier"}:identifier,"ws",E.has("longArrow")?{type:"longArrow"}:longArrow,"ws","Transformation"],postprocess:([{value:r},,,,t])=>[r,t]},{name:"Transformation",symbols:["ParallelTransformations"],postprocess:([r])=>r},{name:"ParallelTransformations$ebnf$1",symbols:["ParallelTransformation"]},{name:"ParallelTransformations$ebnf$1",symbols:["ParallelTransformations$ebnf$1","ParallelTransformation"],postprocess:r=>r[0].concat([r[1]])},{name:"ParallelTransformations",symbols:["ParallelTransformations$ebnf$1","SequentialTransformations"],postprocess:([r,t])=>({type:"parallel",children:[...r,t]})},{name:"ParallelTransformations",symbols:["SequentialTransformations"],postprocess:([r])=>r},{name:"ParallelTransformation",symbols:["SequentialTransformations","ws",E.has("parallel")?{type:"parallel"}:parallel,"ws"],postprocess:([r])=>r},{name:"SequentialTransformations$ebnf$1",symbols:["SequentialTransformation"]},{name:"SequentialTransformations$ebnf$1",symbols:["SequentialTransformations$ebnf$1","SequentialTransformation"],postprocess:r=>r[0].concat([r[1]])},{name:"SequentialTransformations",symbols:["SequentialTransformations$ebnf$1","OrOperation"],postprocess:([r,t])=>({type:"sequential",children:[...r,t]})},{name:"SequentialTransformations",symbols:["OrOperation"],postprocess:([r])=>r},{name:"SequentialTransformation",symbols:["OrOperation","ws",E.has("arrow")?{type:"arrow"}:arrow,"ws"],postprocess:([r])=>r},{name:"OrOperation",symbols:["OrOperation","ws",E.has("or")?{type:"or"}:or,"ws","AndOperation"],postprocess:([r,,,,t])=>({type:"||",children:[r,t]})},{name:"OrOperation",symbols:["AndOperation"],postprocess:([r])=>r},{name:"AndOperation",symbols:["AndOperation","ws",E.has("and")?{type:"and"}:and,"ws","NegateOperation"],postprocess:([r,,,,t])=>({type:"&&",children:[r,t]})},{name:"AndOperation",symbols:["NegateOperation"],postprocess:([r])=>r},{name:"NegateOperation",symbols:[E.has("not")?{type:"not"}:not,"ws","NegateOperation"],postprocess:([,,r])=>({type:"!",children:[r]})},{name:"NegateOperation",symbols:["ComparisonOperation"],postprocess:([r])=>r},{name:"ComparisonOperation",symbols:["EquityOperation"],postprocess:([r])=>r},{name:"EquityOperation",symbols:["EqualOperation"],postprocess:([r])=>r},{name:"EquityOperation",symbols:["UnequalOperation"],postprocess:([r])=>r},{name:"EquityOperation",symbols:["RelationalOperation"],postprocess:([r])=>r},{name:"EqualOperation",symbols:["EquityOperation","ws",E.has("doubleEqual")?{type:"doubleEqual"}:doubleEqual,"ws","RelationalOperation"],postprocess:([r,,,,t])=>({type:"==",children:[r,t]})},{name:"UnequalOperation",symbols:["EquityOperation","ws",E.has("unequal")?{type:"unequal"}:unequal,"ws","RelationalOperation"],postprocess:([r,,,,t])=>({type:"!=",children:[r,t]})},{name:"RelationalOperation",symbols:["SmallerOperation"],postprocess:([r])=>r},{name:"RelationalOperation",symbols:["SmallerEqualOperation"],postprocess:([r])=>r},{name:"RelationalOperation",symbols:["GreaterOperation"],postprocess:([r])=>r},{name:"RelationalOperation",symbols:["GreaterEqualOperation"],postprocess:([r])=>r},{name:"RelationalOperation",symbols:["ArithmeticOperation"],postprocess:([r])=>r},{name:"SmallerOperation",symbols:["RelationalOperation","ws",E.has("smaller")?{type:"smaller"}:smaller,"ws","ArithmeticOperation"],postprocess:([r,,,,t])=>({type:"<",children:[r,t]})},{name:"SmallerEqualOperation",symbols:["RelationalOperation","ws",E.has("smallerEqual")?{type:"smallerEqual"}:smallerEqual,"ws","ArithmeticOperation"],postprocess:([r,,,,t])=>({type:"<=",children:[r,t]})},{name:"GreaterOperation",symbols:["RelationalOperation","ws",E.has("greater")?{type:"greater"}:greater,"ws","ArithmeticOperation"],postprocess:([r,,,,t])=>({type:">",children:[r,t]})},{name:"GreaterEqualOperation",symbols:["RelationalOperation","ws",E.has("greaterEqual")?{type:"greaterEqual"}:greaterEqual,"ws","ArithmeticOperation"],postprocess:([r,,,,t])=>({type:">=",children:[r,t]})},{name:"ArithmeticOperation",symbols:["LineOperation"],postprocess:([r])=>r},{name:"LineOperation",symbols:["AddOperation"],postprocess:([r])=>r},{name:"LineOperation",symbols:["SubtractOperation"],postprocess:([r])=>r},{name:"LineOperation",symbols:["PointOperation"],postprocess:([r])=>r},{name:"AddOperation",symbols:["LineOperation","ws",E.has("plus")?{type:"plus"}:plus,"ws","PointOperation"],postprocess:([r,,,,t])=>({type:"+",children:[r,t]})},{name:"SubtractOperation",symbols:["LineOperation","ws",E.has("minus")?{type:"minus"}:minus,"ws","PointOperation"],postprocess:([r,,,,t])=>({type:"-",children:[r,t]})},{name:"PointOperation",symbols:["MultiplyOperation"],postprocess:([r])=>r},{name:"PointOperation",symbols:["DivideOperation"],postprocess:([r])=>r},{name:"PointOperation",symbols:["ModuloOperation"],postprocess:([r])=>r},{name:"PointOperation",symbols:["InvertOperation"],postprocess:([r])=>r},{name:"DivideOperation",symbols:["PointOperation","ws",E.has("divide")?{type:"divide"}:divide,"ws","InvertOperation"],postprocess:([r,,,,t])=>({type:"/",children:[r,t]})},{name:"MultiplyOperation",symbols:["PointOperation","ws",E.has("multiply")?{type:"multiply"}:multiply,"ws","InvertOperation"],postprocess:([r,,,,t])=>({type:"*",children:[r,t]})},{name:"ModuloOperation",symbols:["PointOperation","ws",E.has("percent")?{type:"percent"}:percent,"ws","InvertOperation"],postprocess:([r,,,,t])=>({type:"%",children:[r,t]})},{name:"InvertOperation",symbols:[E.has("minus")?{type:"minus"}:minus,"ws","InvertOperation"],postprocess:([,,r])=>({type:"-()",children:[r]})},{name:"InvertOperation",symbols:["BaseTransformation"],postprocess:([r])=>r},{name:"BaseTransformation",symbols:["Operation"],postprocess:([r])=>r},{name:"BaseTransformation",symbols:["NounReference"],postprocess:([r])=>r},{name:"BaseTransformation",symbols:[E.has("thisSymbol")?{type:"thisSymbol"}:thisSymbol],postprocess:()=>({type:"this"})},{name:"BaseTransformation",symbols:["GetVariable"],postprocess:([r])=>r},{name:"BaseTransformation",symbols:["SetVariable"],postprocess:([r])=>r},{name:"BaseTransformation",symbols:["Constant"],postprocess:([r])=>({type:"raw",value:r})},{name:"BaseTransformation",symbols:["Conditional"],postprocess:([r])=>r},{name:"BaseTransformation",symbols:[E.has("returnSymbol")?{type:"returnSymbol"}:returnSymbol],postprocess:()=>({type:"return"})},{name:"BaseTransformation",symbols:[E.has("nullSymbol")?{type:"nullSymbol"}:nullSymbol],postprocess:()=>({type:"null"})},{name:"BaseTransformation",symbols:[E.has("openBracket")?{type:"openBracket"}:openBracket,"ws","Transformation","ws",E.has("closedBracket")?{type:"closedBracket"}:closedBracket],postprocess:([,,r])=>r},{name:"BaseTransformation",symbols:["Random"],postprocess:([r])=>r},{name:"Random$ebnf$1",symbols:[]},{name:"Random$ebnf$1",symbols:["Random$ebnf$1","RandomStep"],postprocess:r=>r[0].concat([r[1]])},{name:"Random",symbols:[E.has("openCurlyBracket")?{type:"openCurlyBracket"}:openCurlyBracket,"Random$ebnf$1","ws",E.has("closedCurlyBracket")?{type:"closedCurlyBracket"}:closedCurlyBracket],postprocess:([,r])=>({type:"stochasticSwitch",probabilities:r.map(({probability:t})=>t),children:r.map(({transformation:t})=>t)})},{name:"RandomStep",symbols:["ws",E.has("number")?{type:"number"}:number,E.has("percent")?{type:"percent"}:percent,"ws",E.has("colon")?{type:"colon"}:colon,"ws","Transformation"],postprocess:([,{value:r},,,,,t])=>({probability:Number.parseFloat(r)/100,transformation:t})},{name:"Operation",symbols:[E.has("identifier")?{type:"identifier"}:identifier,E.has("openBracket")?{type:"openBracket"}:openBracket,"EmptyParameters","ws",E.has("closedBracket")?{type:"closedBracket"}:closedBracket],postprocess:([{value:r},,t])=>({type:"operation",children:t,identifier:r})},{name:"EmptyParameters",symbols:["ws","Parameters"],postprocess:([,r])=>r},{name:"EmptyParameters",symbols:[],postprocess:()=>[]},{name:"Parameters$ebnf$1",symbols:[]},{name:"Parameters$ebnf$1",symbols:["Parameters$ebnf$1","Parameter"],postprocess:r=>r[0].concat([r[1]])},{name:"Parameters",symbols:["Parameters$ebnf$1","Transformation"],postprocess:([r,t])=>[...r,t]},{name:"Parameter",symbols:["Transformation","ws",E.has("comma")?{type:"comma"}:comma,"ws"],postprocess:([r])=>r},{name:"NounReference",symbols:[E.has("identifier")?{type:"identifier"}:identifier,E.has("point")?{type:"point"}:point,E.has("identifier")?{type:"identifier"}:identifier],postprocess:([{value:r},,{value:t}])=>({type:"nounReference",descriptionIdentifier:r,nounIdentifier:t})},{name:"NounReference",symbols:[E.has("identifier")?{type:"identifier"}:identifier],postprocess:([{value:r}])=>({type:"nounReference",nounIdentifier:r})},{name:"ws",symbols:[E.has("ws")?{type:"ws"}:ws]},{name:"ws",symbols:[]},{name:"Constant",symbols:[E.has("boolean")?{type:"boolean"}:boolean],postprocess:([{value:r}])=>r==="true"},{name:"Constant",symbols:[E.has("string")?{type:"string"}:string],postprocess:([{value:r}])=>r.slice(1,-1)},{name:"Constant",symbols:[E.has("number")?{type:"number"}:number],postprocess:([{value:r}])=>Number.parseFloat(r)},{name:"Constant",symbols:[E.has("int")?{type:"int"}:int],postprocess:([{value:r}])=>Number.parseInt(r)},{name:"GetVariable",symbols:[E.has("thisSymbol")?{type:"thisSymbol"}:thisSymbol,E.has("point")?{type:"point"}:point,E.has("identifier")?{type:"identifier"}:identifier],postprocess:([,,{value:r}])=>({type:"getVariable",identifier:r})},{name:"SetVariable",symbols:[E.has("thisSymbol")?{type:"thisSymbol"}:thisSymbol,E.has("point")?{type:"point"}:point,E.has("identifier")?{type:"identifier"}:identifier,"ws",E.has("equal")?{type:"equal"}:equal,"ws","Transformation"],postprocess:([,,{value:r},,,,t])=>({type:"setVariable",identifier:r,children:[t]})},{name:"Conditional",symbols:["IfThenElse"],postprocess:([r])=>r},{name:"Conditional",symbols:["Switch"],postprocess:([r])=>r},{name:"IfThenElse",symbols:[E.has("ifSymbol")?{type:"ifSymbol"}:ifSymbol,E.has("ws")?{type:"ws"}:ws,"Transformation",E.has("ws")?{type:"ws"}:ws,"Then","ws","Else"],postprocess:([,,r,,t,,e])=>({type:"if",children:[r,t,e]})},{name:"Then",symbols:[E.has("thenSymbol")?{type:"thenSymbol"}:thenSymbol,"ws",E.has("openCurlyBracket")?{type:"openCurlyBracket"}:openCurlyBracket,"ws","Transformation","ws",E.has("closedCurlyBracket")?{type:"closedCurlyBracket"}:closedCurlyBracket],postprocess:([,,,,r])=>r},{name:"Else",symbols:[E.has("elseSymbol")?{type:"elseSymbol"}:elseSymbol,"ws",E.has("openCurlyBracket")?{type:"openCurlyBracket"}:openCurlyBracket,"ws","Transformation","ws",E.has("closedCurlyBracket")?{type:"closedCurlyBracket"}:closedCurlyBracket],postprocess:([,,,,r])=>r},{name:"Switch$ebnf$1",symbols:[]},{name:"Switch$ebnf$1",symbols:["Switch$ebnf$1","SwitchCases"],postprocess:r=>r[0].concat([r[1]])},{name:"Switch",symbols:[E.has("switchSymbol")?{type:"switchSymbol"}:switchSymbol,E.has("ws")?{type:"ws"}:ws,"Transformation","ws",E.has("openCurlyBracket")?{type:"openCurlyBracket"}:openCurlyBracket,"Switch$ebnf$1","ws",E.has("closedCurlyBracket")?{type:"closedCurlyBracket"}:closedCurlyBracket],postprocess:([,,r,,,t])=>({type:"switch",cases:t.map(({caseValues:e})=>e),children:[r,...t.map(({transformation:e})=>e)]})},{name:"SwitchCases$ebnf$1",symbols:["SwitchCase"]},{name:"SwitchCases$ebnf$1",symbols:["SwitchCases$ebnf$1","SwitchCase"],postprocess:r=>r[0].concat([r[1]])},{name:"SwitchCases",symbols:["ws","SwitchCases$ebnf$1","Transformation"],postprocess:([,r,t])=>({caseValues:r,transformation:t})},{name:"SwitchCase",symbols:[E.has("caseSymbol")?{type:"caseSymbol"}:caseSymbol,E.has("ws")?{type:"ws"}:ws,"Constant",E.has("colon")?{type:"colon"}:colon,"ws"],postprocess:([,,r])=>r}],ParserStart:"DescriptionsDefinition"},$r=180/Math.PI;function Vr(r){return r*$r}const{Grammar:qr,Parser:Rh}=Ir;qr.fromCompiled(Lr);class Ur{constructor(t,e){it(this,"computeProgress");it(this,"compareProgress");it(this,"list",[]);it(this,"results",[]);it(this,"highestFinishedProgress");it(this,"currentProgress");it(this,"resultCache",{});this.computeProgress=t,this.compareProgress=e,this.currentProgress=this.computeProgress(void 0)}getCached(t,e){return t in this.resultCache?this.resultCache[t]:this.resultCache[t]=e(this.results)}pop(){return this.list.shift()}peek(){return this.list[0]}push(t){const e=this.computeProgress(t.value.raw);if(t.stack.length===0)this.results.push({raw:t.value.raw,id:t.id}),(this.highestFinishedProgress==null||this.compareProgress(e,this.highestFinishedProgress)<0)&&(this.highestFinishedProgress=e);else{let s=0;for(;s<this.list.length&&this.compareProgress(e,this.computeProgress(this.list[s].value.raw))<0;)s++;this.list.splice(s,0,t)}this.currentProgress=this.list.length===0?this.highestFinishedProgress:this.computeProgress(this.list[0].value.raw)}}var Ue;(function(r){r[r.UpdateRequestedProgress=0]="UpdateRequestedProgress",r[r.Interprete=1]="Interprete",r[r.Results=2]="Results"})(Ue||(Ue={}));function Hr(r,t,e,s,i){postMessage({type:Ue.Results,result:r.serialize(t,e,s),progress:s,isFinal:i})}function Gr(r){let t,e,s;const i=Hr.bind(null,r);self.onmessage=n=>{switch(n.data.type){case Ue.Interprete:if((t==null?void 0:t.timeoutRef)!=null)throw new Error("unable to interprete while interpretation is already running");t={requestedProgress:n.data.requestedProgress},s=n.data.descriptions,e=Jr(n.data.descriptions,r,t,i);return;case Ue.UpdateRequestedProgress:if(e==null||s==null||t==null)throw new Error("unable to update requested progress when interpretation has not yet been started");t.requestedProgress=n.data.requestedProgress,t.timeoutRef==null&&Qs(e,s,r,t,i);return}}}function Jr(r,t,e,s){const i=new Ur(t.computeProgress,t.compareProgress),n=Object.entries(r);for(let o=0;o<n.length;o++){const[a,{initialVariables:l,rootNounIdentifier:h,nouns:u}]=n[o],c=u[h];if(c==null)throw new Error(`unknown noun "${h}" at description "${a}"`);l.interprete!==!1&&i.push({value:{raw:t.createValue(l,c.astId),variables:{...l,index:0}},seed:l.seed??"0",id:o.toString(),stack:[c.transformation]})}return Qs(i,r,t,e,s),i}function Wr(r,t,e,s,i,...n){const o=r.peek();if(o!=null){if(Array.isArray(i)){r.pop();for(let a=0;a<i.length;a++)r.push({value:{raw:i[a],variables:{...o.value.variables,index:a}},seed:o.seed,id:`${o.id}${a}`,stack:[...n,...o.stack]});return}if(o.stack.unshift(...n),i!==void 0){r.pop(),o.value.raw=i,r.push(o);return}if(o.stack.length===0){r.pop(),r.push(o);return}}}function Qs(r,t,e,s,i){let n=r.peek();const o=new Date().getTime(),a=r.currentProgress;for(;n!=null&&new Date().getTime()-o<e.computeDurationMS&&!e.shouldInterrrupt(a,r.currentProgress);){const l=n.stack.shift();if(l.type==="parallel"){r.pop();for(const[h,u]of l.children.entries())r.push({value:{raw:e.cloneValue(n.value.raw),variables:{...n.value.variables,index:h}},seed:n.seed,id:`${n.id}${h}`,stack:[u,...n.stack]})}else sn(r,t,e,n.id,n.value,n.seed,l,Wr);n=r.peek()}i(r,a,r.currentProgress,n==null),!(n==null||e.compareProgress(r.currentProgress,s.requestedProgress)<=0)&&(s.timeoutRef=setTimeout(()=>{s.timeoutRef=void 0,Qs(r,t,e,s,i)},0))}function sn(r,t,e,s,i,n,o,a){switch(o.type){case"operation":return io(r,t,e,s,i,n,o,a);case"precomputedOperation":return no(r,t,e,s,i,n,o,a);case"raw":return ro(r,t,e,s,i,n,o,a);case"sequential":return eo(r,t,e,s,i,n,o,a);case"nounReference":return Kr(r,t,e,s,i,n,o,a);case"this":return lo(r,t,e,s,i,n,a);case"-()":case"!":return ao(r,t,e,s,i,n,o,a);case"+":case"&&":case"/":case"==":case">":case">=":case"%":case"*":case"||":case"<":case"<=":case"-":case"!=":return so(r,t,e,s,i,n,o,a);case"if":return to(r,t,e,s,i,n,o,a);case"switch":return jr(r,t,e,s,i,n,o,a);case"getVariable":return Yr(r,t,e,s,i,n,o,a);case"setVariable":return Qr(r,t,e,s,i,n,o,a);case"stochasticSwitch":return Xr(r,t,e,s,i,n,o,a)}throw new Error(`unknown transformation type "${o.type}"`)}const Zr=(r,t,e,s,i,n,o,...a)=>{if(Array.isArray(o))throw new Error("unable to compute parallel values in synchronous interpretation");o!==void 0&&(n.raw=o);for(const l of a)de(e,s,i,r,n,t,l);return n};function de(r,t,e,s,i,n,o){return sn(r,t,e,s,i,n,o,Zr.bind(null,s,n))}function Xr(r,t,e,s,i,n,o,a){var c,p;const l=js(s+n);let h=0,u=-1;do u++,h+=o.probabilities[u];while(l>h&&u<o.probabilities.length);return(p=(c=e.listeners)==null?void 0:c.onStochasticSwitch)==null||p.call(c,o,i,u),a(r,t,e,i,void 0,o.children[u])}function Yr(r,t,e,s,i,n,o,a){const l=i.variables[o.identifier];if(l==null)throw new Error(`unknown variable "${o.identifier}"`);return a(r,t,e,i,l)}function Qr(r,t,e,s,i,n,o,a){return i.variables[o.identifier]=de(r,t,e,s,{raw:e.cloneValue(i.raw),variables:{...i.variables}},n,o.children[0]),a(r,t,e,i,void 0)}function jr(r,t,e,s,i,n,o,a){const{raw:l}=de(r,t,e,s,{raw:e.cloneValue(i.raw),variables:{...i.variables}},n,o.children[0]);for(let h=0;h<o.cases.length;h++)if(o.cases[h].includes(l))return a(r,t,e,i,void 0,o.children[h+1]);throw new Error("no case matched")}function Kr(r,t,e,s,i,n,o,a){const l=t[o.descriptionIdentifier],h=l==null?void 0:l.nouns[o.nounIdentifier];if(h==null)throw new Error(`unknown noun "${o.nounIdentifier}" from description "${o.descriptionIdentifier}"`);return a(r,t,e,i,void 0,h.transformation)}function to(r,t,e,s,i,n,o,a){return de(r,t,e,s,{raw:e.cloneValue(i.raw),variables:{...i.variables}},n,o.children[0]).raw?a(r,t,e,i,void 0,o.children[1]):a(r,t,e,i,void 0,o.children[2])}function eo(r,t,e,s,i,n,o,a){return a(r,t,e,i,void 0,...o.children)}function so(r,t,e,s,i,n,o,a){const[l,h]=o.children.map(u=>de(r,t,e,s,{raw:e.cloneValue(i.raw),variables:{...i.variables}},n,u));return a(r,t,e,i,ho[o.type](l.raw,h.raw))}function io(r,t,e,s,i,n,o,a){const l=e.operations[o.identifier];if(l==null)throw new Error(`unknown operation "${o.identifier}"`);const h=o.children.map(u=>de(r,t,e,s,{raw:e.cloneValue(i.raw),variables:{...i.variables}},n,u)).map(({raw:u})=>u);return l.includeQueue&&h.unshift(r),l.includeThis&&h.unshift(i.raw),l.execute(a.bind(null,r,t,e,i),o.astId,s+n,...h)}function no(r,t,e,s,i,n,o,a){const l=e.operations[o.identifier];if(l==null)throw new Error(`unknown operation "${o.identifier}"`);const h=[...o.parameters];return l.includeQueue&&h.unshift(r),l.includeThis&&h.unshift(i.raw),l.execute(a.bind(null,r,t,e,i),o.astId,s+n,...h)}function ro(r,t,e,s,i,n,o,a){return a(r,t,e,i,o.value)}const oo={"-()":r=>-r,"!":r=>!r};function ao(r,t,e,s,i,n,o,a){const l=de(r,t,e,s,{raw:e.cloneValue(i.raw),variables:{...i.variables}},n,o.children[0]);return a(r,t,e,i,oo[o.type](l.raw))}const ho={"+":(r,t)=>r+t,"&&":(r,t)=>r&&t,"/":(r,t)=>r/t,"==":(r,t)=>r==t,">":(r,t)=>r>t,">=":(r,t)=>r>=t,"%":(r,t)=>r%t,"*":(r,t)=>r*t,"||":(r,t)=>r||t,"<":(r,t)=>r<t,"<=":(r,t)=>r<=t,"-":(r,t)=>r-t,"!=":(r,t)=>r!=t};function lo(r,t,e,s,i,n,o){return o(r,t,e,i,void 0)}[["parallel"],["sequential"],["||"],["&&"],["!"],["==","!="],["<","<=",">",">="],["+","-"],["*","/","%"],["-()"],["getVariable","setVariable","if","switch","stochasticSwitch","nounReference","operation","this","raw","return","null"]].reduce((r,t,e)=>(t.forEach(s=>r[s]=e),r),{});function os(r){return r!=null}const uo=(r,t=0)=>{let e=3735928559^t,s=1103547991^t;for(let i=0,n;i<r.length;i++)n=r.charCodeAt(i),e=Math.imul(e^n,2654435761),s=Math.imul(s^n,1597334677);return e=Math.imul(e^e>>>16,2246822507)^Math.imul(s^s>>>13,3266489909),s=Math.imul(s^s>>>16,2246822507)^Math.imul(e^e>>>13,3266489909),4294967296*(2097151&s)+(e>>>0)},js=(r,t=0)=>uo(r,t)%1e4/1e4;/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const nn="151",Ks=0,co=1,rn=1,po=100,fo=204,mo=205,yo=3,xo=0,on=300,an=1e3,as=1001,hn=1002,go=1006,bo=1008,wo=1009,vo=1023,Mo=3e3,qt="srgb",ti="srgb-linear",ln="display-p3",ei=7680,So=519,si=35044;class hs{addEventListener(t,e){this._listeners===void 0&&(this._listeners={});const s=this._listeners;s[t]===void 0&&(s[t]=[]),s[t].indexOf(e)===-1&&s[t].push(e)}hasEventListener(t,e){if(this._listeners===void 0)return!1;const s=this._listeners;return s[t]!==void 0&&s[t].indexOf(e)!==-1}removeEventListener(t,e){if(this._listeners===void 0)return;const i=this._listeners[t];if(i!==void 0){const n=i.indexOf(e);n!==-1&&i.splice(n,1)}}dispatchEvent(t){if(this._listeners===void 0)return;const s=this._listeners[t.type];if(s!==void 0){t.target=this;const i=s.slice(0);for(let n=0,o=i.length;n<o;n++)i[n].call(this,t);t.target=null}}}const ot=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],Ao=Math.PI/180;function Ut(){const r=Math.random()*4294967295|0,t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,s=Math.random()*4294967295|0;return(ot[r&255]+ot[r>>8&255]+ot[r>>16&255]+ot[r>>24&255]+"-"+ot[t&255]+ot[t>>8&255]+"-"+ot[t>>16&15|64]+ot[t>>24&255]+"-"+ot[e&63|128]+ot[e>>8&255]+"-"+ot[e>>16&255]+ot[e>>24&255]+ot[s&255]+ot[s>>8&255]+ot[s>>16&255]+ot[s>>24&255]).toLowerCase()}function at(r,t,e){return Math.max(t,Math.min(e,r))}function zo(r,t){return(r%t+t)%t}function ii(r,t,e){return(1-e)*r+e*t}function ee(r,t){switch(t.constructor){case Float32Array:return r;case Uint16Array:return r/65535;case Uint8Array:return r/255;case Int16Array:return Math.max(r/32767,-1);case Int8Array:return Math.max(r/127,-1);default:throw new Error("Invalid component type.")}}function W(r,t){switch(t.constructor){case Float32Array:return r;case Uint16Array:return Math.round(r*65535);case Uint8Array:return Math.round(r*255);case Int16Array:return Math.round(r*32767);case Int8Array:return Math.round(r*127);default:throw new Error("Invalid component type.")}}class _{constructor(t=0,e=0){_.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,s=this.y,i=t.elements;return this.x=i[0]*e+i[3]*s+i[6],this.y=i[1]*e+i[4]*s+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(t,Math.min(e,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const s=this.dot(t)/e;return Math.acos(at(s,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,s=this.y-t.y;return e*e+s*s}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,s){return this.x=t.x+(e.x-t.x)*s,this.y=t.y+(e.y-t.y)*s,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const s=Math.cos(e),i=Math.sin(e),n=this.x-t.x,o=this.y-t.y;return this.x=n*s-o*i+t.x,this.y=n*i+o*s+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Ht{constructor(){Ht.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(t,e,s,i,n,o,a,l,h){const u=this.elements;return u[0]=t,u[1]=i,u[2]=a,u[3]=e,u[4]=n,u[5]=l,u[6]=s,u[7]=o,u[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,s=t.elements;return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e[4]=s[4],e[5]=s[5],e[6]=s[6],e[7]=s[7],e[8]=s[8],this}extractBasis(t,e,s){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),s.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const s=t.elements,i=e.elements,n=this.elements,o=s[0],a=s[3],l=s[6],h=s[1],u=s[4],c=s[7],p=s[2],f=s[5],d=s[8],m=i[0],y=i[3],b=i[6],M=i[1],w=i[4],v=i[7],z=i[2],F=i[5],T=i[8];return n[0]=o*m+a*M+l*z,n[3]=o*y+a*w+l*F,n[6]=o*b+a*v+l*T,n[1]=h*m+u*M+c*z,n[4]=h*y+u*w+c*F,n[7]=h*b+u*v+c*T,n[2]=p*m+f*M+d*z,n[5]=p*y+f*w+d*F,n[8]=p*b+f*v+d*T,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],s=t[1],i=t[2],n=t[3],o=t[4],a=t[5],l=t[6],h=t[7],u=t[8];return e*o*u-e*a*h-s*n*u+s*a*l+i*n*h-i*o*l}invert(){const t=this.elements,e=t[0],s=t[1],i=t[2],n=t[3],o=t[4],a=t[5],l=t[6],h=t[7],u=t[8],c=u*o-a*h,p=a*l-u*n,f=h*n-o*l,d=e*c+s*p+i*f;if(d===0)return this.set(0,0,0,0,0,0,0,0,0);const m=1/d;return t[0]=c*m,t[1]=(i*h-u*s)*m,t[2]=(a*s-i*o)*m,t[3]=p*m,t[4]=(u*e-i*l)*m,t[5]=(i*n-a*e)*m,t[6]=f*m,t[7]=(s*l-h*e)*m,t[8]=(o*e-s*n)*m,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,s,i,n,o,a){const l=Math.cos(n),h=Math.sin(n);return this.set(s*l,s*h,-s*(l*o+h*a)+o+t,-i*h,i*l,-i*(-h*o+l*a)+a+e,0,0,1),this}scale(t,e){return this.premultiply(ni.makeScale(t,e)),this}rotate(t){return this.premultiply(ni.makeRotation(-t)),this}translate(t,e){return this.premultiply(ni.makeTranslation(t,e)),this}makeTranslation(t,e){return this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),s=Math.sin(t);return this.set(e,-s,0,s,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,s=t.elements;for(let i=0;i<9;i++)if(e[i]!==s[i])return!1;return!0}fromArray(t,e=0){for(let s=0;s<9;s++)this.elements[s]=t[s+e];return this}toArray(t=[],e=0){const s=this.elements;return t[e]=s[0],t[e+1]=s[1],t[e+2]=s[2],t[e+3]=s[3],t[e+4]=s[4],t[e+5]=s[5],t[e+6]=s[6],t[e+7]=s[7],t[e+8]=s[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const ni=new Ht;function To(r){for(let t=r.length-1;t>=0;--t)if(r[t]>=65535)return!0;return!1}const _o={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function ls(r,t){return new _o[r](t)}function un(r){return document.createElementNS("http://www.w3.org/1999/xhtml",r)}function Ae(r){return r<.04045?r*.0773993808:Math.pow(r*.9478672986+.0521327014,2.4)}function ri(r){return r<.0031308?r*12.92:1.055*Math.pow(r,.41666)-.055}const Bo=new Ht().fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),Eo=new Ht().fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]);function Co(r){return r.convertSRGBToLinear().applyMatrix3(Eo)}function Po(r){return r.applyMatrix3(Bo).convertLinearToSRGB()}const ko={[ti]:r=>r,[qt]:r=>r.convertSRGBToLinear(),[ln]:Co},Oo={[ti]:r=>r,[qt]:r=>r.convertLinearToSRGB(),[ln]:Po},xt={enabled:!1,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(r){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!r},get workingColorSpace(){return ti},set workingColorSpace(r){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(r,t,e){if(this.enabled===!1||t===e||!t||!e)return r;const s=ko[t],i=Oo[e];if(s===void 0||i===void 0)throw new Error(`Unsupported color space conversion, "${t}" to "${e}".`);return i(s(r))},fromWorkingColorSpace:function(r,t){return this.convert(r,this.workingColorSpace,t)},toWorkingColorSpace:function(r,t){return this.convert(r,t,this.workingColorSpace)}};let ze;class Fo{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{ze===void 0&&(ze=un("canvas")),ze.width=t.width,ze.height=t.height;const s=ze.getContext("2d");t instanceof ImageData?s.putImageData(t,0,0):s.drawImage(t,0,0,t.width,t.height),e=ze}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const e=un("canvas");e.width=t.width,e.height=t.height;const s=e.getContext("2d");s.drawImage(t,0,0,t.width,t.height);const i=s.getImageData(0,0,t.width,t.height),n=i.data;for(let o=0;o<n.length;o++)n[o]=Ae(n[o]/255)*255;return s.putImageData(i,0,0),e}else if(t.data){const e=t.data.slice(0);for(let s=0;s<e.length;s++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[s]=Math.floor(Ae(e[s]/255)*255):e[s]=Ae(e[s]);return{data:e,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}class Ro{constructor(t=null){this.isSource=!0,this.uuid=Ut(),this.data=t,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const s={uuid:this.uuid,url:""},i=this.data;if(i!==null){let n;if(Array.isArray(i)){n=[];for(let o=0,a=i.length;o<a;o++)i[o].isDataTexture?n.push(oi(i[o].image)):n.push(oi(i[o]))}else n=oi(i);s.url=n}return e||(t.images[this.uuid]=s),s}}function oi(r){return typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap?Fo.getDataURL(r):r.data?{data:Array.from(r.data),width:r.width,height:r.height,type:r.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Io=0;class me extends hs{constructor(t=me.DEFAULT_IMAGE,e=me.DEFAULT_MAPPING,s=as,i=as,n=go,o=bo,a=vo,l=wo,h=me.DEFAULT_ANISOTROPY,u=Mo){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Io++}),this.uuid=Ut(),this.name="",this.source=new Ro(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=s,this.wrapT=i,this.magFilter=n,this.minFilter=o,this.anisotropy=h,this.format=a,this.internalFormat=null,this.type=l,this.offset=new _(0,0),this.repeat=new _(1,1),this.center=new _(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ht,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=u,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const s={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(s.userData=this.userData),e||(t.textures[this.uuid]=s),s}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==on)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case an:t.x=t.x-Math.floor(t.x);break;case as:t.x=t.x<0?0:1;break;case hn:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case an:t.y=t.y-Math.floor(t.y);break;case as:t.y=t.y<0?0:1;break;case hn:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}}me.DEFAULT_IMAGE=null,me.DEFAULT_MAPPING=on,me.DEFAULT_ANISOTROPY=1;class zt{constructor(t=0,e=0,s=0,i=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=s,this._w=i}static slerpFlat(t,e,s,i,n,o,a){let l=s[i+0],h=s[i+1],u=s[i+2],c=s[i+3];const p=n[o+0],f=n[o+1],d=n[o+2],m=n[o+3];if(a===0){t[e+0]=l,t[e+1]=h,t[e+2]=u,t[e+3]=c;return}if(a===1){t[e+0]=p,t[e+1]=f,t[e+2]=d,t[e+3]=m;return}if(c!==m||l!==p||h!==f||u!==d){let y=1-a;const b=l*p+h*f+u*d+c*m,M=b>=0?1:-1,w=1-b*b;if(w>Number.EPSILON){const z=Math.sqrt(w),F=Math.atan2(z,b*M);y=Math.sin(y*F)/z,a=Math.sin(a*F)/z}const v=a*M;if(l=l*y+p*v,h=h*y+f*v,u=u*y+d*v,c=c*y+m*v,y===1-a){const z=1/Math.sqrt(l*l+h*h+u*u+c*c);l*=z,h*=z,u*=z,c*=z}}t[e]=l,t[e+1]=h,t[e+2]=u,t[e+3]=c}static multiplyQuaternionsFlat(t,e,s,i,n,o){const a=s[i],l=s[i+1],h=s[i+2],u=s[i+3],c=n[o],p=n[o+1],f=n[o+2],d=n[o+3];return t[e]=a*d+u*c+l*f-h*p,t[e+1]=l*d+u*p+h*c-a*f,t[e+2]=h*d+u*f+a*p-l*c,t[e+3]=u*d-a*c-l*p-h*f,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,s,i){return this._x=t,this._y=e,this._z=s,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){const s=t._x,i=t._y,n=t._z,o=t._order,a=Math.cos,l=Math.sin,h=a(s/2),u=a(i/2),c=a(n/2),p=l(s/2),f=l(i/2),d=l(n/2);switch(o){case"XYZ":this._x=p*u*c+h*f*d,this._y=h*f*c-p*u*d,this._z=h*u*d+p*f*c,this._w=h*u*c-p*f*d;break;case"YXZ":this._x=p*u*c+h*f*d,this._y=h*f*c-p*u*d,this._z=h*u*d-p*f*c,this._w=h*u*c+p*f*d;break;case"ZXY":this._x=p*u*c-h*f*d,this._y=h*f*c+p*u*d,this._z=h*u*d+p*f*c,this._w=h*u*c-p*f*d;break;case"ZYX":this._x=p*u*c-h*f*d,this._y=h*f*c+p*u*d,this._z=h*u*d-p*f*c,this._w=h*u*c+p*f*d;break;case"YZX":this._x=p*u*c+h*f*d,this._y=h*f*c+p*u*d,this._z=h*u*d-p*f*c,this._w=h*u*c-p*f*d;break;case"XZY":this._x=p*u*c-h*f*d,this._y=h*f*c-p*u*d,this._z=h*u*d+p*f*c,this._w=h*u*c+p*f*d;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return e!==!1&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const s=e/2,i=Math.sin(s);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(s),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,s=e[0],i=e[4],n=e[8],o=e[1],a=e[5],l=e[9],h=e[2],u=e[6],c=e[10],p=s+a+c;if(p>0){const f=.5/Math.sqrt(p+1);this._w=.25/f,this._x=(u-l)*f,this._y=(n-h)*f,this._z=(o-i)*f}else if(s>a&&s>c){const f=2*Math.sqrt(1+s-a-c);this._w=(u-l)/f,this._x=.25*f,this._y=(i+o)/f,this._z=(n+h)/f}else if(a>c){const f=2*Math.sqrt(1+a-s-c);this._w=(n-h)/f,this._x=(i+o)/f,this._y=.25*f,this._z=(l+u)/f}else{const f=2*Math.sqrt(1+c-s-a);this._w=(o-i)/f,this._x=(n+h)/f,this._y=(l+u)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let s=t.dot(e)+1;return s<Number.EPSILON?(s=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=s):(this._x=0,this._y=-t.z,this._z=t.y,this._w=s)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=s),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(at(this.dot(t),-1,1)))}rotateTowards(t,e){const s=this.angleTo(t);if(s===0)return this;const i=Math.min(1,e/s);return this.slerp(t,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const s=t._x,i=t._y,n=t._z,o=t._w,a=e._x,l=e._y,h=e._z,u=e._w;return this._x=s*u+o*a+i*h-n*l,this._y=i*u+o*l+n*a-s*h,this._z=n*u+o*h+s*l-i*a,this._w=o*u-s*a-i*l-n*h,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);const s=this._x,i=this._y,n=this._z,o=this._w;let a=o*t._w+s*t._x+i*t._y+n*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=o,this._x=s,this._y=i,this._z=n,this;const l=1-a*a;if(l<=Number.EPSILON){const f=1-e;return this._w=f*o+e*this._w,this._x=f*s+e*this._x,this._y=f*i+e*this._y,this._z=f*n+e*this._z,this.normalize(),this._onChangeCallback(),this}const h=Math.sqrt(l),u=Math.atan2(h,a),c=Math.sin((1-e)*u)/h,p=Math.sin(e*u)/h;return this._w=o*c+this._w*p,this._x=s*c+this._x*p,this._y=i*c+this._y*p,this._z=n*c+this._z*p,this._onChangeCallback(),this}slerpQuaternions(t,e,s){return this.copy(t).slerp(e,s)}random(){const t=Math.random(),e=Math.sqrt(1-t),s=Math.sqrt(t),i=2*Math.PI*Math.random(),n=2*Math.PI*Math.random();return this.set(e*Math.cos(i),s*Math.sin(n),s*Math.cos(n),e*Math.sin(i))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class x{constructor(t=0,e=0,s=0){x.prototype.isVector3=!0,this.x=t,this.y=e,this.z=s}set(t,e,s){return s===void 0&&(s=this.z),this.x=t,this.y=e,this.z=s,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(cn.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(cn.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,s=this.y,i=this.z,n=t.elements;return this.x=n[0]*e+n[3]*s+n[6]*i,this.y=n[1]*e+n[4]*s+n[7]*i,this.z=n[2]*e+n[5]*s+n[8]*i,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,s=this.y,i=this.z,n=t.elements,o=1/(n[3]*e+n[7]*s+n[11]*i+n[15]);return this.x=(n[0]*e+n[4]*s+n[8]*i+n[12])*o,this.y=(n[1]*e+n[5]*s+n[9]*i+n[13])*o,this.z=(n[2]*e+n[6]*s+n[10]*i+n[14])*o,this}applyQuaternion(t){const e=this.x,s=this.y,i=this.z,n=t.x,o=t.y,a=t.z,l=t.w,h=l*e+o*i-a*s,u=l*s+a*e-n*i,c=l*i+n*s-o*e,p=-n*e-o*s-a*i;return this.x=h*l+p*-n+u*-a-c*-o,this.y=u*l+p*-o+c*-n-h*-a,this.z=c*l+p*-a+h*-o-u*-n,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,s=this.y,i=this.z,n=t.elements;return this.x=n[0]*e+n[4]*s+n[8]*i,this.y=n[1]*e+n[5]*s+n[9]*i,this.z=n[2]*e+n[6]*s+n[10]*i,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(t,Math.min(e,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,s){return this.x=t.x+(e.x-t.x)*s,this.y=t.y+(e.y-t.y)*s,this.z=t.z+(e.z-t.z)*s,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const s=t.x,i=t.y,n=t.z,o=e.x,a=e.y,l=e.z;return this.x=i*l-n*a,this.y=n*o-s*l,this.z=s*a-i*o,this}projectOnVector(t){const e=t.lengthSq();if(e===0)return this.set(0,0,0);const s=t.dot(this)/e;return this.copy(t).multiplyScalar(s)}projectOnPlane(t){return ai.copy(this).projectOnVector(t),this.sub(ai)}reflect(t){return this.sub(ai.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const s=this.dot(t)/e;return Math.acos(at(s,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,s=this.y-t.y,i=this.z-t.z;return e*e+s*s+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,s){const i=Math.sin(e)*t;return this.x=i*Math.sin(s),this.y=Math.cos(e)*t,this.z=i*Math.cos(s),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,s){return this.x=t*Math.sin(e),this.y=s,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),s=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=s,this.z=i,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=(Math.random()-.5)*2,e=Math.random()*Math.PI*2,s=Math.sqrt(1-t**2);return this.x=s*Math.cos(e),this.y=s*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const ai=new x,cn=new zt;class Tt{constructor(t=new x(1/0,1/0,1/0),e=new x(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,s=t.length;e<s;e+=3)this.expandByPoint(Jt.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,s=t.count;e<s;e++)this.expandByPoint(Jt.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,s=t.length;e<s;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const s=Jt.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(s),this.max.copy(t).add(s),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){if(t.updateWorldMatrix(!1,!1),t.boundingBox!==void 0)t.boundingBox===null&&t.computeBoundingBox(),Te.copy(t.boundingBox),Te.applyMatrix4(t.matrixWorld),this.union(Te);else{const i=t.geometry;if(i!==void 0)if(e&&i.attributes!==void 0&&i.attributes.position!==void 0){const n=i.attributes.position;for(let o=0,a=n.count;o<a;o++)Jt.fromBufferAttribute(n,o).applyMatrix4(t.matrixWorld),this.expandByPoint(Jt)}else i.boundingBox===null&&i.computeBoundingBox(),Te.copy(i.boundingBox),Te.applyMatrix4(t.matrixWorld),this.union(Te)}const s=t.children;for(let i=0,n=s.length;i<n;i++)this.expandByObject(s[i],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,Jt),Jt.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,s;return t.normal.x>0?(e=t.normal.x*this.min.x,s=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,s=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,s+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,s+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,s+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,s+=t.normal.z*this.min.z),e<=-t.constant&&s>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(He),us.subVectors(this.max,He),_e.subVectors(t.a,He),Be.subVectors(t.b,He),Ee.subVectors(t.c,He),se.subVectors(Be,_e),ie.subVectors(Ee,Be),ye.subVectors(_e,Ee);let e=[0,-se.z,se.y,0,-ie.z,ie.y,0,-ye.z,ye.y,se.z,0,-se.x,ie.z,0,-ie.x,ye.z,0,-ye.x,-se.y,se.x,0,-ie.y,ie.x,0,-ye.y,ye.x,0];return!hi(e,_e,Be,Ee,us)||(e=[1,0,0,0,1,0,0,0,1],!hi(e,_e,Be,Ee,us))?!1:(cs.crossVectors(se,ie),e=[cs.x,cs.y,cs.z],hi(e,_e,Be,Ee,us))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,Jt).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=this.getSize(Jt).length()*.5),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(Gt[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Gt[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Gt[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Gt[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Gt[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Gt[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Gt[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Gt[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Gt),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const Gt=[new x,new x,new x,new x,new x,new x,new x,new x],Jt=new x,Te=new Tt,_e=new x,Be=new x,Ee=new x,se=new x,ie=new x,ye=new x,He=new x,us=new x,cs=new x,xe=new x;function hi(r,t,e,s,i){for(let n=0,o=r.length-3;n<=o;n+=3){xe.fromArray(r,n);const a=i.x*Math.abs(xe.x)+i.y*Math.abs(xe.y)+i.z*Math.abs(xe.z),l=t.dot(xe),h=e.dot(xe),u=s.dot(xe);if(Math.max(-Math.max(l,h,u),Math.min(l,h,u))>a)return!1}return!0}const No=new Tt,Ge=new x,li=new x;class Je{constructor(t=new x,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const s=this.center;e!==void 0?s.copy(e):No.setFromPoints(t).getCenter(s);let i=0;for(let n=0,o=t.length;n<o;n++)i=Math.max(i,s.distanceToSquared(t[n]));return this.radius=Math.sqrt(i),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const s=this.center.distanceToSquared(t);return e.copy(t),s>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;Ge.subVectors(t,this.center);const e=Ge.lengthSq();if(e>this.radius*this.radius){const s=Math.sqrt(e),i=(s-this.radius)*.5;this.center.addScaledVector(Ge,i/s),this.radius+=i}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?this.radius=Math.max(this.radius,t.radius):(li.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(Ge.copy(t.center).add(li)),this.expandByPoint(Ge.copy(t.center).sub(li))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Wt=new x,ui=new x,ps=new x,ne=new x,ci=new x,fs=new x,pi=new x;class fi{constructor(t=new x,e=new x(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,Wt)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const s=e.dot(this.direction);return s<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,s)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=Wt.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Wt.copy(this.origin).addScaledVector(this.direction,e),Wt.distanceToSquared(t))}distanceSqToSegment(t,e,s,i){ui.copy(t).add(e).multiplyScalar(.5),ps.copy(e).sub(t).normalize(),ne.copy(this.origin).sub(ui);const n=t.distanceTo(e)*.5,o=-this.direction.dot(ps),a=ne.dot(this.direction),l=-ne.dot(ps),h=ne.lengthSq(),u=Math.abs(1-o*o);let c,p,f,d;if(u>0)if(c=o*l-a,p=o*a-l,d=n*u,c>=0)if(p>=-d)if(p<=d){const m=1/u;c*=m,p*=m,f=c*(c+o*p+2*a)+p*(o*c+p+2*l)+h}else p=n,c=Math.max(0,-(o*p+a)),f=-c*c+p*(p+2*l)+h;else p=-n,c=Math.max(0,-(o*p+a)),f=-c*c+p*(p+2*l)+h;else p<=-d?(c=Math.max(0,-(-o*n+a)),p=c>0?-n:Math.min(Math.max(-n,-l),n),f=-c*c+p*(p+2*l)+h):p<=d?(c=0,p=Math.min(Math.max(-n,-l),n),f=p*(p+2*l)+h):(c=Math.max(0,-(o*n+a)),p=c>0?n:Math.min(Math.max(-n,-l),n),f=-c*c+p*(p+2*l)+h);else p=o>0?-n:n,c=Math.max(0,-(o*p+a)),f=-c*c+p*(p+2*l)+h;return s&&s.copy(this.origin).addScaledVector(this.direction,c),i&&i.copy(ui).addScaledVector(ps,p),f}intersectSphere(t,e){Wt.subVectors(t.center,this.origin);const s=Wt.dot(this.direction),i=Wt.dot(Wt)-s*s,n=t.radius*t.radius;if(i>n)return null;const o=Math.sqrt(n-i),a=s-o,l=s+o;return l<0?null:a<0?this.at(l,e):this.at(a,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(e===0)return t.distanceToPoint(this.origin)===0?0:null;const s=-(this.origin.dot(t.normal)+t.constant)/e;return s>=0?s:null}intersectPlane(t,e){const s=this.distanceToPlane(t);return s===null?null:this.at(s,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return e===0||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let s,i,n,o,a,l;const h=1/this.direction.x,u=1/this.direction.y,c=1/this.direction.z,p=this.origin;return h>=0?(s=(t.min.x-p.x)*h,i=(t.max.x-p.x)*h):(s=(t.max.x-p.x)*h,i=(t.min.x-p.x)*h),u>=0?(n=(t.min.y-p.y)*u,o=(t.max.y-p.y)*u):(n=(t.max.y-p.y)*u,o=(t.min.y-p.y)*u),s>o||n>i||((n>s||isNaN(s))&&(s=n),(o<i||isNaN(i))&&(i=o),c>=0?(a=(t.min.z-p.z)*c,l=(t.max.z-p.z)*c):(a=(t.max.z-p.z)*c,l=(t.min.z-p.z)*c),s>l||a>i)||((a>s||s!==s)&&(s=a),(l<i||i!==i)&&(i=l),i<0)?null:this.at(s>=0?s:i,e)}intersectsBox(t){return this.intersectBox(t,Wt)!==null}intersectTriangle(t,e,s,i,n){ci.subVectors(e,t),fs.subVectors(s,t),pi.crossVectors(ci,fs);let o=this.direction.dot(pi),a;if(o>0){if(i)return null;a=1}else if(o<0)a=-1,o=-o;else return null;ne.subVectors(this.origin,t);const l=a*this.direction.dot(fs.crossVectors(ne,fs));if(l<0)return null;const h=a*this.direction.dot(ci.cross(ne));if(h<0||l+h>o)return null;const u=-a*ne.dot(pi);return u<0?null:this.at(u/o,n)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class K{constructor(){K.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(t,e,s,i,n,o,a,l,h,u,c,p,f,d,m,y){const b=this.elements;return b[0]=t,b[4]=e,b[8]=s,b[12]=i,b[1]=n,b[5]=o,b[9]=a,b[13]=l,b[2]=h,b[6]=u,b[10]=c,b[14]=p,b[3]=f,b[7]=d,b[11]=m,b[15]=y,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new K().fromArray(this.elements)}copy(t){const e=this.elements,s=t.elements;return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e[4]=s[4],e[5]=s[5],e[6]=s[6],e[7]=s[7],e[8]=s[8],e[9]=s[9],e[10]=s[10],e[11]=s[11],e[12]=s[12],e[13]=s[13],e[14]=s[14],e[15]=s[15],this}copyPosition(t){const e=this.elements,s=t.elements;return e[12]=s[12],e[13]=s[13],e[14]=s[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,s){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),s.setFromMatrixColumn(this,2),this}makeBasis(t,e,s){return this.set(t.x,e.x,s.x,0,t.y,e.y,s.y,0,t.z,e.z,s.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,s=t.elements,i=1/Ce.setFromMatrixColumn(t,0).length(),n=1/Ce.setFromMatrixColumn(t,1).length(),o=1/Ce.setFromMatrixColumn(t,2).length();return e[0]=s[0]*i,e[1]=s[1]*i,e[2]=s[2]*i,e[3]=0,e[4]=s[4]*n,e[5]=s[5]*n,e[6]=s[6]*n,e[7]=0,e[8]=s[8]*o,e[9]=s[9]*o,e[10]=s[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,s=t.x,i=t.y,n=t.z,o=Math.cos(s),a=Math.sin(s),l=Math.cos(i),h=Math.sin(i),u=Math.cos(n),c=Math.sin(n);if(t.order==="XYZ"){const p=o*u,f=o*c,d=a*u,m=a*c;e[0]=l*u,e[4]=-l*c,e[8]=h,e[1]=f+d*h,e[5]=p-m*h,e[9]=-a*l,e[2]=m-p*h,e[6]=d+f*h,e[10]=o*l}else if(t.order==="YXZ"){const p=l*u,f=l*c,d=h*u,m=h*c;e[0]=p+m*a,e[4]=d*a-f,e[8]=o*h,e[1]=o*c,e[5]=o*u,e[9]=-a,e[2]=f*a-d,e[6]=m+p*a,e[10]=o*l}else if(t.order==="ZXY"){const p=l*u,f=l*c,d=h*u,m=h*c;e[0]=p-m*a,e[4]=-o*c,e[8]=d+f*a,e[1]=f+d*a,e[5]=o*u,e[9]=m-p*a,e[2]=-o*h,e[6]=a,e[10]=o*l}else if(t.order==="ZYX"){const p=o*u,f=o*c,d=a*u,m=a*c;e[0]=l*u,e[4]=d*h-f,e[8]=p*h+m,e[1]=l*c,e[5]=m*h+p,e[9]=f*h-d,e[2]=-h,e[6]=a*l,e[10]=o*l}else if(t.order==="YZX"){const p=o*l,f=o*h,d=a*l,m=a*h;e[0]=l*u,e[4]=m-p*c,e[8]=d*c+f,e[1]=c,e[5]=o*u,e[9]=-a*u,e[2]=-h*u,e[6]=f*c+d,e[10]=p-m*c}else if(t.order==="XZY"){const p=o*l,f=o*h,d=a*l,m=a*h;e[0]=l*u,e[4]=-c,e[8]=h*u,e[1]=p*c+m,e[5]=o*u,e[9]=f*c-d,e[2]=d*c-f,e[6]=a*u,e[10]=m*c+p}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Do,t,Lo)}lookAt(t,e,s){const i=this.elements;return gt.subVectors(t,e),gt.lengthSq()===0&&(gt.z=1),gt.normalize(),re.crossVectors(s,gt),re.lengthSq()===0&&(Math.abs(s.z)===1?gt.x+=1e-4:gt.z+=1e-4,gt.normalize(),re.crossVectors(s,gt)),re.normalize(),ds.crossVectors(gt,re),i[0]=re.x,i[4]=ds.x,i[8]=gt.x,i[1]=re.y,i[5]=ds.y,i[9]=gt.y,i[2]=re.z,i[6]=ds.z,i[10]=gt.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const s=t.elements,i=e.elements,n=this.elements,o=s[0],a=s[4],l=s[8],h=s[12],u=s[1],c=s[5],p=s[9],f=s[13],d=s[2],m=s[6],y=s[10],b=s[14],M=s[3],w=s[7],v=s[11],z=s[15],F=i[0],T=i[4],$=i[8],Z=i[12],L=i[1],g=i[5],S=i[9],A=i[13],B=i[2],C=i[6],k=i[10],V=i[14],H=i[3],D=i[7],R=i[11],U=i[15];return n[0]=o*F+a*L+l*B+h*H,n[4]=o*T+a*g+l*C+h*D,n[8]=o*$+a*S+l*k+h*R,n[12]=o*Z+a*A+l*V+h*U,n[1]=u*F+c*L+p*B+f*H,n[5]=u*T+c*g+p*C+f*D,n[9]=u*$+c*S+p*k+f*R,n[13]=u*Z+c*A+p*V+f*U,n[2]=d*F+m*L+y*B+b*H,n[6]=d*T+m*g+y*C+b*D,n[10]=d*$+m*S+y*k+b*R,n[14]=d*Z+m*A+y*V+b*U,n[3]=M*F+w*L+v*B+z*H,n[7]=M*T+w*g+v*C+z*D,n[11]=M*$+w*S+v*k+z*R,n[15]=M*Z+w*A+v*V+z*U,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],s=t[4],i=t[8],n=t[12],o=t[1],a=t[5],l=t[9],h=t[13],u=t[2],c=t[6],p=t[10],f=t[14],d=t[3],m=t[7],y=t[11],b=t[15];return d*(+n*l*c-i*h*c-n*a*p+s*h*p+i*a*f-s*l*f)+m*(+e*l*f-e*h*p+n*o*p-i*o*f+i*h*u-n*l*u)+y*(+e*h*c-e*a*f-n*o*c+s*o*f+n*a*u-s*h*u)+b*(-i*a*u-e*l*c+e*a*p+i*o*c-s*o*p+s*l*u)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,s){const i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=e,i[14]=s),this}invert(){const t=this.elements,e=t[0],s=t[1],i=t[2],n=t[3],o=t[4],a=t[5],l=t[6],h=t[7],u=t[8],c=t[9],p=t[10],f=t[11],d=t[12],m=t[13],y=t[14],b=t[15],M=c*y*h-m*p*h+m*l*f-a*y*f-c*l*b+a*p*b,w=d*p*h-u*y*h-d*l*f+o*y*f+u*l*b-o*p*b,v=u*m*h-d*c*h+d*a*f-o*m*f-u*a*b+o*c*b,z=d*c*l-u*m*l-d*a*p+o*m*p+u*a*y-o*c*y,F=e*M+s*w+i*v+n*z;if(F===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const T=1/F;return t[0]=M*T,t[1]=(m*p*n-c*y*n-m*i*f+s*y*f+c*i*b-s*p*b)*T,t[2]=(a*y*n-m*l*n+m*i*h-s*y*h-a*i*b+s*l*b)*T,t[3]=(c*l*n-a*p*n-c*i*h+s*p*h+a*i*f-s*l*f)*T,t[4]=w*T,t[5]=(u*y*n-d*p*n+d*i*f-e*y*f-u*i*b+e*p*b)*T,t[6]=(d*l*n-o*y*n-d*i*h+e*y*h+o*i*b-e*l*b)*T,t[7]=(o*p*n-u*l*n+u*i*h-e*p*h-o*i*f+e*l*f)*T,t[8]=v*T,t[9]=(d*c*n-u*m*n-d*s*f+e*m*f+u*s*b-e*c*b)*T,t[10]=(o*m*n-d*a*n+d*s*h-e*m*h-o*s*b+e*a*b)*T,t[11]=(u*a*n-o*c*n-u*s*h+e*c*h+o*s*f-e*a*f)*T,t[12]=z*T,t[13]=(u*m*i-d*c*i+d*s*p-e*m*p-u*s*y+e*c*y)*T,t[14]=(d*a*i-o*m*i-d*s*l+e*m*l+o*s*y-e*a*y)*T,t[15]=(o*c*i-u*a*i+u*s*l-e*c*l-o*s*p+e*a*p)*T,this}scale(t){const e=this.elements,s=t.x,i=t.y,n=t.z;return e[0]*=s,e[4]*=i,e[8]*=n,e[1]*=s,e[5]*=i,e[9]*=n,e[2]*=s,e[6]*=i,e[10]*=n,e[3]*=s,e[7]*=i,e[11]*=n,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],s=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,s,i))}makeTranslation(t,e,s){return this.set(1,0,0,t,0,1,0,e,0,0,1,s,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),s=Math.sin(t);return this.set(1,0,0,0,0,e,-s,0,0,s,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),s=Math.sin(t);return this.set(e,0,s,0,0,1,0,0,-s,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),s=Math.sin(t);return this.set(e,-s,0,0,s,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const s=Math.cos(e),i=Math.sin(e),n=1-s,o=t.x,a=t.y,l=t.z,h=n*o,u=n*a;return this.set(h*o+s,h*a-i*l,h*l+i*a,0,h*a+i*l,u*a+s,u*l-i*o,0,h*l-i*a,u*l+i*o,n*l*l+s,0,0,0,0,1),this}makeScale(t,e,s){return this.set(t,0,0,0,0,e,0,0,0,0,s,0,0,0,0,1),this}makeShear(t,e,s,i,n,o){return this.set(1,s,n,0,t,1,o,0,e,i,1,0,0,0,0,1),this}compose(t,e,s){const i=this.elements,n=e._x,o=e._y,a=e._z,l=e._w,h=n+n,u=o+o,c=a+a,p=n*h,f=n*u,d=n*c,m=o*u,y=o*c,b=a*c,M=l*h,w=l*u,v=l*c,z=s.x,F=s.y,T=s.z;return i[0]=(1-(m+b))*z,i[1]=(f+v)*z,i[2]=(d-w)*z,i[3]=0,i[4]=(f-v)*F,i[5]=(1-(p+b))*F,i[6]=(y+M)*F,i[7]=0,i[8]=(d+w)*T,i[9]=(y-M)*T,i[10]=(1-(p+m))*T,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this}decompose(t,e,s){const i=this.elements;let n=Ce.set(i[0],i[1],i[2]).length();const o=Ce.set(i[4],i[5],i[6]).length(),a=Ce.set(i[8],i[9],i[10]).length();this.determinant()<0&&(n=-n),t.x=i[12],t.y=i[13],t.z=i[14],_t.copy(this);const h=1/n,u=1/o,c=1/a;return _t.elements[0]*=h,_t.elements[1]*=h,_t.elements[2]*=h,_t.elements[4]*=u,_t.elements[5]*=u,_t.elements[6]*=u,_t.elements[8]*=c,_t.elements[9]*=c,_t.elements[10]*=c,e.setFromRotationMatrix(_t),s.x=n,s.y=o,s.z=a,this}makePerspective(t,e,s,i,n,o){const a=this.elements,l=2*n/(e-t),h=2*n/(s-i),u=(e+t)/(e-t),c=(s+i)/(s-i),p=-(o+n)/(o-n),f=-2*o*n/(o-n);return a[0]=l,a[4]=0,a[8]=u,a[12]=0,a[1]=0,a[5]=h,a[9]=c,a[13]=0,a[2]=0,a[6]=0,a[10]=p,a[14]=f,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(t,e,s,i,n,o){const a=this.elements,l=1/(e-t),h=1/(s-i),u=1/(o-n),c=(e+t)*l,p=(s+i)*h,f=(o+n)*u;return a[0]=2*l,a[4]=0,a[8]=0,a[12]=-c,a[1]=0,a[5]=2*h,a[9]=0,a[13]=-p,a[2]=0,a[6]=0,a[10]=-2*u,a[14]=-f,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(t){const e=this.elements,s=t.elements;for(let i=0;i<16;i++)if(e[i]!==s[i])return!1;return!0}fromArray(t,e=0){for(let s=0;s<16;s++)this.elements[s]=t[s+e];return this}toArray(t=[],e=0){const s=this.elements;return t[e]=s[0],t[e+1]=s[1],t[e+2]=s[2],t[e+3]=s[3],t[e+4]=s[4],t[e+5]=s[5],t[e+6]=s[6],t[e+7]=s[7],t[e+8]=s[8],t[e+9]=s[9],t[e+10]=s[10],t[e+11]=s[11],t[e+12]=s[12],t[e+13]=s[13],t[e+14]=s[14],t[e+15]=s[15],t}}const Ce=new x,_t=new K,Do=new x(0,0,0),Lo=new x(1,1,1),re=new x,ds=new x,gt=new x,pn=new K,fn=new zt;class We{constructor(t=0,e=0,s=0,i=We.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=s,this._order=i}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,s,i=this._order){return this._x=t,this._y=e,this._z=s,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,s=!0){const i=t.elements,n=i[0],o=i[4],a=i[8],l=i[1],h=i[5],u=i[9],c=i[2],p=i[6],f=i[10];switch(e){case"XYZ":this._y=Math.asin(at(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,f),this._z=Math.atan2(-o,n)):(this._x=Math.atan2(p,h),this._z=0);break;case"YXZ":this._x=Math.asin(-at(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,f),this._z=Math.atan2(l,h)):(this._y=Math.atan2(-c,n),this._z=0);break;case"ZXY":this._x=Math.asin(at(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(-c,f),this._z=Math.atan2(-o,h)):(this._y=0,this._z=Math.atan2(l,n));break;case"ZYX":this._y=Math.asin(-at(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(p,f),this._z=Math.atan2(l,n)):(this._x=0,this._z=Math.atan2(-o,h));break;case"YZX":this._z=Math.asin(at(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,h),this._y=Math.atan2(-c,n)):(this._x=0,this._y=Math.atan2(a,f));break;case"XZY":this._z=Math.asin(-at(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(p,h),this._y=Math.atan2(a,n)):(this._x=Math.atan2(-u,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,s===!0&&this._onChangeCallback(),this}setFromQuaternion(t,e,s){return pn.makeRotationFromQuaternion(t),this.setFromRotationMatrix(pn,e,s)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return fn.setFromEuler(this),this.setFromQuaternion(fn,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}We.DEFAULT_ORDER="XYZ";class $o{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}}let Vo=0;const dn=new x,Pe=new zt,Zt=new K,ms=new x,Ze=new x,qo=new x,Uo=new zt,mn=new x(1,0,0),yn=new x(0,1,0),xn=new x(0,0,1),Ho={type:"added"},gn={type:"removed"};class lt extends hs{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Vo++}),this.uuid=Ut(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=lt.DEFAULT_UP.clone();const t=new x,e=new We,s=new zt,i=new x(1,1,1);function n(){s.setFromEuler(e,!1)}function o(){e.setFromQuaternion(s,void 0,!1)}e._onChange(n),s._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:s},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new K},normalMatrix:{value:new Ht}}),this.matrix=new K,this.matrixWorld=new K,this.matrixAutoUpdate=lt.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=lt.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new $o,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return Pe.setFromAxisAngle(t,e),this.quaternion.multiply(Pe),this}rotateOnWorldAxis(t,e){return Pe.setFromAxisAngle(t,e),this.quaternion.premultiply(Pe),this}rotateX(t){return this.rotateOnAxis(mn,t)}rotateY(t){return this.rotateOnAxis(yn,t)}rotateZ(t){return this.rotateOnAxis(xn,t)}translateOnAxis(t,e){return dn.copy(t).applyQuaternion(this.quaternion),this.position.add(dn.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(mn,t)}translateY(t){return this.translateOnAxis(yn,t)}translateZ(t){return this.translateOnAxis(xn,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(Zt.copy(this.matrixWorld).invert())}lookAt(t,e,s){t.isVector3?ms.copy(t):ms.set(t,e,s);const i=this.parent;this.updateWorldMatrix(!0,!1),Ze.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Zt.lookAt(Ze,ms,this.up):Zt.lookAt(ms,Ze,this.up),this.quaternion.setFromRotationMatrix(Zt),i&&(Zt.extractRotation(i.matrixWorld),Pe.setFromRotationMatrix(Zt),this.quaternion.premultiply(Pe.invert()))}add(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.parent!==null&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(Ho)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let s=0;s<arguments.length;s++)this.remove(arguments[s]);return this}const e=this.children.indexOf(t);return e!==-1&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(gn)),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(gn)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),Zt.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),Zt.multiply(t.parent.matrixWorld)),t.applyMatrix4(Zt),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let s=0,i=this.children.length;s<i;s++){const o=this.children[s].getObjectByProperty(t,e);if(o!==void 0)return o}}getObjectsByProperty(t,e){let s=[];this[t]===e&&s.push(this);for(let i=0,n=this.children.length;i<n;i++){const o=this.children[i].getObjectsByProperty(t,e);o.length>0&&(s=s.concat(o))}return s}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ze,t,qo),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ze,Uo,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let s=0,i=e.length;s<i;s++)e[s].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const e=this.children;for(let s=0,i=e.length;s<i;s++)e[s].traverseVisible(t)}traverseAncestors(t){const e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let s=0,i=e.length;s<i;s++){const n=e[s];(n.matrixWorldAutoUpdate===!0||t===!0)&&n.updateMatrixWorld(t)}}updateWorldMatrix(t,e){const s=this.parent;if(t===!0&&s!==null&&s.matrixWorldAutoUpdate===!0&&s.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),e===!0){const i=this.children;for(let n=0,o=i.length;n<o;n++){const a=i[n];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(t){const e=t===void 0||typeof t=="string",s={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},s.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON()));function n(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(t)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=n(t.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let h=0,u=l.length;h<u;h++){const c=l[h];n(t.shapes,c)}else n(t.shapes,l)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(n(t.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,h=this.material.length;l<h;l++)a.push(n(t.materials,this.material[l]));i.material=a}else i.material=n(t.materials,this.material);if(this.children.length>0){i.children=[];for(let a=0;a<this.children.length;a++)i.children.push(this.children[a].toJSON(t).object)}if(this.animations.length>0){i.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];i.animations.push(n(t.animations,l))}}if(e){const a=o(t.geometries),l=o(t.materials),h=o(t.textures),u=o(t.images),c=o(t.shapes),p=o(t.skeletons),f=o(t.animations),d=o(t.nodes);a.length>0&&(s.geometries=a),l.length>0&&(s.materials=l),h.length>0&&(s.textures=h),u.length>0&&(s.images=u),c.length>0&&(s.shapes=c),p.length>0&&(s.skeletons=p),f.length>0&&(s.animations=f),d.length>0&&(s.nodes=d)}return s.object=i,s;function o(a){const l=[];for(const h in a){const u=a[h];delete u.metadata,l.push(u)}return l}}clone(t){return new this.constructor().copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(let s=0;s<t.children.length;s++){const i=t.children[s];this.add(i.clone())}return this}}lt.DEFAULT_UP=new x(0,1,0),lt.DEFAULT_MATRIX_AUTO_UPDATE=!0,lt.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Bt=new x,Xt=new x,di=new x,Yt=new x,ke=new x,Oe=new x,bn=new x,mi=new x,yi=new x,xi=new x;let ys=!1;class bt{constructor(t=new x,e=new x,s=new x){this.a=t,this.b=e,this.c=s}static getNormal(t,e,s,i){i.subVectors(s,e),Bt.subVectors(t,e),i.cross(Bt);const n=i.lengthSq();return n>0?i.multiplyScalar(1/Math.sqrt(n)):i.set(0,0,0)}static getBarycoord(t,e,s,i,n){Bt.subVectors(i,e),Xt.subVectors(s,e),di.subVectors(t,e);const o=Bt.dot(Bt),a=Bt.dot(Xt),l=Bt.dot(di),h=Xt.dot(Xt),u=Xt.dot(di),c=o*h-a*a;if(c===0)return n.set(-2,-1,-1);const p=1/c,f=(h*l-a*u)*p,d=(o*u-a*l)*p;return n.set(1-f-d,d,f)}static containsPoint(t,e,s,i){return this.getBarycoord(t,e,s,i,Yt),Yt.x>=0&&Yt.y>=0&&Yt.x+Yt.y<=1}static getUV(t,e,s,i,n,o,a,l){return ys===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),ys=!0),this.getInterpolation(t,e,s,i,n,o,a,l)}static getInterpolation(t,e,s,i,n,o,a,l){return this.getBarycoord(t,e,s,i,Yt),l.setScalar(0),l.addScaledVector(n,Yt.x),l.addScaledVector(o,Yt.y),l.addScaledVector(a,Yt.z),l}static isFrontFacing(t,e,s,i){return Bt.subVectors(s,e),Xt.subVectors(t,e),Bt.cross(Xt).dot(i)<0}set(t,e,s){return this.a.copy(t),this.b.copy(e),this.c.copy(s),this}setFromPointsAndIndices(t,e,s,i){return this.a.copy(t[e]),this.b.copy(t[s]),this.c.copy(t[i]),this}setFromAttributeAndIndices(t,e,s,i){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,s),this.c.fromBufferAttribute(t,i),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Bt.subVectors(this.c,this.b),Xt.subVectors(this.a,this.b),Bt.cross(Xt).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return bt.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return bt.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,s,i,n){return ys===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),ys=!0),bt.getInterpolation(t,this.a,this.b,this.c,e,s,i,n)}getInterpolation(t,e,s,i,n){return bt.getInterpolation(t,this.a,this.b,this.c,e,s,i,n)}containsPoint(t){return bt.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return bt.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const s=this.a,i=this.b,n=this.c;let o,a;ke.subVectors(i,s),Oe.subVectors(n,s),mi.subVectors(t,s);const l=ke.dot(mi),h=Oe.dot(mi);if(l<=0&&h<=0)return e.copy(s);yi.subVectors(t,i);const u=ke.dot(yi),c=Oe.dot(yi);if(u>=0&&c<=u)return e.copy(i);const p=l*c-u*h;if(p<=0&&l>=0&&u<=0)return o=l/(l-u),e.copy(s).addScaledVector(ke,o);xi.subVectors(t,n);const f=ke.dot(xi),d=Oe.dot(xi);if(d>=0&&f<=d)return e.copy(n);const m=f*h-l*d;if(m<=0&&h>=0&&d<=0)return a=h/(h-d),e.copy(s).addScaledVector(Oe,a);const y=u*d-f*c;if(y<=0&&c-u>=0&&f-d>=0)return bn.subVectors(n,i),a=(c-u)/(c-u+(f-d)),e.copy(i).addScaledVector(bn,a);const b=1/(y+m+p);return o=m*b,a=p*b,e.copy(s).addScaledVector(ke,o).addScaledVector(Oe,a)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}let Go=0;class gi extends hs{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Go++}),this.uuid=Ut(),this.name="",this.type="Material",this.blending=rn,this.side=Ks,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=fo,this.blendDst=mo,this.blendEquation=po,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=yo,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=So,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ei,this.stencilZFail=ei,this.stencilZPass=ei,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(const e in t){const s=t[e];if(s===void 0){console.warn(`THREE.Material: parameter '${e}' has value of undefined.`);continue}const i=this[e];if(i===void 0){console.warn(`THREE.Material: '${e}' is not a property of THREE.${this.type}.`);continue}i&&i.isColor?i.set(s):i&&i.isVector3&&s&&s.isVector3?i.copy(s):this[e]=s}}toJSON(t){const e=t===void 0||typeof t=="string";e&&(t={textures:{},images:{}});const s={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.color&&this.color.isColor&&(s.color=this.color.getHex()),this.roughness!==void 0&&(s.roughness=this.roughness),this.metalness!==void 0&&(s.metalness=this.metalness),this.sheen!==void 0&&(s.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(s.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(s.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(s.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(s.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(s.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(s.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(s.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(s.shininess=this.shininess),this.clearcoat!==void 0&&(s.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(s.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(s.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(s.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(s.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,s.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(s.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(s.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(s.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(s.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(s.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(s.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(s.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(s.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(s.lightMap=this.lightMap.toJSON(t).uuid,s.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(s.aoMap=this.aoMap.toJSON(t).uuid,s.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(s.bumpMap=this.bumpMap.toJSON(t).uuid,s.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(s.normalMap=this.normalMap.toJSON(t).uuid,s.normalMapType=this.normalMapType,s.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(s.displacementMap=this.displacementMap.toJSON(t).uuid,s.displacementScale=this.displacementScale,s.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(s.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(s.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(s.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(s.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(s.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(s.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(s.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(s.combine=this.combine)),this.envMapIntensity!==void 0&&(s.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(s.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(s.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(s.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(s.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(s.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(s.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(s.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(s.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(s.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(s.size=this.size),this.shadowSide!==null&&(s.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(s.sizeAttenuation=this.sizeAttenuation),this.blending!==rn&&(s.blending=this.blending),this.side!==Ks&&(s.side=this.side),this.vertexColors&&(s.vertexColors=!0),this.opacity<1&&(s.opacity=this.opacity),this.transparent===!0&&(s.transparent=this.transparent),s.depthFunc=this.depthFunc,s.depthTest=this.depthTest,s.depthWrite=this.depthWrite,s.colorWrite=this.colorWrite,s.stencilWrite=this.stencilWrite,s.stencilWriteMask=this.stencilWriteMask,s.stencilFunc=this.stencilFunc,s.stencilRef=this.stencilRef,s.stencilFuncMask=this.stencilFuncMask,s.stencilFail=this.stencilFail,s.stencilZFail=this.stencilZFail,s.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(s.rotation=this.rotation),this.polygonOffset===!0&&(s.polygonOffset=!0),this.polygonOffsetFactor!==0&&(s.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(s.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(s.linewidth=this.linewidth),this.dashSize!==void 0&&(s.dashSize=this.dashSize),this.gapSize!==void 0&&(s.gapSize=this.gapSize),this.scale!==void 0&&(s.scale=this.scale),this.dithering===!0&&(s.dithering=!0),this.alphaTest>0&&(s.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(s.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(s.premultipliedAlpha=this.premultipliedAlpha),this.forceSinglePass===!0&&(s.forceSinglePass=this.forceSinglePass),this.wireframe===!0&&(s.wireframe=this.wireframe),this.wireframeLinewidth>1&&(s.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(s.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(s.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(s.flatShading=this.flatShading),this.visible===!1&&(s.visible=!1),this.toneMapped===!1&&(s.toneMapped=!1),this.fog===!1&&(s.fog=!1),Object.keys(this.userData).length>0&&(s.userData=this.userData);function i(n){const o=[];for(const a in n){const l=n[a];delete l.metadata,o.push(l)}return o}if(e){const n=i(t.textures),o=i(t.images);n.length>0&&(s.textures=n),o.length>0&&(s.images=o)}return s}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let s=null;if(e!==null){const i=e.length;s=new Array(i);for(let n=0;n!==i;++n)s[n]=e[n].clone()}return this.clippingPlanes=s,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}}const wn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Et={h:0,s:0,l:0},xs={h:0,s:0,l:0};function bi(r,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?r+(t-r)*6*e:e<1/2?t:e<2/3?r+(t-r)*6*(2/3-e):r}class Ct{constructor(t,e,s){return this.isColor=!0,this.r=1,this.g=1,this.b=1,e===void 0&&s===void 0?this.set(t):this.setRGB(t,e,s)}set(t){return t&&t.isColor?this.copy(t):typeof t=="number"?this.setHex(t):typeof t=="string"&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=qt){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,xt.toWorkingColorSpace(this,e),this}setRGB(t,e,s,i=xt.workingColorSpace){return this.r=t,this.g=e,this.b=s,xt.toWorkingColorSpace(this,i),this}setHSL(t,e,s,i=xt.workingColorSpace){if(t=zo(t,1),e=at(e,0,1),s=at(s,0,1),e===0)this.r=this.g=this.b=s;else{const n=s<=.5?s*(1+e):s+e-s*e,o=2*s-n;this.r=bi(o,n,t+1/3),this.g=bi(o,n,t),this.b=bi(o,n,t-1/3)}return xt.toWorkingColorSpace(this,i),this}setStyle(t,e=qt){function s(n){n!==void 0&&parseFloat(n)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(t)){let n;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(n=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,xt.toWorkingColorSpace(this,e),s(n[4]),this;if(n=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,xt.toWorkingColorSpace(this,e),s(n[4]),this;break;case"hsl":case"hsla":if(n=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a)){const l=parseFloat(n[1])/360,h=parseFloat(n[2])/100,u=parseFloat(n[3])/100;return s(n[4]),this.setHSL(l,h,u,e)}break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const n=i[1],o=n.length;if(o===3)return this.setRGB(parseInt(n.charAt(0),16)/15,parseInt(n.charAt(1),16)/15,parseInt(n.charAt(2),16)/15,e);if(o===6)return this.setHex(parseInt(n,16),e);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=qt){const s=wn[t.toLowerCase()];return s!==void 0?this.setHex(s,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Ae(t.r),this.g=Ae(t.g),this.b=Ae(t.b),this}copyLinearToSRGB(t){return this.r=ri(t.r),this.g=ri(t.g),this.b=ri(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=qt){return xt.fromWorkingColorSpace(ht.copy(this),t),at(ht.r*255,0,255)<<16^at(ht.g*255,0,255)<<8^at(ht.b*255,0,255)<<0}getHexString(t=qt){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=xt.workingColorSpace){xt.fromWorkingColorSpace(ht.copy(this),e);const s=ht.r,i=ht.g,n=ht.b,o=Math.max(s,i,n),a=Math.min(s,i,n);let l,h;const u=(a+o)/2;if(a===o)l=0,h=0;else{const c=o-a;switch(h=u<=.5?c/(o+a):c/(2-o-a),o){case s:l=(i-n)/c+(i<n?6:0);break;case i:l=(n-s)/c+2;break;case n:l=(s-i)/c+4;break}l/=6}return t.h=l,t.s=h,t.l=u,t}getRGB(t,e=xt.workingColorSpace){return xt.fromWorkingColorSpace(ht.copy(this),e),t.r=ht.r,t.g=ht.g,t.b=ht.b,t}getStyle(t=qt){xt.fromWorkingColorSpace(ht.copy(this),t);const e=ht.r,s=ht.g,i=ht.b;return t!==qt?`color(${t} ${e.toFixed(3)} ${s.toFixed(3)} ${i.toFixed(3)})`:`rgb(${e*255|0},${s*255|0},${i*255|0})`}offsetHSL(t,e,s){return this.getHSL(Et),Et.h+=t,Et.s+=e,Et.l+=s,this.setHSL(Et.h,Et.s,Et.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,s){return this.r=t.r+(e.r-t.r)*s,this.g=t.g+(e.g-t.g)*s,this.b=t.b+(e.b-t.b)*s,this}lerpHSL(t,e){this.getHSL(Et),t.getHSL(xs);const s=ii(Et.h,xs.h,e),i=ii(Et.s,xs.s,e),n=ii(Et.l,xs.l,e);return this.setHSL(s,i,n),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,s=this.g,i=this.b,n=t.elements;return this.r=n[0]*e+n[3]*s+n[6]*i,this.g=n[1]*e+n[4]*s+n[7]*i,this.b=n[2]*e+n[5]*s+n[8]*i,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const ht=new Ct;Ct.NAMES=wn;class vn extends gi{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Ct(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=xo,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const j=new x,gs=new _;class nt{constructor(t,e,s=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=t!==void 0?t.length/e:0,this.normalized=s,this.usage=si,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,e,s){t*=this.itemSize,s*=e.itemSize;for(let i=0,n=this.itemSize;i<n;i++)this.array[t+i]=e.array[s+i];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let e=0,s=this.count;e<s;e++)gs.fromBufferAttribute(this,e),gs.applyMatrix3(t),this.setXY(e,gs.x,gs.y);else if(this.itemSize===3)for(let e=0,s=this.count;e<s;e++)j.fromBufferAttribute(this,e),j.applyMatrix3(t),this.setXYZ(e,j.x,j.y,j.z);return this}applyMatrix4(t){for(let e=0,s=this.count;e<s;e++)j.fromBufferAttribute(this,e),j.applyMatrix4(t),this.setXYZ(e,j.x,j.y,j.z);return this}applyNormalMatrix(t){for(let e=0,s=this.count;e<s;e++)j.fromBufferAttribute(this,e),j.applyNormalMatrix(t),this.setXYZ(e,j.x,j.y,j.z);return this}transformDirection(t){for(let e=0,s=this.count;e<s;e++)j.fromBufferAttribute(this,e),j.transformDirection(t),this.setXYZ(e,j.x,j.y,j.z);return this}set(t,e=0){return this.array.set(t,e),this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=ee(e,this.array)),e}setX(t,e){return this.normalized&&(e=W(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=ee(e,this.array)),e}setY(t,e){return this.normalized&&(e=W(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=ee(e,this.array)),e}setZ(t,e){return this.normalized&&(e=W(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=ee(e,this.array)),e}setW(t,e){return this.normalized&&(e=W(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,s){return t*=this.itemSize,this.normalized&&(e=W(e,this.array),s=W(s,this.array)),this.array[t+0]=e,this.array[t+1]=s,this}setXYZ(t,e,s,i){return t*=this.itemSize,this.normalized&&(e=W(e,this.array),s=W(s,this.array),i=W(i,this.array)),this.array[t+0]=e,this.array[t+1]=s,this.array[t+2]=i,this}setXYZW(t,e,s,i,n){return t*=this.itemSize,this.normalized&&(e=W(e,this.array),s=W(s,this.array),i=W(i,this.array),n=W(n,this.array)),this.array[t+0]=e,this.array[t+1]=s,this.array[t+2]=i,this.array[t+3]=n,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==si&&(t.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(t.updateRange=this.updateRange),t}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class Jo extends nt{constructor(t,e,s){super(new Uint16Array(t),e,s)}}class Wo extends nt{constructor(t,e,s){super(new Uint32Array(t),e,s)}}class Mt extends nt{constructor(t,e,s){super(new Float32Array(t),e,s)}}let Zo=0;const St=new K,wi=new lt,Fe=new x,wt=new Tt,Xe=new Tt,st=new x;class tt extends hs{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Zo++}),this.uuid=Ut(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(To(t)?Wo:Jo)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,e,s=0){this.groups.push({start:t,count:e,materialIndex:s})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;e!==void 0&&(e.applyMatrix4(t),e.needsUpdate=!0);const s=this.attributes.normal;if(s!==void 0){const n=new Ht().getNormalMatrix(t);s.applyNormalMatrix(n),s.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(t),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return St.makeRotationFromQuaternion(t),this.applyMatrix4(St),this}rotateX(t){return St.makeRotationX(t),this.applyMatrix4(St),this}rotateY(t){return St.makeRotationY(t),this.applyMatrix4(St),this}rotateZ(t){return St.makeRotationZ(t),this.applyMatrix4(St),this}translate(t,e,s){return St.makeTranslation(t,e,s),this.applyMatrix4(St),this}scale(t,e,s){return St.makeScale(t,e,s),this.applyMatrix4(St),this}lookAt(t){return wi.lookAt(t),wi.updateMatrix(),this.applyMatrix4(wi.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Fe).negate(),this.translate(Fe.x,Fe.y,Fe.z),this}setFromPoints(t){const e=[];for(let s=0,i=t.length;s<i;s++){const n=t[s];e.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new Mt(e,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Tt);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new x(-1/0,-1/0,-1/0),new x(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),e)for(let s=0,i=e.length;s<i;s++){const n=e[s];wt.setFromBufferAttribute(n),this.morphTargetsRelative?(st.addVectors(this.boundingBox.min,wt.min),this.boundingBox.expandByPoint(st),st.addVectors(this.boundingBox.max,wt.max),this.boundingBox.expandByPoint(st)):(this.boundingBox.expandByPoint(wt.min),this.boundingBox.expandByPoint(wt.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Je);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new x,1/0);return}if(t){const s=this.boundingSphere.center;if(wt.setFromBufferAttribute(t),e)for(let n=0,o=e.length;n<o;n++){const a=e[n];Xe.setFromBufferAttribute(a),this.morphTargetsRelative?(st.addVectors(wt.min,Xe.min),wt.expandByPoint(st),st.addVectors(wt.max,Xe.max),wt.expandByPoint(st)):(wt.expandByPoint(Xe.min),wt.expandByPoint(Xe.max))}wt.getCenter(s);let i=0;for(let n=0,o=t.count;n<o;n++)st.fromBufferAttribute(t,n),i=Math.max(i,s.distanceToSquared(st));if(e)for(let n=0,o=e.length;n<o;n++){const a=e[n],l=this.morphTargetsRelative;for(let h=0,u=a.count;h<u;h++)st.fromBufferAttribute(a,h),l&&(Fe.fromBufferAttribute(t,h),st.add(Fe)),i=Math.max(i,s.distanceToSquared(st))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(t===null||e.position===void 0||e.normal===void 0||e.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const s=t.array,i=e.position.array,n=e.normal.array,o=e.uv.array,a=i.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new nt(new Float32Array(4*a),4));const l=this.getAttribute("tangent").array,h=[],u=[];for(let L=0;L<a;L++)h[L]=new x,u[L]=new x;const c=new x,p=new x,f=new x,d=new _,m=new _,y=new _,b=new x,M=new x;function w(L,g,S){c.fromArray(i,L*3),p.fromArray(i,g*3),f.fromArray(i,S*3),d.fromArray(o,L*2),m.fromArray(o,g*2),y.fromArray(o,S*2),p.sub(c),f.sub(c),m.sub(d),y.sub(d);const A=1/(m.x*y.y-y.x*m.y);isFinite(A)&&(b.copy(p).multiplyScalar(y.y).addScaledVector(f,-m.y).multiplyScalar(A),M.copy(f).multiplyScalar(m.x).addScaledVector(p,-y.x).multiplyScalar(A),h[L].add(b),h[g].add(b),h[S].add(b),u[L].add(M),u[g].add(M),u[S].add(M))}let v=this.groups;v.length===0&&(v=[{start:0,count:s.length}]);for(let L=0,g=v.length;L<g;++L){const S=v[L],A=S.start,B=S.count;for(let C=A,k=A+B;C<k;C+=3)w(s[C+0],s[C+1],s[C+2])}const z=new x,F=new x,T=new x,$=new x;function Z(L){T.fromArray(n,L*3),$.copy(T);const g=h[L];z.copy(g),z.sub(T.multiplyScalar(T.dot(g))).normalize(),F.crossVectors($,g);const A=F.dot(u[L])<0?-1:1;l[L*4]=z.x,l[L*4+1]=z.y,l[L*4+2]=z.z,l[L*4+3]=A}for(let L=0,g=v.length;L<g;++L){const S=v[L],A=S.start,B=S.count;for(let C=A,k=A+B;C<k;C+=3)Z(s[C+0]),Z(s[C+1]),Z(s[C+2])}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(e!==void 0){let s=this.getAttribute("normal");if(s===void 0)s=new nt(new Float32Array(e.count*3),3),this.setAttribute("normal",s);else for(let p=0,f=s.count;p<f;p++)s.setXYZ(p,0,0,0);const i=new x,n=new x,o=new x,a=new x,l=new x,h=new x,u=new x,c=new x;if(t)for(let p=0,f=t.count;p<f;p+=3){const d=t.getX(p+0),m=t.getX(p+1),y=t.getX(p+2);i.fromBufferAttribute(e,d),n.fromBufferAttribute(e,m),o.fromBufferAttribute(e,y),u.subVectors(o,n),c.subVectors(i,n),u.cross(c),a.fromBufferAttribute(s,d),l.fromBufferAttribute(s,m),h.fromBufferAttribute(s,y),a.add(u),l.add(u),h.add(u),s.setXYZ(d,a.x,a.y,a.z),s.setXYZ(m,l.x,l.y,l.z),s.setXYZ(y,h.x,h.y,h.z)}else for(let p=0,f=e.count;p<f;p+=3)i.fromBufferAttribute(e,p+0),n.fromBufferAttribute(e,p+1),o.fromBufferAttribute(e,p+2),u.subVectors(o,n),c.subVectors(i,n),u.cross(c),s.setXYZ(p+0,u.x,u.y,u.z),s.setXYZ(p+1,u.x,u.y,u.z),s.setXYZ(p+2,u.x,u.y,u.z);this.normalizeNormals(),s.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeGeometries() instead."),this}normalizeNormals(){const t=this.attributes.normal;for(let e=0,s=t.count;e<s;e++)st.fromBufferAttribute(t,e),st.normalize(),t.setXYZ(e,st.x,st.y,st.z)}toNonIndexed(){function t(a,l){const h=a.array,u=a.itemSize,c=a.normalized,p=new h.constructor(l.length*u);let f=0,d=0;for(let m=0,y=l.length;m<y;m++){a.isInterleavedBufferAttribute?f=l[m]*a.data.stride+a.offset:f=l[m]*u;for(let b=0;b<u;b++)p[d++]=h[f++]}return new nt(p,u,c)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new tt,s=this.index.array,i=this.attributes;for(const a in i){const l=i[a],h=t(l,s);e.setAttribute(a,h)}const n=this.morphAttributes;for(const a in n){const l=[],h=n[a];for(let u=0,c=h.length;u<c;u++){const p=h[u],f=t(p,s);l.push(f)}e.morphAttributes[a]=l}e.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const h=o[a];e.addGroup(h.start,h.count,h.materialIndex)}return e}toJSON(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const h in l)l[h]!==void 0&&(t[h]=l[h]);return t}t.data={attributes:{}};const e=this.index;e!==null&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const s=this.attributes;for(const l in s){const h=s[l];t.data.attributes[l]=h.toJSON(t.data)}const i={};let n=!1;for(const l in this.morphAttributes){const h=this.morphAttributes[l],u=[];for(let c=0,p=h.length;c<p;c++){const f=h[c];u.push(f.toJSON(t.data))}u.length>0&&(i[l]=u,n=!0)}n&&(t.data.morphAttributes=i,t.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(t.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(t.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const s=t.index;s!==null&&this.setIndex(s.clone(e));const i=t.attributes;for(const h in i){const u=i[h];this.setAttribute(h,u.clone(e))}const n=t.morphAttributes;for(const h in n){const u=[],c=n[h];for(let p=0,f=c.length;p<f;p++)u.push(c[p].clone(e));this.morphAttributes[h]=u}this.morphTargetsRelative=t.morphTargetsRelative;const o=t.groups;for(let h=0,u=o.length;h<u;h++){const c=o[h];this.addGroup(c.start,c.count,c.materialIndex)}const a=t.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=t.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Mn=new K,Nt=new fi,bs=new Je,Sn=new x,Re=new x,Ie=new x,Ne=new x,vi=new x,vs=new x,Ms=new _,Ss=new _,As=new _,An=new x,zn=new x,Tn=new x,zs=new x,Ts=new x;class _n extends lt{constructor(t=new tt,e=new vn){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,s=Object.keys(e);if(s.length>0){const i=e[s[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let n=0,o=i.length;n<o;n++){const a=i[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=n}}}}getVertexPosition(t,e){const s=this.geometry,i=s.attributes.position,n=s.morphAttributes.position,o=s.morphTargetsRelative;e.fromBufferAttribute(i,t);const a=this.morphTargetInfluences;if(n&&a){vs.set(0,0,0);for(let l=0,h=n.length;l<h;l++){const u=a[l],c=n[l];u!==0&&(vi.fromBufferAttribute(c,t),o?vs.addScaledVector(vi,u):vs.addScaledVector(vi.sub(e),u))}e.add(vs)}return this.isSkinnedMesh&&this.applyBoneTransform(t,e),e}raycast(t,e){const s=this.geometry,i=this.material,n=this.matrixWorld;if(i===void 0||(s.boundingSphere===null&&s.computeBoundingSphere(),bs.copy(s.boundingSphere),bs.applyMatrix4(n),Nt.copy(t.ray).recast(t.near),bs.containsPoint(Nt.origin)===!1&&(Nt.intersectSphere(bs,Sn)===null||Nt.origin.distanceToSquared(Sn)>(t.far-t.near)**2))||(Mn.copy(n).invert(),Nt.copy(t.ray).applyMatrix4(Mn),s.boundingBox!==null&&Nt.intersectsBox(s.boundingBox)===!1))return;let o;const a=s.index,l=s.attributes.position,h=s.attributes.uv,u=s.attributes.uv2,c=s.attributes.normal,p=s.groups,f=s.drawRange;if(a!==null)if(Array.isArray(i))for(let d=0,m=p.length;d<m;d++){const y=p[d],b=i[y.materialIndex],M=Math.max(y.start,f.start),w=Math.min(a.count,Math.min(y.start+y.count,f.start+f.count));for(let v=M,z=w;v<z;v+=3){const F=a.getX(v),T=a.getX(v+1),$=a.getX(v+2);o=_s(this,b,t,Nt,h,u,c,F,T,$),o&&(o.faceIndex=Math.floor(v/3),o.face.materialIndex=y.materialIndex,e.push(o))}}else{const d=Math.max(0,f.start),m=Math.min(a.count,f.start+f.count);for(let y=d,b=m;y<b;y+=3){const M=a.getX(y),w=a.getX(y+1),v=a.getX(y+2);o=_s(this,i,t,Nt,h,u,c,M,w,v),o&&(o.faceIndex=Math.floor(y/3),e.push(o))}}else if(l!==void 0)if(Array.isArray(i))for(let d=0,m=p.length;d<m;d++){const y=p[d],b=i[y.materialIndex],M=Math.max(y.start,f.start),w=Math.min(l.count,Math.min(y.start+y.count,f.start+f.count));for(let v=M,z=w;v<z;v+=3){const F=v,T=v+1,$=v+2;o=_s(this,b,t,Nt,h,u,c,F,T,$),o&&(o.faceIndex=Math.floor(v/3),o.face.materialIndex=y.materialIndex,e.push(o))}}else{const d=Math.max(0,f.start),m=Math.min(l.count,f.start+f.count);for(let y=d,b=m;y<b;y+=3){const M=y,w=y+1,v=y+2;o=_s(this,i,t,Nt,h,u,c,M,w,v),o&&(o.faceIndex=Math.floor(y/3),e.push(o))}}}}function Xo(r,t,e,s,i,n,o,a){let l;if(t.side===co?l=s.intersectTriangle(o,n,i,!0,a):l=s.intersectTriangle(i,n,o,t.side===Ks,a),l===null)return null;Ts.copy(a),Ts.applyMatrix4(r.matrixWorld);const h=e.ray.origin.distanceTo(Ts);return h<e.near||h>e.far?null:{distance:h,point:Ts.clone(),object:r}}function _s(r,t,e,s,i,n,o,a,l,h){r.getVertexPosition(a,Re),r.getVertexPosition(l,Ie),r.getVertexPosition(h,Ne);const u=Xo(r,t,e,s,Re,Ie,Ne,zs);if(u){i&&(Ms.fromBufferAttribute(i,a),Ss.fromBufferAttribute(i,l),As.fromBufferAttribute(i,h),u.uv=bt.getInterpolation(zs,Re,Ie,Ne,Ms,Ss,As,new _)),n&&(Ms.fromBufferAttribute(n,a),Ss.fromBufferAttribute(n,l),As.fromBufferAttribute(n,h),u.uv2=bt.getInterpolation(zs,Re,Ie,Ne,Ms,Ss,As,new _)),o&&(An.fromBufferAttribute(o,a),zn.fromBufferAttribute(o,l),Tn.fromBufferAttribute(o,h),u.normal=bt.getInterpolation(zs,Re,Ie,Ne,An,zn,Tn,new x),u.normal.dot(s.direction)>0&&u.normal.multiplyScalar(-1));const c={a,b:l,c:h,normal:new x,materialIndex:0};bt.getNormal(Re,Ie,Ne,c.normal),u.face=c}return u}class Mi extends tt{constructor(t=1,e=1,s=1,i=1,n=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:s,widthSegments:i,heightSegments:n,depthSegments:o};const a=this;i=Math.floor(i),n=Math.floor(n),o=Math.floor(o);const l=[],h=[],u=[],c=[];let p=0,f=0;d("z","y","x",-1,-1,s,e,t,o,n,0),d("z","y","x",1,-1,s,e,-t,o,n,1),d("x","z","y",1,1,t,s,e,i,o,2),d("x","z","y",1,-1,t,s,-e,i,o,3),d("x","y","z",1,-1,t,e,s,i,n,4),d("x","y","z",-1,-1,t,e,-s,i,n,5),this.setIndex(l),this.setAttribute("position",new Mt(h,3)),this.setAttribute("normal",new Mt(u,3)),this.setAttribute("uv",new Mt(c,2));function d(m,y,b,M,w,v,z,F,T,$,Z){const L=v/T,g=z/$,S=v/2,A=z/2,B=F/2,C=T+1,k=$+1;let V=0,H=0;const D=new x;for(let R=0;R<k;R++){const U=R*g-A;for(let et=0;et<C;et++){const pt=et*L-S;D[m]=pt*M,D[y]=U*w,D[b]=B,h.push(D.x,D.y,D.z),D[m]=0,D[y]=0,D[b]=F>0?1:-1,u.push(D.x,D.y,D.z),c.push(et/T),c.push(1-R/$),V+=1}}for(let R=0;R<$;R++)for(let U=0;U<T;U++){const et=p+U+C*R,pt=p+U+C*(R+1),Ot=p+(U+1)+C*(R+1),Ft=p+(U+1)+C*R;l.push(et,pt,Ft),l.push(pt,Ot,Ft),H+=6}a.addGroup(f,H,Z),f+=H,p+=V}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Mi(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}const Si=new x,Yo=new x,Qo=new Ht;class Bn{constructor(t=new x(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,s,i){return this.normal.set(t,e,s),this.constant=i,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,s){const i=Si.subVectors(s,e).cross(Yo.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(i,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){const s=t.delta(Si),i=this.normal.dot(s);if(i===0)return this.distanceToPoint(t.start)===0?e.copy(t.start):null;const n=-(t.start.dot(this.normal)+this.constant)/i;return n<0||n>1?null:e.copy(t.start).addScaledVector(s,n)}intersectsLine(t){const e=this.distanceToPoint(t.start),s=this.distanceToPoint(t.end);return e<0&&s>0||s<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const s=e||Qo.getNormalMatrix(t),i=this.coplanarPoint(Si).applyMatrix4(t),n=this.normal.applyMatrix3(s).normalize();return this.constant=-i.dot(n),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return new this.constructor().copy(this)}}class jo{constructor(t,e){this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=t!==void 0?t.length/e:0,this.usage=si,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Ut()}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,s){t*=this.stride,s*=e.stride;for(let i=0,n=this.stride;i<n;i++)this.array[t+i]=e.array[s+i];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ut()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),s=new this.constructor(e,this.stride);return s.setUsage(this.usage),s}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ut()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const ut=new x;class Bs{constructor(t,e,s,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=e,this.offset=s,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,s=this.data.count;e<s;e++)ut.fromBufferAttribute(this,e),ut.applyMatrix4(t),this.setXYZ(e,ut.x,ut.y,ut.z);return this}applyNormalMatrix(t){for(let e=0,s=this.count;e<s;e++)ut.fromBufferAttribute(this,e),ut.applyNormalMatrix(t),this.setXYZ(e,ut.x,ut.y,ut.z);return this}transformDirection(t){for(let e=0,s=this.count;e<s;e++)ut.fromBufferAttribute(this,e),ut.transformDirection(t),this.setXYZ(e,ut.x,ut.y,ut.z);return this}setX(t,e){return this.normalized&&(e=W(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.normalized&&(e=W(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.normalized&&(e=W(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.normalized&&(e=W(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){let e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=ee(e,this.array)),e}getY(t){let e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=ee(e,this.array)),e}getZ(t){let e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=ee(e,this.array)),e}getW(t){let e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=ee(e,this.array)),e}setXY(t,e,s){return t=t*this.data.stride+this.offset,this.normalized&&(e=W(e,this.array),s=W(s,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=s,this}setXYZ(t,e,s,i){return t=t*this.data.stride+this.offset,this.normalized&&(e=W(e,this.array),s=W(s,this.array),i=W(i,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=s,this.data.array[t+2]=i,this}setXYZW(t,e,s,i,n){return t=t*this.data.stride+this.offset,this.normalized&&(e=W(e,this.array),s=W(s,this.array),i=W(i,this.array),n=W(n,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=s,this.data.array[t+2]=i,this.data.array[t+3]=n,this}clone(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let s=0;s<this.count;s++){const i=s*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)e.push(this.data.array[i+n])}return new nt(new this.array.constructor(e),this.itemSize,this.normalized)}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new Bs(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let s=0;s<this.count;s++){const i=s*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)e.push(this.data.array[i+n])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class Ko extends nt{constructor(t,e,s,i=1){super(t,e,s),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}class En extends gi{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Ct(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const Cn=new x,Pn=new x,kn=new K,Ai=new fi,Es=new Je;class On extends lt{constructor(t=new tt,e=new En){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.index===null){const e=t.attributes.position,s=[0];for(let i=1,n=e.count;i<n;i++)Cn.fromBufferAttribute(e,i-1),Pn.fromBufferAttribute(e,i),s[i]=s[i-1],s[i]+=Cn.distanceTo(Pn);t.setAttribute("lineDistance",new Mt(s,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,e){const s=this.geometry,i=this.matrixWorld,n=t.params.Line.threshold,o=s.drawRange;if(s.boundingSphere===null&&s.computeBoundingSphere(),Es.copy(s.boundingSphere),Es.applyMatrix4(i),Es.radius+=n,t.ray.intersectsSphere(Es)===!1)return;kn.copy(i).invert(),Ai.copy(t.ray).applyMatrix4(kn);const a=n/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,h=new x,u=new x,c=new x,p=new x,f=this.isLineSegments?2:1,d=s.index,y=s.attributes.position;if(d!==null){const b=Math.max(0,o.start),M=Math.min(d.count,o.start+o.count);for(let w=b,v=M-1;w<v;w+=f){const z=d.getX(w),F=d.getX(w+1);if(h.fromBufferAttribute(y,z),u.fromBufferAttribute(y,F),Ai.distanceSqToSegment(h,u,p,c)>l)continue;p.applyMatrix4(this.matrixWorld);const $=t.ray.origin.distanceTo(p);$<t.near||$>t.far||e.push({distance:$,point:c.clone().applyMatrix4(this.matrixWorld),index:w,face:null,faceIndex:null,object:this})}}else{const b=Math.max(0,o.start),M=Math.min(y.count,o.start+o.count);for(let w=b,v=M-1;w<v;w+=f){if(h.fromBufferAttribute(y,w),u.fromBufferAttribute(y,w+1),Ai.distanceSqToSegment(h,u,p,c)>l)continue;p.applyMatrix4(this.matrixWorld);const F=t.ray.origin.distanceTo(p);F<t.near||F>t.far||e.push({distance:F,point:c.clone().applyMatrix4(this.matrixWorld),index:w,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const e=this.geometry.morphAttributes,s=Object.keys(e);if(s.length>0){const i=e[s[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let n=0,o=i.length;n<o;n++){const a=i[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=n}}}}}const Fn=new x,Rn=new x;class ta extends On{constructor(t,e){super(t,e),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.index===null){const e=t.attributes.position,s=[];for(let i=0,n=e.count;i<n;i+=2)Fn.fromBufferAttribute(e,i),Rn.fromBufferAttribute(e,i+1),s[i]=i===0?0:s[i-1],s[i+1]=s[i]+Fn.distanceTo(Rn);t.setAttribute("lineDistance",new Mt(s,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class In extends gi{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Ct(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const Nn=new K,zi=new fi,Cs=new Je,Ps=new x;class Dn extends lt{constructor(t=new tt,e=new In){super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=t.material,this.geometry=t.geometry,this}raycast(t,e){const s=this.geometry,i=this.matrixWorld,n=t.params.Points.threshold,o=s.drawRange;if(s.boundingSphere===null&&s.computeBoundingSphere(),Cs.copy(s.boundingSphere),Cs.applyMatrix4(i),Cs.radius+=n,t.ray.intersectsSphere(Cs)===!1)return;Nn.copy(i).invert(),zi.copy(t.ray).applyMatrix4(Nn);const a=n/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,h=s.index,c=s.attributes.position;if(h!==null){const p=Math.max(0,o.start),f=Math.min(h.count,o.start+o.count);for(let d=p,m=f;d<m;d++){const y=h.getX(d);Ps.fromBufferAttribute(c,y),Ln(Ps,y,l,i,t,e,this)}}else{const p=Math.max(0,o.start),f=Math.min(c.count,o.start+o.count);for(let d=p,m=f;d<m;d++)Ps.fromBufferAttribute(c,d),Ln(Ps,d,l,i,t,e,this)}}updateMorphTargets(){const e=this.geometry.morphAttributes,s=Object.keys(e);if(s.length>0){const i=e[s[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let n=0,o=i.length;n<o;n++){const a=i[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=n}}}}}function Ln(r,t,e,s,i,n,o){const a=zi.distanceSqToPoint(r);if(a<e){const l=new x;zi.closestPointToPoint(r,l),l.applyMatrix4(s);const h=i.ray.origin.distanceTo(l);if(h<i.near||h>i.far)return;n.push({distance:h,distanceToRay:Math.sqrt(a),point:l,index:t,face:null,object:o})}}class Dt{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){const s=this.getUtoTmapping(t);return this.getPoint(s,e)}getPoints(t=5){const e=[];for(let s=0;s<=t;s++)e.push(this.getPoint(s/t));return e}getSpacedPoints(t=5){const e=[];for(let s=0;s<=t;s++)e.push(this.getPointAt(s/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let s,i=this.getPoint(0),n=0;e.push(0);for(let o=1;o<=t;o++)s=this.getPoint(o/t),n+=s.distanceTo(i),e.push(n),i=s;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const s=this.getLengths();let i=0;const n=s.length;let o;e?o=e:o=t*s[n-1];let a=0,l=n-1,h;for(;a<=l;)if(i=Math.floor(a+(l-a)/2),h=s[i]-o,h<0)a=i+1;else if(h>0)l=i-1;else{l=i;break}if(i=l,s[i]===o)return i/(n-1);const u=s[i],p=s[i+1]-u,f=(o-u)/p;return(i+f)/(n-1)}getTangent(t,e){let i=t-1e-4,n=t+1e-4;i<0&&(i=0),n>1&&(n=1);const o=this.getPoint(i),a=this.getPoint(n),l=e||(o.isVector2?new _:new x);return l.copy(a).sub(o).normalize(),l}getTangentAt(t,e){const s=this.getUtoTmapping(t);return this.getTangent(s,e)}computeFrenetFrames(t,e){const s=new x,i=[],n=[],o=[],a=new x,l=new K;for(let f=0;f<=t;f++){const d=f/t;i[f]=this.getTangentAt(d,new x)}n[0]=new x,o[0]=new x;let h=Number.MAX_VALUE;const u=Math.abs(i[0].x),c=Math.abs(i[0].y),p=Math.abs(i[0].z);u<=h&&(h=u,s.set(1,0,0)),c<=h&&(h=c,s.set(0,1,0)),p<=h&&s.set(0,0,1),a.crossVectors(i[0],s).normalize(),n[0].crossVectors(i[0],a),o[0].crossVectors(i[0],n[0]);for(let f=1;f<=t;f++){if(n[f]=n[f-1].clone(),o[f]=o[f-1].clone(),a.crossVectors(i[f-1],i[f]),a.length()>Number.EPSILON){a.normalize();const d=Math.acos(at(i[f-1].dot(i[f]),-1,1));n[f].applyMatrix4(l.makeRotationAxis(a,d))}o[f].crossVectors(i[f],n[f])}if(e===!0){let f=Math.acos(at(n[0].dot(n[t]),-1,1));f/=t,i[0].dot(a.crossVectors(n[0],n[t]))>0&&(f=-f);for(let d=1;d<=t;d++)n[d].applyMatrix4(l.makeRotationAxis(i[d],f*d)),o[d].crossVectors(i[d],n[d])}return{tangents:i,normals:n,binormals:o}}clone(){return new this.constructor().copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class Ti extends Dt{constructor(t=0,e=0,s=1,i=1,n=0,o=Math.PI*2,a=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=s,this.yRadius=i,this.aStartAngle=n,this.aEndAngle=o,this.aClockwise=a,this.aRotation=l}getPoint(t,e){const s=e||new _,i=Math.PI*2;let n=this.aEndAngle-this.aStartAngle;const o=Math.abs(n)<Number.EPSILON;for(;n<0;)n+=i;for(;n>i;)n-=i;n<Number.EPSILON&&(o?n=0:n=i),this.aClockwise===!0&&!o&&(n===i?n=-i:n=n-i);const a=this.aStartAngle+t*n;let l=this.aX+this.xRadius*Math.cos(a),h=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){const u=Math.cos(this.aRotation),c=Math.sin(this.aRotation),p=l-this.aX,f=h-this.aY;l=p*u-f*c+this.aX,h=p*c+f*u+this.aY}return s.set(l,h)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}class ea extends Ti{constructor(t,e,s,i,n,o){super(t,e,s,s,i,n,o),this.isArcCurve=!0,this.type="ArcCurve"}}function _i(){let r=0,t=0,e=0,s=0;function i(n,o,a,l){r=n,t=a,e=-3*n+3*o-2*a-l,s=2*n-2*o+a+l}return{initCatmullRom:function(n,o,a,l,h){i(o,a,h*(a-n),h*(l-o))},initNonuniformCatmullRom:function(n,o,a,l,h,u,c){let p=(o-n)/h-(a-n)/(h+u)+(a-o)/u,f=(a-o)/u-(l-o)/(u+c)+(l-a)/c;p*=u,f*=u,i(o,a,p,f)},calc:function(n){const o=n*n,a=o*n;return r+t*n+e*o+s*a}}}const ks=new x,Bi=new _i,Ei=new _i,Ci=new _i;class sa extends Dt{constructor(t=[],e=!1,s="centripetal",i=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=s,this.tension=i}getPoint(t,e=new x){const s=e,i=this.points,n=i.length,o=(n-(this.closed?0:1))*t;let a=Math.floor(o),l=o-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/n)+1)*n:l===0&&a===n-1&&(a=n-2,l=1);let h,u;this.closed||a>0?h=i[(a-1)%n]:(ks.subVectors(i[0],i[1]).add(i[0]),h=ks);const c=i[a%n],p=i[(a+1)%n];if(this.closed||a+2<n?u=i[(a+2)%n]:(ks.subVectors(i[n-1],i[n-2]).add(i[n-1]),u=ks),this.curveType==="centripetal"||this.curveType==="chordal"){const f=this.curveType==="chordal"?.5:.25;let d=Math.pow(h.distanceToSquared(c),f),m=Math.pow(c.distanceToSquared(p),f),y=Math.pow(p.distanceToSquared(u),f);m<1e-4&&(m=1),d<1e-4&&(d=m),y<1e-4&&(y=m),Bi.initNonuniformCatmullRom(h.x,c.x,p.x,u.x,d,m,y),Ei.initNonuniformCatmullRom(h.y,c.y,p.y,u.y,d,m,y),Ci.initNonuniformCatmullRom(h.z,c.z,p.z,u.z,d,m,y)}else this.curveType==="catmullrom"&&(Bi.initCatmullRom(h.x,c.x,p.x,u.x,this.tension),Ei.initCatmullRom(h.y,c.y,p.y,u.y,this.tension),Ci.initCatmullRom(h.z,c.z,p.z,u.z,this.tension));return s.set(Bi.calc(l),Ei.calc(l),Ci.calc(l)),s}copy(t){super.copy(t),this.points=[];for(let e=0,s=t.points.length;e<s;e++){const i=t.points[e];this.points.push(i.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,s=this.points.length;e<s;e++){const i=this.points[e];t.points.push(i.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,s=t.points.length;e<s;e++){const i=t.points[e];this.points.push(new x().fromArray(i))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function $n(r,t,e,s,i){const n=(s-t)*.5,o=(i-e)*.5,a=r*r,l=r*a;return(2*e-2*s+n+o)*l+(-3*e+3*s-2*n-o)*a+n*r+e}function ia(r,t){const e=1-r;return e*e*t}function na(r,t){return 2*(1-r)*r*t}function ra(r,t){return r*r*t}function Ye(r,t,e,s){return ia(r,t)+na(r,e)+ra(r,s)}function oa(r,t){const e=1-r;return e*e*e*t}function aa(r,t){const e=1-r;return 3*e*e*r*t}function ha(r,t){return 3*(1-r)*r*r*t}function la(r,t){return r*r*r*t}function Qe(r,t,e,s,i){return oa(r,t)+aa(r,e)+ha(r,s)+la(r,i)}class Vn extends Dt{constructor(t=new _,e=new _,s=new _,i=new _){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=s,this.v3=i}getPoint(t,e=new _){const s=e,i=this.v0,n=this.v1,o=this.v2,a=this.v3;return s.set(Qe(t,i.x,n.x,o.x,a.x),Qe(t,i.y,n.y,o.y,a.y)),s}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class ua extends Dt{constructor(t=new x,e=new x,s=new x,i=new x){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=s,this.v3=i}getPoint(t,e=new x){const s=e,i=this.v0,n=this.v1,o=this.v2,a=this.v3;return s.set(Qe(t,i.x,n.x,o.x,a.x),Qe(t,i.y,n.y,o.y,a.y),Qe(t,i.z,n.z,o.z,a.z)),s}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class Pi extends Dt{constructor(t=new _,e=new _){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new _){const s=e;return t===1?s.copy(this.v2):(s.copy(this.v2).sub(this.v1),s.multiplyScalar(t).add(this.v1)),s}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new _){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class ca extends Dt{constructor(t=new x,e=new x){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=e}getPoint(t,e=new x){const s=e;return t===1?s.copy(this.v2):(s.copy(this.v2).sub(this.v1),s.multiplyScalar(t).add(this.v1)),s}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new x){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class qn extends Dt{constructor(t=new _,e=new _,s=new _){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=s}getPoint(t,e=new _){const s=e,i=this.v0,n=this.v1,o=this.v2;return s.set(Ye(t,i.x,n.x,o.x),Ye(t,i.y,n.y,o.y)),s}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class pa extends Dt{constructor(t=new x,e=new x,s=new x){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=s}getPoint(t,e=new x){const s=e,i=this.v0,n=this.v1,o=this.v2;return s.set(Ye(t,i.x,n.x,o.x),Ye(t,i.y,n.y,o.y),Ye(t,i.z,n.z,o.z)),s}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Un extends Dt{constructor(t=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t,e=new _){const s=e,i=this.points,n=(i.length-1)*t,o=Math.floor(n),a=n-o,l=i[o===0?o:o-1],h=i[o],u=i[o>i.length-2?i.length-1:o+1],c=i[o>i.length-3?i.length-1:o+2];return s.set($n(a,l.x,h.x,u.x,c.x),$n(a,l.y,h.y,u.y,c.y)),s}copy(t){super.copy(t),this.points=[];for(let e=0,s=t.points.length;e<s;e++){const i=t.points[e];this.points.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,s=this.points.length;e<s;e++){const i=this.points[e];t.points.push(i.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,s=t.points.length;e<s;e++){const i=t.points[e];this.points.push(new _().fromArray(i))}return this}}var Hn=Object.freeze({__proto__:null,ArcCurve:ea,CatmullRomCurve3:sa,CubicBezierCurve:Vn,CubicBezierCurve3:ua,EllipseCurve:Ti,LineCurve:Pi,LineCurve3:ca,QuadraticBezierCurve:qn,QuadraticBezierCurve3:pa,SplineCurve:Un});class fa extends Dt{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new Pi(e,t))}getPoint(t,e){const s=t*this.getLength(),i=this.getCurveLengths();let n=0;for(;n<i.length;){if(i[n]>=s){const o=i[n]-s,a=this.curves[n],l=a.getLength(),h=l===0?0:1-o/l;return a.getPointAt(h,e)}n++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let s=0,i=this.curves.length;s<i;s++)e+=this.curves[s].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let s=0;s<=t;s++)e.push(this.getPoint(s/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let s;for(let i=0,n=this.curves;i<n.length;i++){const o=n[i],a=o.isEllipseCurve?t*2:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?t*o.points.length:t,l=o.getPoints(a);for(let h=0;h<l.length;h++){const u=l[h];s&&s.equals(u)||(e.push(u),s=u)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,s=t.curves.length;e<s;e++){const i=t.curves[e];this.curves.push(i.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,s=this.curves.length;e<s;e++){const i=this.curves[e];t.curves.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,s=t.curves.length;e<s;e++){const i=t.curves[e];this.curves.push(new Hn[i.type]().fromJSON(i))}return this}}class ki extends fa{constructor(t){super(),this.type="Path",this.currentPoint=new _,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,s=t.length;e<s;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const s=new Pi(this.currentPoint.clone(),new _(t,e));return this.curves.push(s),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,s,i){const n=new qn(this.currentPoint.clone(),new _(t,e),new _(s,i));return this.curves.push(n),this.currentPoint.set(s,i),this}bezierCurveTo(t,e,s,i,n,o){const a=new Vn(this.currentPoint.clone(),new _(t,e),new _(s,i),new _(n,o));return this.curves.push(a),this.currentPoint.set(n,o),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),s=new Un(e);return this.curves.push(s),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,s,i,n,o){const a=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(t+a,e+l,s,i,n,o),this}absarc(t,e,s,i,n,o){return this.absellipse(t,e,s,s,i,n,o),this}ellipse(t,e,s,i,n,o,a,l){const h=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(t+h,e+u,s,i,n,o,a,l),this}absellipse(t,e,s,i,n,o,a,l){const h=new Ti(t,e,s,i,n,o,a,l);if(this.curves.length>0){const c=h.getPoint(0);c.equals(this.currentPoint)||this.lineTo(c.x,c.y)}this.curves.push(h);const u=h.getPoint(1);return this.currentPoint.copy(u),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}const Os=new x,Fs=new x,Oi=new x,Rs=new bt;class Gn extends tt{constructor(t=null,e=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:t,thresholdAngle:e},t!==null){const i=Math.pow(10,4),n=Math.cos(Ao*e),o=t.getIndex(),a=t.getAttribute("position"),l=o?o.count:a.count,h=[0,0,0],u=["a","b","c"],c=new Array(3),p={},f=[];for(let d=0;d<l;d+=3){o?(h[0]=o.getX(d),h[1]=o.getX(d+1),h[2]=o.getX(d+2)):(h[0]=d,h[1]=d+1,h[2]=d+2);const{a:m,b:y,c:b}=Rs;if(m.fromBufferAttribute(a,h[0]),y.fromBufferAttribute(a,h[1]),b.fromBufferAttribute(a,h[2]),Rs.getNormal(Oi),c[0]=`${Math.round(m.x*i)},${Math.round(m.y*i)},${Math.round(m.z*i)}`,c[1]=`${Math.round(y.x*i)},${Math.round(y.y*i)},${Math.round(y.z*i)}`,c[2]=`${Math.round(b.x*i)},${Math.round(b.y*i)},${Math.round(b.z*i)}`,!(c[0]===c[1]||c[1]===c[2]||c[2]===c[0]))for(let M=0;M<3;M++){const w=(M+1)%3,v=c[M],z=c[w],F=Rs[u[M]],T=Rs[u[w]],$=`${v}_${z}`,Z=`${z}_${v}`;Z in p&&p[Z]?(Oi.dot(p[Z].normal)<=n&&(f.push(F.x,F.y,F.z),f.push(T.x,T.y,T.z)),p[Z]=null):$ in p||(p[$]={index0:h[M],index1:h[w],normal:Oi.clone()})}}for(const d in p)if(p[d]){const{index0:m,index1:y}=p[d];Os.fromBufferAttribute(a,m),Fs.fromBufferAttribute(a,y),f.push(Os.x,Os.y,Os.z),f.push(Fs.x,Fs.y,Fs.z)}this.setAttribute("position",new Mt(f,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}class oe extends ki{constructor(t){super(t),this.uuid=Ut(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let s=0,i=this.holes.length;s<i;s++)e[s]=this.holes[s].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,s=t.holes.length;e<s;e++){const i=t.holes[e];this.holes.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,s=this.holes.length;e<s;e++){const i=this.holes[e];t.holes.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,s=t.holes.length;e<s;e++){const i=t.holes[e];this.holes.push(new ki().fromJSON(i))}return this}}const da={triangulate:function(r,t,e=2){const s=t&&t.length,i=s?t[0]*e:r.length;let n=Jn(r,0,i,e,!0);const o=[];if(!n||n.next===n.prev)return o;let a,l,h,u,c,p,f;if(s&&(n=ba(r,t,n,e)),r.length>80*e){a=h=r[0],l=u=r[1];for(let d=e;d<i;d+=e)c=r[d],p=r[d+1],c<a&&(a=c),p<l&&(l=p),c>h&&(h=c),p>u&&(u=p);f=Math.max(h-a,u-l),f=f!==0?32767/f:0}return je(n,o,e,a,l,f,0),o}};function Jn(r,t,e,s,i){let n,o;if(i===Ca(r,t,e,s)>0)for(n=t;n<e;n+=s)o=Xn(n,r[n],r[n+1],o);else for(n=e-s;n>=t;n-=s)o=Xn(n,r[n],r[n+1],o);return o&&Is(o,o.next)&&(ts(o),o=o.next),o}function ge(r,t){if(!r)return r;t||(t=r);let e=r,s;do if(s=!1,!e.steiner&&(Is(e,e.next)||X(e.prev,e,e.next)===0)){if(ts(e),e=t=e.prev,e===e.next)break;s=!0}else e=e.next;while(s||e!==t);return t}function je(r,t,e,s,i,n,o){if(!r)return;!o&&n&&Aa(r,s,i,n);let a=r,l,h;for(;r.prev!==r.next;){if(l=r.prev,h=r.next,n?ya(r,s,i,n):ma(r)){t.push(l.i/e|0),t.push(r.i/e|0),t.push(h.i/e|0),ts(r),r=h.next,a=h.next;continue}if(r=h,r===a){o?o===1?(r=xa(ge(r),t,e),je(r,t,e,s,i,n,2)):o===2&&ga(r,t,e,s,i,n):je(ge(r),t,e,s,i,n,1);break}}}function ma(r){const t=r.prev,e=r,s=r.next;if(X(t,e,s)>=0)return!1;const i=t.x,n=e.x,o=s.x,a=t.y,l=e.y,h=s.y,u=i<n?i<o?i:o:n<o?n:o,c=a<l?a<h?a:h:l<h?l:h,p=i>n?i>o?i:o:n>o?n:o,f=a>l?a>h?a:h:l>h?l:h;let d=s.next;for(;d!==t;){if(d.x>=u&&d.x<=p&&d.y>=c&&d.y<=f&&De(i,a,n,l,o,h,d.x,d.y)&&X(d.prev,d,d.next)>=0)return!1;d=d.next}return!0}function ya(r,t,e,s){const i=r.prev,n=r,o=r.next;if(X(i,n,o)>=0)return!1;const a=i.x,l=n.x,h=o.x,u=i.y,c=n.y,p=o.y,f=a<l?a<h?a:h:l<h?l:h,d=u<c?u<p?u:p:c<p?c:p,m=a>l?a>h?a:h:l>h?l:h,y=u>c?u>p?u:p:c>p?c:p,b=Fi(f,d,t,e,s),M=Fi(m,y,t,e,s);let w=r.prevZ,v=r.nextZ;for(;w&&w.z>=b&&v&&v.z<=M;){if(w.x>=f&&w.x<=m&&w.y>=d&&w.y<=y&&w!==i&&w!==o&&De(a,u,l,c,h,p,w.x,w.y)&&X(w.prev,w,w.next)>=0||(w=w.prevZ,v.x>=f&&v.x<=m&&v.y>=d&&v.y<=y&&v!==i&&v!==o&&De(a,u,l,c,h,p,v.x,v.y)&&X(v.prev,v,v.next)>=0))return!1;v=v.nextZ}for(;w&&w.z>=b;){if(w.x>=f&&w.x<=m&&w.y>=d&&w.y<=y&&w!==i&&w!==o&&De(a,u,l,c,h,p,w.x,w.y)&&X(w.prev,w,w.next)>=0)return!1;w=w.prevZ}for(;v&&v.z<=M;){if(v.x>=f&&v.x<=m&&v.y>=d&&v.y<=y&&v!==i&&v!==o&&De(a,u,l,c,h,p,v.x,v.y)&&X(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function xa(r,t,e){let s=r;do{const i=s.prev,n=s.next.next;!Is(i,n)&&Wn(i,s,s.next,n)&&Ke(i,n)&&Ke(n,i)&&(t.push(i.i/e|0),t.push(s.i/e|0),t.push(n.i/e|0),ts(s),ts(s.next),s=r=n),s=s.next}while(s!==r);return ge(s)}function ga(r,t,e,s,i,n){let o=r;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&_a(o,a)){let l=Zn(o,a);o=ge(o,o.next),l=ge(l,l.next),je(o,t,e,s,i,n,0),je(l,t,e,s,i,n,0);return}a=a.next}o=o.next}while(o!==r)}function ba(r,t,e,s){const i=[];let n,o,a,l,h;for(n=0,o=t.length;n<o;n++)a=t[n]*s,l=n<o-1?t[n+1]*s:r.length,h=Jn(r,a,l,s,!1),h===h.next&&(h.steiner=!0),i.push(Ta(h));for(i.sort(wa),n=0;n<i.length;n++)e=va(i[n],e);return e}function wa(r,t){return r.x-t.x}function va(r,t){const e=Ma(r,t);if(!e)return t;const s=Zn(e,r);return ge(s,s.next),ge(e,e.next)}function Ma(r,t){let e=t,s=-1/0,i;const n=r.x,o=r.y;do{if(o<=e.y&&o>=e.next.y&&e.next.y!==e.y){const p=e.x+(o-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(p<=n&&p>s&&(s=p,i=e.x<e.next.x?e:e.next,p===n))return i}e=e.next}while(e!==t);if(!i)return null;const a=i,l=i.x,h=i.y;let u=1/0,c;e=i;do n>=e.x&&e.x>=l&&n!==e.x&&De(o<h?n:s,o,l,h,o<h?s:n,o,e.x,e.y)&&(c=Math.abs(o-e.y)/(n-e.x),Ke(e,r)&&(c<u||c===u&&(e.x>i.x||e.x===i.x&&Sa(i,e)))&&(i=e,u=c)),e=e.next;while(e!==a);return i}function Sa(r,t){return X(r.prev,r,t.prev)<0&&X(t.next,r,r.next)<0}function Aa(r,t,e,s){let i=r;do i.z===0&&(i.z=Fi(i.x,i.y,t,e,s)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==r);i.prevZ.nextZ=null,i.prevZ=null,za(i)}function za(r){let t,e,s,i,n,o,a,l,h=1;do{for(e=r,r=null,n=null,o=0;e;){for(o++,s=e,a=0,t=0;t<h&&(a++,s=s.nextZ,!!s);t++);for(l=h;a>0||l>0&&s;)a!==0&&(l===0||!s||e.z<=s.z)?(i=e,e=e.nextZ,a--):(i=s,s=s.nextZ,l--),n?n.nextZ=i:r=i,i.prevZ=n,n=i;e=s}n.nextZ=null,h*=2}while(o>1);return r}function Fi(r,t,e,s,i){return r=(r-e)*i|0,t=(t-s)*i|0,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,r|t<<1}function Ta(r){let t=r,e=r;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==r);return e}function De(r,t,e,s,i,n,o,a){return(i-o)*(t-a)>=(r-o)*(n-a)&&(r-o)*(s-a)>=(e-o)*(t-a)&&(e-o)*(n-a)>=(i-o)*(s-a)}function _a(r,t){return r.next.i!==t.i&&r.prev.i!==t.i&&!Ba(r,t)&&(Ke(r,t)&&Ke(t,r)&&Ea(r,t)&&(X(r.prev,r,t.prev)||X(r,t.prev,t))||Is(r,t)&&X(r.prev,r,r.next)>0&&X(t.prev,t,t.next)>0)}function X(r,t,e){return(t.y-r.y)*(e.x-t.x)-(t.x-r.x)*(e.y-t.y)}function Is(r,t){return r.x===t.x&&r.y===t.y}function Wn(r,t,e,s){const i=Ds(X(r,t,e)),n=Ds(X(r,t,s)),o=Ds(X(e,s,r)),a=Ds(X(e,s,t));return!!(i!==n&&o!==a||i===0&&Ns(r,e,t)||n===0&&Ns(r,s,t)||o===0&&Ns(e,r,s)||a===0&&Ns(e,t,s))}function Ns(r,t,e){return t.x<=Math.max(r.x,e.x)&&t.x>=Math.min(r.x,e.x)&&t.y<=Math.max(r.y,e.y)&&t.y>=Math.min(r.y,e.y)}function Ds(r){return r>0?1:r<0?-1:0}function Ba(r,t){let e=r;do{if(e.i!==r.i&&e.next.i!==r.i&&e.i!==t.i&&e.next.i!==t.i&&Wn(e,e.next,r,t))return!0;e=e.next}while(e!==r);return!1}function Ke(r,t){return X(r.prev,r,r.next)<0?X(r,t,r.next)>=0&&X(r,r.prev,t)>=0:X(r,t,r.prev)<0||X(r,r.next,t)<0}function Ea(r,t){let e=r,s=!1;const i=(r.x+t.x)/2,n=(r.y+t.y)/2;do e.y>n!=e.next.y>n&&e.next.y!==e.y&&i<(e.next.x-e.x)*(n-e.y)/(e.next.y-e.y)+e.x&&(s=!s),e=e.next;while(e!==r);return s}function Zn(r,t){const e=new Ri(r.i,r.x,r.y),s=new Ri(t.i,t.x,t.y),i=r.next,n=t.prev;return r.next=t,t.prev=r,e.next=i,i.prev=e,s.next=e,e.prev=s,n.next=s,s.prev=n,s}function Xn(r,t,e,s){const i=new Ri(r,t,e);return s?(i.next=s.next,i.prev=s,s.next.prev=i,s.next=i):(i.prev=i,i.next=i),i}function ts(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Ri(r,t,e){this.i=r,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ca(r,t,e,s){let i=0;for(let n=t,o=e-s;n<e;n+=s)i+=(r[o]-r[n])*(r[n+1]+r[o+1]),o=n;return i}class Pt{static area(t){const e=t.length;let s=0;for(let i=e-1,n=0;n<e;i=n++)s+=t[i].x*t[n].y-t[n].x*t[i].y;return s*.5}static isClockWise(t){return Pt.area(t)<0}static triangulateShape(t,e){const s=[],i=[],n=[];Yn(t),Qn(s,t);let o=t.length;e.forEach(Yn);for(let l=0;l<e.length;l++)i.push(o),o+=e[l].length,Qn(s,e[l]);const a=da.triangulate(s,i);for(let l=0;l<a.length;l+=3)n.push(a.slice(l,l+3));return n}}function Yn(r){const t=r.length;t>2&&r[t-1].equals(r[0])&&r.pop()}function Qn(r,t){for(let e=0;e<t.length;e++)r.push(t[e].x),r.push(t[e].y)}class Ii extends tt{constructor(t=new oe([new _(.5,.5),new _(-.5,.5),new _(-.5,-.5),new _(.5,-.5)]),e={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const s=this,i=[],n=[];for(let a=0,l=t.length;a<l;a++){const h=t[a];o(h)}this.setAttribute("position",new Mt(i,3)),this.setAttribute("uv",new Mt(n,2)),this.computeVertexNormals();function o(a){const l=[],h=e.curveSegments!==void 0?e.curveSegments:12,u=e.steps!==void 0?e.steps:1,c=e.depth!==void 0?e.depth:1;let p=e.bevelEnabled!==void 0?e.bevelEnabled:!0,f=e.bevelThickness!==void 0?e.bevelThickness:.2,d=e.bevelSize!==void 0?e.bevelSize:f-.1,m=e.bevelOffset!==void 0?e.bevelOffset:0,y=e.bevelSegments!==void 0?e.bevelSegments:3;const b=e.extrudePath,M=e.UVGenerator!==void 0?e.UVGenerator:Pa;let w,v=!1,z,F,T,$;b&&(w=b.getSpacedPoints(u),v=!0,p=!1,z=b.computeFrenetFrames(u,!1),F=new x,T=new x,$=new x),p||(y=0,f=0,d=0,m=0);const Z=a.extractPoints(h);let L=Z.shape;const g=Z.holes;if(!Pt.isClockWise(L)){L=L.reverse();for(let P=0,O=g.length;P<O;P++){const I=g[P];Pt.isClockWise(I)&&(g[P]=I.reverse())}}const A=Pt.triangulateShape(L,g),B=L;for(let P=0,O=g.length;P<O;P++){const I=g[P];L=L.concat(I)}function C(P,O,I){return O||console.error("THREE.ExtrudeGeometry: vec does not exist"),P.clone().addScaledVector(O,I)}const k=L.length,V=A.length;function H(P,O,I){let q,N,G;const J=P.x-O.x,Y=P.y-O.y,dt=I.x-P.x,rt=I.y-P.y,rs=J*J+Y*Y,tn=J*rt-Y*dt;if(Math.abs(tn)>Number.EPSILON){const Kt=Math.sqrt(rs),Pr=Math.sqrt(dt*dt+rt*rt),kr=O.x-Y/Kt,Or=O.y+J/Kt,Ph=I.x-rt/Pr,kh=I.y+dt/Pr,Fr=((Ph-kr)*rt-(kh-Or)*dt)/(J*rt-Y*dt);q=kr+J*Fr-P.x,N=Or+Y*Fr-P.y;const Rr=q*q+N*N;if(Rr<=2)return new _(q,N);G=Math.sqrt(Rr/2)}else{let Kt=!1;J>Number.EPSILON?dt>Number.EPSILON&&(Kt=!0):J<-Number.EPSILON?dt<-Number.EPSILON&&(Kt=!0):Math.sign(Y)===Math.sign(rt)&&(Kt=!0),Kt?(q=-Y,N=J,G=Math.sqrt(rs)):(q=J,N=Y,G=Math.sqrt(rs/2))}return new _(q/G,N/G)}const D=[];for(let P=0,O=B.length,I=O-1,q=P+1;P<O;P++,I++,q++)I===O&&(I=0),q===O&&(q=0),D[P]=H(B[P],B[I],B[q]);const R=[];let U,et=D.concat();for(let P=0,O=g.length;P<O;P++){const I=g[P];U=[];for(let q=0,N=I.length,G=N-1,J=q+1;q<N;q++,G++,J++)G===N&&(G=0),J===N&&(J=0),U[q]=H(I[q],I[G],I[J]);R.push(U),et=et.concat(U)}for(let P=0;P<y;P++){const O=P/y,I=f*Math.cos(O*Math.PI/2),q=d*Math.sin(O*Math.PI/2)+m;for(let N=0,G=B.length;N<G;N++){const J=C(B[N],D[N],q);ft(J.x,J.y,-I)}for(let N=0,G=g.length;N<G;N++){const J=g[N];U=R[N];for(let Y=0,dt=J.length;Y<dt;Y++){const rt=C(J[Y],U[Y],q);ft(rt.x,rt.y,-I)}}}const pt=d+m;for(let P=0;P<k;P++){const O=p?C(L[P],et[P],pt):L[P];v?(T.copy(z.normals[0]).multiplyScalar(O.x),F.copy(z.binormals[0]).multiplyScalar(O.y),$.copy(w[0]).add(T).add(F),ft($.x,$.y,$.z)):ft(O.x,O.y,0)}for(let P=1;P<=u;P++)for(let O=0;O<k;O++){const I=p?C(L[O],et[O],pt):L[O];v?(T.copy(z.normals[P]).multiplyScalar(I.x),F.copy(z.binormals[P]).multiplyScalar(I.y),$.copy(w[P]).add(T).add(F),ft($.x,$.y,$.z)):ft(I.x,I.y,c/u*P)}for(let P=y-1;P>=0;P--){const O=P/y,I=f*Math.cos(O*Math.PI/2),q=d*Math.sin(O*Math.PI/2)+m;for(let N=0,G=B.length;N<G;N++){const J=C(B[N],D[N],q);ft(J.x,J.y,c+I)}for(let N=0,G=g.length;N<G;N++){const J=g[N];U=R[N];for(let Y=0,dt=J.length;Y<dt;Y++){const rt=C(J[Y],U[Y],q);v?ft(rt.x,rt.y+w[u-1].y,w[u-1].x+I):ft(rt.x,rt.y,c+I)}}}Ot(),Ft();function Ot(){const P=i.length/3;if(p){let O=0,I=k*O;for(let q=0;q<V;q++){const N=A[q];Rt(N[2]+I,N[1]+I,N[0]+I)}O=u+y*2,I=k*O;for(let q=0;q<V;q++){const N=A[q];Rt(N[0]+I,N[1]+I,N[2]+I)}}else{for(let O=0;O<V;O++){const I=A[O];Rt(I[2],I[1],I[0])}for(let O=0;O<V;O++){const I=A[O];Rt(I[0]+k*u,I[1]+k*u,I[2]+k*u)}}s.addGroup(P,i.length/3-P,0)}function Ft(){const P=i.length/3;let O=0;mt(B,O),O+=B.length;for(let I=0,q=g.length;I<q;I++){const N=g[I];mt(N,O),O+=N.length}s.addGroup(P,i.length/3-P,1)}function mt(P,O){let I=P.length;for(;--I>=0;){const q=I;let N=I-1;N<0&&(N=P.length-1);for(let G=0,J=u+y*2;G<J;G++){const Y=k*G,dt=k*(G+1),rt=O+q+Y,rs=O+N+Y,tn=O+N+dt,Kt=O+q+dt;Se(rt,rs,tn,Kt)}}}function ft(P,O,I){l.push(P),l.push(O),l.push(I)}function Rt(P,O,I){yt(P),yt(O),yt(I);const q=i.length/3,N=M.generateTopUV(s,i,q-3,q-2,q-1);It(N[0]),It(N[1]),It(N[2])}function Se(P,O,I,q){yt(P),yt(O),yt(q),yt(O),yt(I),yt(q);const N=i.length/3,G=M.generateSideWallUV(s,i,N-6,N-3,N-2,N-1);It(G[0]),It(G[1]),It(G[3]),It(G[1]),It(G[2]),It(G[3])}function yt(P){i.push(l[P*3+0]),i.push(l[P*3+1]),i.push(l[P*3+2])}function It(P){n.push(P.x),n.push(P.y)}}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON(),e=this.parameters.shapes,s=this.parameters.options;return ka(e,s,t)}static fromJSON(t,e){const s=[];for(let n=0,o=t.shapes.length;n<o;n++){const a=e[t.shapes[n]];s.push(a)}const i=t.options.extrudePath;return i!==void 0&&(t.options.extrudePath=new Hn[i.type]().fromJSON(i)),new Ii(s,t.options)}}const Pa={generateTopUV:function(r,t,e,s,i){const n=t[e*3],o=t[e*3+1],a=t[s*3],l=t[s*3+1],h=t[i*3],u=t[i*3+1];return[new _(n,o),new _(a,l),new _(h,u)]},generateSideWallUV:function(r,t,e,s,i,n){const o=t[e*3],a=t[e*3+1],l=t[e*3+2],h=t[s*3],u=t[s*3+1],c=t[s*3+2],p=t[i*3],f=t[i*3+1],d=t[i*3+2],m=t[n*3],y=t[n*3+1],b=t[n*3+2];return Math.abs(a-u)<Math.abs(o-h)?[new _(o,1-l),new _(h,1-c),new _(p,1-d),new _(m,1-b)]:[new _(a,1-l),new _(u,1-c),new _(f,1-d),new _(y,1-b)]}};function ka(r,t,e){if(e.shapes=[],Array.isArray(r))for(let s=0,i=r.length;s<i;s++){const n=r[s];e.shapes.push(n.uuid)}else e.shapes.push(r.uuid);return e.options=Object.assign({},t),t.extrudePath!==void 0&&(e.options.extrudePath=t.extrudePath.toJSON()),e}class es extends tt{constructor(t=new oe([new _(0,.5),new _(-.5,-.5),new _(.5,-.5)]),e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const s=[],i=[],n=[],o=[];let a=0,l=0;if(Array.isArray(t)===!1)h(t);else for(let u=0;u<t.length;u++)h(t[u]),this.addGroup(a,l,u),a+=l,l=0;this.setIndex(s),this.setAttribute("position",new Mt(i,3)),this.setAttribute("normal",new Mt(n,3)),this.setAttribute("uv",new Mt(o,2));function h(u){const c=i.length/3,p=u.extractPoints(e);let f=p.shape;const d=p.holes;Pt.isClockWise(f)===!1&&(f=f.reverse());for(let y=0,b=d.length;y<b;y++){const M=d[y];Pt.isClockWise(M)===!0&&(d[y]=M.reverse())}const m=Pt.triangulateShape(f,d);for(let y=0,b=d.length;y<b;y++){const M=d[y];f=f.concat(M)}for(let y=0,b=f.length;y<b;y++){const M=f[y];i.push(M.x,M.y,0),n.push(0,0,1),o.push(M.x,M.y)}for(let y=0,b=m.length;y<b;y++){const M=m[y],w=M[0]+c,v=M[1]+c,z=M[2]+c;s.push(w,v,z),l+=3}}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON(),e=this.parameters.shapes;return Oa(e,t)}static fromJSON(t,e){const s=[];for(let i=0,n=t.shapes.length;i<n;i++){const o=e[t.shapes[i]];s.push(o)}return new es(s,t.curveSegments)}}function Oa(r,t){if(t.shapes=[],Array.isArray(r))for(let e=0,s=r.length;e<s;e++){const i=r[e];t.shapes.push(i.uuid)}else t.shapes.push(r.uuid);return t}const Ni={enabled:!1,files:{},add:function(r,t){this.enabled!==!1&&(this.files[r]=t)},get:function(r){if(this.enabled!==!1)return this.files[r]},remove:function(r){delete this.files[r]},clear:function(){this.files={}}};class Fa{constructor(t,e,s){const i=this;let n=!1,o=0,a=0,l;const h=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=s,this.itemStart=function(u){a++,n===!1&&i.onStart!==void 0&&i.onStart(u,o,a),n=!0},this.itemEnd=function(u){o++,i.onProgress!==void 0&&i.onProgress(u,o,a),o===a&&(n=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(u){i.onError!==void 0&&i.onError(u)},this.resolveURL=function(u){return l?l(u):u},this.setURLModifier=function(u){return l=u,this},this.addHandler=function(u,c){return h.push(u,c),this},this.removeHandler=function(u){const c=h.indexOf(u);return c!==-1&&h.splice(c,2),this},this.getHandler=function(u){for(let c=0,p=h.length;c<p;c+=2){const f=h[c],d=h[c+1];if(f.global&&(f.lastIndex=0),f.test(u))return d}return null}}}const Ra=new Fa;class jn{constructor(t){this.manager=t!==void 0?t:Ra,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const s=this;return new Promise(function(i,n){s.load(t,i,e,n)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}const Qt={};class Ia extends Error{constructor(t,e){super(t),this.response=e}}class Na extends jn{constructor(t){super(t)}load(t,e,s,i){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const n=Ni.get(t);if(n!==void 0)return this.manager.itemStart(t),setTimeout(()=>{e&&e(n),this.manager.itemEnd(t)},0),n;if(Qt[t]!==void 0){Qt[t].push({onLoad:e,onProgress:s,onError:i});return}Qt[t]=[],Qt[t].push({onLoad:e,onProgress:s,onError:i});const o=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,l=this.responseType;fetch(o).then(h=>{if(h.status===200||h.status===0){if(h.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||h.body===void 0||h.body.getReader===void 0)return h;const u=Qt[t],c=h.body.getReader(),p=h.headers.get("Content-Length")||h.headers.get("X-File-Size"),f=p?parseInt(p):0,d=f!==0;let m=0;const y=new ReadableStream({start(b){M();function M(){c.read().then(({done:w,value:v})=>{if(w)b.close();else{m+=v.byteLength;const z=new ProgressEvent("progress",{lengthComputable:d,loaded:m,total:f});for(let F=0,T=u.length;F<T;F++){const $=u[F];$.onProgress&&$.onProgress(z)}b.enqueue(v),M()}})}}});return new Response(y)}else throw new Ia(`fetch for "${h.url}" responded with ${h.status}: ${h.statusText}`,h)}).then(h=>{switch(l){case"arraybuffer":return h.arrayBuffer();case"blob":return h.blob();case"document":return h.text().then(u=>new DOMParser().parseFromString(u,a));case"json":return h.json();default:if(a===void 0)return h.text();{const c=/charset="?([^;"\s]*)"?/i.exec(a),p=c&&c[1]?c[1].toLowerCase():void 0,f=new TextDecoder(p);return h.arrayBuffer().then(d=>f.decode(d))}}}).then(h=>{Ni.add(t,h);const u=Qt[t];delete Qt[t];for(let c=0,p=u.length;c<p;c++){const f=u[c];f.onLoad&&f.onLoad(h)}}).catch(h=>{const u=Qt[t];if(u===void 0)throw this.manager.itemError(t),h;delete Qt[t];for(let c=0,p=u.length;c<p;c++){const f=u[c];f.onError&&f.onError(h)}this.manager.itemError(t)}).finally(()=>{this.manager.itemEnd(t)}),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class Da extends tt{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}toJSON(){const t=super.toJSON();return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}class La extends jn{constructor(t){super(t)}load(t,e,s,i){const n=this,o=new Na(n.manager);o.setPath(n.path),o.setRequestHeader(n.requestHeader),o.setWithCredentials(n.withCredentials),o.load(t,function(a){try{e(n.parse(JSON.parse(a)))}catch(l){i?i(l):console.error(l),n.manager.itemError(t)}},s,i)}parse(t){const e={},s={};function i(f,d){if(e[d]!==void 0)return e[d];const y=f.interleavedBuffers[d],b=n(f,y.buffer),M=ls(y.type,b),w=new jo(M,y.stride);return w.uuid=y.uuid,e[d]=w,w}function n(f,d){if(s[d]!==void 0)return s[d];const y=f.arrayBuffers[d],b=new Uint32Array(y).buffer;return s[d]=b,b}const o=t.isInstancedBufferGeometry?new Da:new tt,a=t.data.index;if(a!==void 0){const f=ls(a.type,a.array);o.setIndex(new nt(f,1))}const l=t.data.attributes;for(const f in l){const d=l[f];let m;if(d.isInterleavedBufferAttribute){const y=i(t.data,d.data);m=new Bs(y,d.itemSize,d.offset,d.normalized)}else{const y=ls(d.type,d.array),b=d.isInstancedBufferAttribute?Ko:nt;m=new b(y,d.itemSize,d.normalized)}d.name!==void 0&&(m.name=d.name),d.usage!==void 0&&m.setUsage(d.usage),d.updateRange!==void 0&&(m.updateRange.offset=d.updateRange.offset,m.updateRange.count=d.updateRange.count),o.setAttribute(f,m)}const h=t.data.morphAttributes;if(h)for(const f in h){const d=h[f],m=[];for(let y=0,b=d.length;y<b;y++){const M=d[y];let w;if(M.isInterleavedBufferAttribute){const v=i(t.data,M.data);w=new Bs(v,M.itemSize,M.offset,M.normalized)}else{const v=ls(M.type,M.array);w=new nt(v,M.itemSize,M.normalized)}M.name!==void 0&&(w.name=M.name),m.push(w)}o.morphAttributes[f]=m}t.data.morphTargetsRelative&&(o.morphTargetsRelative=!0);const c=t.data.groups||t.data.drawcalls||t.data.offsets;if(c!==void 0)for(let f=0,d=c.length;f!==d;++f){const m=c[f];o.addGroup(m.start,m.count,m.materialIndex)}const p=t.data.boundingSphere;if(p!==void 0){const f=new x;p.center!==void 0&&f.fromArray(p.center),o.boundingSphere=new Je(f,p.radius)}return t.name&&(o.name=t.name),t.userData&&(o.userData=t.userData),o}}const Kn=new _;class $a{constructor(t=new _(1/0,1/0),e=new _(-1/0,-1/0)){this.isBox2=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromPoints(t){this.makeEmpty();for(let e=0,s=t.length;e<s;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const s=Kn.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(s),this.max.copy(t).add(s),this}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,Kn).distanceTo(t)}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:nn}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=nn);function Va(r,t=!1){const e=r[0].index!==null,s=new Set(Object.keys(r[0].attributes)),i=new Set(Object.keys(r[0].morphAttributes)),n={},o={},a=r[0].morphTargetsRelative,l=new tt;let h=0;for(let u=0;u<r.length;++u){const c=r[u];let p=0;if(e!==(c.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const f in c.attributes){if(!s.has(f))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+'. All geometries must have compatible attributes; make sure "'+f+'" attribute exists among all geometries, or in none of them.'),null;n[f]===void 0&&(n[f]=[]),n[f].push(c.attributes[f]),p++}if(p!==s.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". Make sure all geometries have the same number of attributes."),null;if(a!==c.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const f in c.morphAttributes){if(!i.has(f))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+".  .morphAttributes must be consistent throughout all geometries."),null;o[f]===void 0&&(o[f]=[]),o[f].push(c.morphAttributes[f])}if(t){let f;if(e)f=c.index.count;else if(c.attributes.position!==void 0)f=c.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". The geometry must have either an index or a position attribute"),null;l.addGroup(h,f,u),h+=f}}if(e){let u=0;const c=[];for(let p=0;p<r.length;++p){const f=r[p].index;for(let d=0;d<f.count;++d)c.push(f.getX(d)+u);u+=r[p].attributes.position.count}l.setIndex(c)}for(const u in n){const c=tr(n[u]);if(!c)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+u+" attribute."),null;l.setAttribute(u,c)}for(const u in o){const c=o[u][0].length;if(c===0)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[u]=[];for(let p=0;p<c;++p){const f=[];for(let m=0;m<o[u].length;++m)f.push(o[u][m][p]);const d=tr(f);if(!d)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+u+" morphAttribute."),null;l.morphAttributes[u].push(d)}}return l}function tr(r){let t,e,s,i=0;for(let a=0;a<r.length;++a){const l=r[a];if(l.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(t===void 0&&(t=l.array.constructor),t!==l.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(e===void 0&&(e=l.itemSize),e!==l.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(s===void 0&&(s=l.normalized),s!==l.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;i+=l.array.length}const n=new t(i);let o=0;for(let a=0;a<r.length;++a)n.set(r[a].array,o),o+=r[a].array.length;return new nt(n,e,s)}function qa(r,t=1e-4){t=Math.max(t,Number.EPSILON);const e={},s=r.getIndex(),i=r.getAttribute("position"),n=s?s.count:i.count;let o=0;const a=Object.keys(r.attributes),l={},h={},u=[],c=["getX","getY","getZ","getW"],p=["setX","setY","setZ","setW"];for(let y=0,b=a.length;y<b;y++){const M=a[y],w=r.attributes[M];l[M]=new nt(new w.array.constructor(w.count*w.itemSize),w.itemSize,w.normalized);const v=r.morphAttributes[M];v&&(h[M]=new nt(new v.array.constructor(v.count*v.itemSize),v.itemSize,v.normalized))}const f=Math.log10(1/t),d=Math.pow(10,f);for(let y=0;y<n;y++){const b=s?s.getX(y):y;let M="";for(let w=0,v=a.length;w<v;w++){const z=a[w],F=r.getAttribute(z),T=F.itemSize;for(let $=0;$<T;$++)M+=`${~~(F[c[$]](b)*d)},`}if(M in e)u.push(e[M]);else{for(let w=0,v=a.length;w<v;w++){const z=a[w],F=r.getAttribute(z),T=r.morphAttributes[z],$=F.itemSize,Z=l[z],L=h[z];for(let g=0;g<$;g++){const S=c[g],A=p[g];if(Z[A](o,F[S](b)),T)for(let B=0,C=T.length;B<C;B++)L[B][A](o,T[B][S](b))}}e[M]=o,u.push(o),o++}}const m=r.clone();for(const y in r.attributes){const b=l[y];if(m.setAttribute(y,new nt(b.array.slice(0,o*b.itemSize),b.itemSize,b.normalized)),y in h)for(let M=0;M<h[y].length;M++){const w=h[y][M];m.morphAttributes[y][M]=new nt(w.array.slice(0,o*w.itemSize),w.itemSize,w.normalized)}}return m.setIndex(u),m}function Di(r,t=!1){return console.warn("THREE.BufferGeometryUtils: mergeBufferGeometries() has been renamed to mergeGeometries()."),Va(r,t)}new Tt,new x,new x;const Ls=new K,er=new x,Ua=new We;function Ha(r,t,e=Ls){return er.crossVectors(r,t),e.makeBasis(r,t,er)}function be(r,t,e,s=Ls){return s.makeTranslation(r,t,e)}function Li(r,t,e,s=Ls){return s.makeRotationFromEuler(Ua.set(r,t,e))}function Ga(r,t,e,s=Ls){return s.makeScale(r,t,e)}const sr=new K,$i=new x,ir=new zt;function ae(r,t){return r.matrixAutoUpdate=!1,r.matrix=t,r.updateMatrixWorld(!0),r}var nr;(function(r){r[r.Point=0]="Point",r[r.Line=1]="Line",r[r.Mesh=2]="Mesh"})(nr||(nr={}));class Le{constructor(){it(this,"geometryCache",null);it(this,"objectCache",null);it(this,"outlineCache",null)}getGeometry(){return this.geometryCache===null&&(this.geometryCache=this.computeGeometry()),this.geometryCache}getOutline(){return this.outlineCache==null&&(this.outlineCache=this.computeOutline()),this.outlineCache}getObject(){return this.objectCache==null&&(this.objectCache=this.computeObject3D()),this.objectCache}dispose(){var t;(t=this.geometryCache)==null||t.dispose()}multiplyMatrix(t){this.matrix.multiply(t)}premultiplyMatrix(t){this.matrix.premultiply(t)}}class $e extends Le{constructor(e){super();it(this,"matrix");this.matrix=e}multiplyMatrix(e){return new $e(this.matrix.clone().multiply(e))}getBoundingBox(e){e.min.set(0,0,0),e.max.set(0,0,0)}getVertecies(){return[new x]}extrude(e){throw new Error("method not implemented")}components(e){return e==="points"?[this.clone()]:[]}computeObject3D(){return ae(new Dn(new tt().setFromPoints([new x])),this.matrix)}computeOutline(){const e=new Dn(new tt().setFromPoints([new x]),new In({color:0,size:3e-8,transparent:!0,depthTest:!1}));return e.renderOrder=1e3,ae(e,this.matrix)}clone(){return new $e(this.matrix.clone())}computeGeometry(){return new tt().setFromPoints([new x().setFromMatrixPosition(this.matrix)])}getSize(e){return e===0?1:0}samplePoints(e){return new Array(e).fill(null).map(()=>this.clone())}}const ss=new $a,rr=new x(0,1,0),Ja=new x(0,0,1);new K;class he extends Le{constructor(e,s){super();it(this,"matrix");it(this,"shape");this.matrix=e,this.shape=s}clone(){return new he(this.matrix.clone(),this.shape.clone())}getVertecies(){return this.shape.getPoints().map(({x:e,y:s})=>new x(e,0,s))}static fromLengthAndHeight(e,s,i,n){const o=[new _(s,0),new _(s,i),new _(0,i),new _(0,0)],a=new oe(o);return ir.setFromUnitVectors(Ja,n),sr.makeRotationFromQuaternion(ir),e.multiply(sr),new he(e,a)}getBoundingBox(e){ss.setFromPoints(this.shape.getPoints()),e.min.set(ss.min.x,0,ss.min.y),e.max.set(ss.max.x,0,ss.max.y)}computeGeometry(){const e=new es(this.shape);Vi(e),$s(e);const s=new tt;return s.attributes=e.attributes,s.index=e.index,s}invert(){const e=this.matrix.clone();e.multiply(Li(Math.PI,0,0));const s=this.shape.getPoints(5),i=this.shape.holes,n=new oe(s.map(({x:o,y:a})=>new _(o,-a)));return n.holes=i.map(o=>new ki(o.getPoints().map(({x:a,y:l})=>new _(a,-l)))),new he(e,n)}extrude(e){const s=this.matrix.clone();this.matrix.identity(),this.multiplyMatrix(be(0,e,0));const i=this.shape.getPoints(5);return new Vs(s,[...i.map((n,o)=>{const a=i[(o+1)%i.length];$i.set(a.x-n.x,0,a.y-n.y);const l=$i.length(),h=be(n.x,0,n.y,new K);h.multiply(Ha($i.normalize(),rr));const u=he.fromLengthAndHeight(h,l,e,rr);return e<0?u.invert():u}),this.clone()])}components(e){switch(e){case"points":return this.shape.extractPoints(5).shape.map(s=>new $e(this.matrix.clone().multiply(be(s.x,0,s.y))));case"faces":return[this];default:throw new Error("not implemented")}}computeObject3D(){return ae(new _n(this.getGeometry()),this.matrix)}computeOutline(){const e=this.pathToOutline(this.shape.extractPoints(5).shape),s=this.shape.holes.map(n=>this.pathToOutline(n.getPoints(5))),i=ae(new lt,this.matrix);return i.renderOrder=1e3,i.add(e,...s),i}pathToOutline(e){if(e.length===0)return new lt;e.push(e[0]);const s=new tt().setFromPoints(e);return $s(s),new On(s,new vn({color:0,transparent:!0}))}expand(e,s,i){throw new Error("not implemented")}getSize(e){if(e===2){const s=Pt.area(this.shape.getPoints(5));return this.shape.holes.reduce((i,n)=>i-Pt.area(n.getPoints(5)),s)}return 0}}function $s(r){let t;const e=r.getAttribute("position"),s=r.getAttribute("normal");for(let i=0;i<e.count;i++)t=e.getY(i),e.setY(i,e.getZ(i)),e.setZ(i,t),t=s.getY(i),s.setY(i,s.getZ(i)),s.setZ(i,t)}function Vi(r){let t;for(let e=0;e<r.index.count;e+=3)t=r.index.getX(e),r.index.setX(e,r.index.getX(e+2)),r.index.setX(e+2,t)}const qi=new Tt,Wa=new Mi(1,1,1);new Gn(Wa);class Ui extends Le{constructor(e,s){super();it(this,"matrix");it(this,"geometry");this.matrix=e,this.geometry=s,s.computeBoundingBox()}clone(){return new Ui(this.matrix.clone(),this.geometry.clone())}extrude(e){throw new Error("Method not implemented.")}components(e){throw new Error("Method not implemented.")}computeObject3D(){return ae(new _n(this.getGeometry()),this.matrix)}getVertecies(){throw new Error("Method not implemented.")}getBoundingBox(e){e.copy(this.geometry.boundingBox)}computeGeometry(){return this.geometry}computeOutline(){const e=new ta(new Gn(this.geometry),new En({color:0}));return ae(e,this.matrix),e.renderOrder=1e3,e}expand(e,s,i){throw new Error("Method not implemented.")}getSize(e){throw new Error("Method not implemented.")}}class Vs extends Le{constructor(e,s){super();it(this,"matrix");it(this,"primitives");this.matrix=e,this.primitives=s}clone(){return new Vs(this.matrix.clone(),this.primitives.map(e=>e.clone()))}getVertecies(){return this.primitives.reduce((e,s)=>e.concat(s.getVertecies().map(i=>i.applyMatrix4(s.matrix))),[])}extrude(e){return new Vs(this.matrix,this.primitives.map(s=>s.extrude(e)))}components(e){const s=this.primitives.map(i=>i.components(e)).reduce((i,n)=>i.concat(n));for(const i of s)i.premultiplyMatrix(this.matrix);return s}computeObject3D(){const e=ae(new lt,this.matrix);return this.primitives.forEach(s=>e.add(s.getObject())),e}getBoundingBox(e){e.makeEmpty(),this.primitives.forEach(s=>{s.getBoundingBox(qi),qi.applyMatrix4(s.matrix),e.union(qi)})}computeGeometry(){const e=this.primitives.map(i=>i.getGeometry().clone().applyMatrix4(i.matrix)).filter(os),s=Di(e);return e.forEach(i=>i.dispose()),s}computeOutline(){const e=ae(new lt,this.matrix);return this.primitives.forEach(s=>e.add(s.getOutline())),e.renderOrder=1e3,e}getSize(e){return this.primitives.reduce((s,i)=>i.getSize(e)+s,0)}}class Za extends Ii{constructor(t,e,s){super(new oe([new _(0,0),new _(t/2,e),new _(t,0)]),{depth:s,bevelEnabled:!1})}}const is=new Tt,qs=new x;function Xa(r,t,e,s,i,n,o,a){const l=i==null?0:Math.PI*i/180,h=Li(0,-l,0);is.setFromPoints(s.getVertecies().map(p=>p.applyMatrix4(h))),is.getSize(qs);const u=new Za(n??qs.x,o??qs.y,a??qs.z);u.translate(is.min.x,is.min.y,is.min.z),u.computeBoundingBox(),u.rotateY(l);const c=new tt;return c.attributes=u.attributes,c.index=u.index,r(new Ui(s.matrix,c))}const ar=new zt;function Us(r,t){return r[t]}function Ya(r,t,e){r[t]=e}function Qa(r){ar.setFromRotationMatrix(r),Lt.set(0,1,0),Lt.applyQuaternion(ar);const t=Math.abs(Lt.x),e=Math.abs(Lt.y),s=Math.abs(Lt.z),i=Math.max(t,e,s);return t===i?Lt.x<0?"west":"east":e===i?Lt.y<0?"down":"up":Lt.z<0?"south":"north"}const Lt=new x,ct=new Tt,ja=new x,hr=new Tt;function Ka(r,t,e){r.getBoundingBox(ct),ja.copy(ct.min);let s=0;const i=[];for(;Us(ct.min,t)<Us(ct.max,t);){const n=r.matrix.clone();n.multiply(be(ct.min.x,ct.min.y,ct.min.z));const o=e(n,s,ct.max.x-ct.min.x,ct.max.y-ct.min.y,ct.max.z-ct.min.z);i.push(o),o.getBoundingBox(hr),hr.getSize(Lt),s++,Ya(ct.min,t,Us(ct.min,t)+Us(Lt,t))}return i}Ni.enabled=!0;function th(r,t,e,s,i,n){return s.matrix.multiply(be(i,0,n)),r(new $e(s.matrix))}const Hi=new x;function eh(r,t,e,s,...i){if(i.length<3)return r(s);const n=i.map(o=>(Hi.setFromMatrixPosition(o.matrix),new _(Hi.x,Hi.z)));return Pt.isClockWise(n)&&n.reverse(),r(new he(s.matrix,new oe(n)))}const lr=new x,ur=new Tt;function sh(r,t,e,s,i){return s.getBoundingBox(ur),ur.getSize(lr),r(lr[i])}function ih(r,t,e,s,i,n,o){return s.multiplyMatrix(Ga(i,n,o)),r(s)}function Gi(r){return Math.PI*r/180}function nh(r,t,e,s,i,n,o){return s.multiplyMatrix(Li(Gi(i),Gi(n),Gi(o))),r(s)}function rh(r,t,e,s,i,n,o){return s.multiplyMatrix(be(i,n,o)),r(s)}function oh(r,t,e,s,i){return r(s.extrude(i))}function ah(r,t,e,s,...i){const n=i.reduce((o,a)=>[...o,...a.components(r)],[]);return t(n)}const cr=new x(0,0,1);function hh(r,t,e,s,i,n,...o){if(o.length===0)return r(s);const a=Ka(s,i,(l,h,u,c,p)=>{const f=Math.floor(h/o.length),d=o[h%o.length];if(n===!1&&f==0||n===!0||typeof n=="number"&&f<n){const m=i==="x"?Math.min(d,u):u,y=i==="z"?Math.min(d,p):p;return he.fromLengthAndHeight(l,m,y,cr)}else return he.fromLengthAndHeight(l,u,p,cr)});return r(a)}function lh(r,t,e,s){return r(Qa(s.matrix))}const uh={translate:{execute:rh,includeThis:!0,includeQueue:!1,defaultParameters:[()=>({type:"raw",value:0}),()=>({type:"raw",value:0}),()=>({type:"raw",value:0})]},scale:{execute:ih,includeThis:!0,includeQueue:!1,defaultParameters:[()=>({type:"raw",value:1}),()=>({type:"raw",value:1}),()=>({type:"raw",value:1})]},rotate:{execute:nh,includeThis:!0,includeQueue:!1,defaultParameters:[()=>({type:"raw",value:0}),()=>({type:"raw",value:0}),()=>({type:"raw",value:0})]},extrude:{execute:oh,includeThis:!0,includeQueue:!1,defaultParameters:[()=>({type:"raw",value:1})]},split:{execute:hh,includeThis:!0,includeQueue:!1,defaultParameters:[()=>({type:"raw",value:"x"}),()=>({type:"raw",value:!0}),()=>({type:"raw",value:1})]},toFaces:{execute:ah.bind(null,"faces"),includeThis:!0,includeQueue:!1,defaultParameters:[]},size:{execute:sh,includeThis:!0,includeQueue:!1,defaultParameters:[()=>({type:"raw",value:"x"})]},point2:{execute:th,includeThis:!0,includeQueue:!1,defaultParameters:[()=>({type:"raw",value:0}),()=>({type:"raw",value:0})]},face:{execute:eh,includeThis:!0,includeQueue:!1,defaultParameters:[]},gableRoof:{execute:Xa,includeThis:!0,includeQueue:!1,defaultParameters:[()=>({type:"raw",value:0})]},direction:{execute:lh,includeThis:!0,includeQueue:!1,defaultParameters:[]}};function ch(r){return r instanceof Le}function ph(r){return r.length===0?null:Di(r.map(t=>t.getGeometry().clone().applyMatrix4(t.matrix)))}const Ji=new x;new x;function pr(r,t,e){if(r.length===0)return;if(r.length===1)return Math.abs(r[0].t-t)>=e?void 0:0;let s=r.length-2;for(;s>0&&r[s].t>t;)s--;if(r[s].t<=t+e&&t-e<=r[s+1].t)return s}function fr(r,t,e,s){const{position:i,t:n}=r[e];if(e+1>=r.length){s.set(...i);return}Ji.set(...i);const{position:o,t:a}=r[e+1];s.set(...o);const l=(t-n)/(a-n);s.sub(Ji).multiplyScalar(l).add(Ji)}class Q{static roundNumber(t,e){const s=Math.pow(10,e);return Math.round(t*s)/s}static sample(t){return t[Math.floor(Math.random()*t.length)]}static distanceToSquared(t,e){var s=t.x-e.x,i=t.y-e.y,n=t.z-e.z;return s*s+i*i+n*n}static isPointInPoly(t,e){for(var s=!1,i=-1,n=t.length,o=n-1;++i<n;o=i)(t[i].z<=e.z&&e.z<t[o].z||t[o].z<=e.z&&e.z<t[i].z)&&e.x<(t[o].x-t[i].x)*(e.z-t[i].z)/(t[o].z-t[i].z)+t[i].x&&(s=!s);return s}static isVectorInPolygon(t,e,s){var i=1e5,n=-1e5,o=[];return e.vertexIds.forEach(a=>{i=Math.min(s[a].y,i),n=Math.max(s[a].y,n),o.push(s[a])}),!!(t.y<n+.5&&t.y>i-.5&&this.isPointInPoly(o,t))}static triarea2(t,e,s){return(s.x-t.x)*(e.z-t.z)-(e.x-t.x)*(s.z-t.z)}static vequal(t,e){return this.distanceToSquared(t,e)<1e-5}static mergeVertices(t,e=1e-4){e=Math.max(e,Number.EPSILON);for(var s={},i=t.getIndex(),n=t.getAttribute("position"),o=i?i.count:n.count,a=0,l=[],h=[],u=Math.log10(1/e),c=Math.pow(10,u),p=0;p<o;p++){var f=i?i.getX(p):p,d="";d+=~~(n.getX(f)*c)+",",d+=~~(n.getY(f)*c)+",",(d+=~~(n.getZ(f)*c)+",")in s?l.push(s[d]):(h.push(n.getX(f)),h.push(n.getY(f)),h.push(n.getZ(f)),s[d]=a,l.push(a),a++)}const m=new nt(new Float32Array(h),n.itemSize,n.normalized),y=new tt;return y.setAttribute("position",m),y.setIndex(l),y}}class fh{constructor(t){this.content=[],this.scoreFunction=t}push(t){this.content.push(t),this.sinkDown(this.content.length-1)}pop(){const t=this.content[0],e=this.content.pop();return this.content.length>0&&(this.content[0]=e,this.bubbleUp(0)),t}remove(t){const e=this.content.indexOf(t),s=this.content.pop();e!==this.content.length-1&&(this.content[e]=s,this.scoreFunction(s)<this.scoreFunction(t)?this.sinkDown(e):this.bubbleUp(e))}size(){return this.content.length}rescoreElement(t){this.sinkDown(this.content.indexOf(t))}sinkDown(t){const e=this.content[t];for(;t>0;){const s=(t+1>>1)-1,i=this.content[s];if(!(this.scoreFunction(e)<this.scoreFunction(i)))break;this.content[s]=e,this.content[t]=i,t=s}}bubbleUp(t){const e=this.content.length,s=this.content[t],i=this.scoreFunction(s);for(;;){const n=t+1<<1,o=n-1;let a,l=null;if(o<e&&(a=this.scoreFunction(this.content[o]),a<i&&(l=o)),n<e&&this.scoreFunction(this.content[n])<(l===null?i:a)&&(l=n),l===null)break;this.content[t]=this.content[l],this.content[l]=s,t=l}}}class dh{constructor(){this.portals=[]}push(t,e){e===void 0&&(e=t),this.portals.push({left:t,right:e})}stringPull(){const t=this.portals,e=[];let s,i,n,o=0,a=0,l=0;s=t[0].left,i=t[0].left,n=t[0].right,e.push(s);for(let h=1;h<t.length;h++){const u=t[h].left,c=t[h].right;if(Q.triarea2(s,n,c)<=0){if(!(Q.vequal(s,n)||Q.triarea2(s,i,c)>0)){e.push(i),s=i,o=a,i=s,n=s,a=o,l=o,h=o;continue}n=c,l=h}if(Q.triarea2(s,i,u)>=0){if(!(Q.vequal(s,i)||Q.triarea2(s,n,u)<0)){e.push(n),s=n,o=l,i=s,n=s,a=o,l=o,h=o;continue}i=u,a=h}}return e.length!==0&&Q.vequal(e[e.length-1],t[t.length-1].left)||e.push(t[t.length-1].left),this.path=e,e}}class Hs{constructor(){this.zones={}}static createZone(t,e=1e-4){return class{static buildZone(s,i){const n=this._buildNavigationMesh(s,i),o={};n.vertices.forEach(l=>{l.x=Q.roundNumber(l.x,2),l.y=Q.roundNumber(l.y,2),l.z=Q.roundNumber(l.z,2)}),o.vertices=n.vertices;const a=this._buildPolygonGroups(n);return o.groups=new Array(a.length),a.forEach((l,h)=>{const u=new Map;l.forEach((p,f)=>{u.set(p,f)});const c=new Array(l.length);l.forEach((p,f)=>{const d=[];p.neighbours.forEach(b=>d.push(u.get(b)));const m=[];p.neighbours.forEach(b=>m.push(this._getSharedVerticesInOrder(p,b)));const y=new x(0,0,0);y.add(o.vertices[p.vertexIds[0]]),y.add(o.vertices[p.vertexIds[1]]),y.add(o.vertices[p.vertexIds[2]]),y.divideScalar(3),y.x=Q.roundNumber(y.x,2),y.y=Q.roundNumber(y.y,2),y.z=Q.roundNumber(y.z,2),c[f]={id:f,neighbours:d,vertexIds:p.vertexIds,centroid:y,portals:m}}),o.groups[h]=c}),o}static _buildNavigationMesh(s,i){return s=Q.mergeVertices(s,i),this._buildPolygonsFromGeometry(s)}static _spreadGroupId(s){let i=new Set([s]);for(;i.size>0;){const n=i;i=new Set,n.forEach(o=>{o.group=s.group,o.neighbours.forEach(a=>{a.group===void 0&&i.add(a)})})}}static _buildPolygonGroups(s){const i=[];return s.polygons.forEach(n=>{n.group!==void 0?i[n.group].push(n):(n.group=i.length,this._spreadGroupId(n),i.push([n]))}),i}static _buildPolygonNeighbours(s,i){const n=new Set,o=i[s.vertexIds[1]],a=i[s.vertexIds[2]];return i[s.vertexIds[0]].forEach(l=>{l!==s&&(o.includes(l)||a.includes(l))&&n.add(l)}),o.forEach(l=>{l!==s&&a.includes(l)&&n.add(l)}),n}static _buildPolygonsFromGeometry(s){const i=[],n=[],o=s.attributes.position,a=s.index,l=[];for(let h=0;h<o.count;h++)n.push(new x().fromBufferAttribute(o,h)),l[h]=[];for(let h=0;h<s.index.count;h+=3){const u=a.getX(h),c=a.getX(h+1),p=a.getX(h+2),f={vertexIds:[u,c,p],neighbours:null};i.push(f),l[u].push(f),l[c].push(f),l[p].push(f)}return i.forEach(h=>{h.neighbours=this._buildPolygonNeighbours(h,l)}),{polygons:i,vertices:n}}static _getSharedVerticesInOrder(s,i){const n=s.vertexIds,o=n[0],a=n[1],l=n[2],h=i.vertexIds,u=h.includes(o),c=h.includes(a),p=h.includes(l);return u&&c&&p?Array.from(n):u&&c?[o,a]:c&&p?[a,l]:u&&p?[l,o]:(console.warn("Error processing navigation mesh neighbors; neighbors with <2 shared vertices found."),[])}}.buildZone(t,e)}setZoneData(t,e){this.zones[t]=e}getRandomNode(t,e,s,i){if(!this.zones[t])return new x;s=s||null,i=i||0;const n=[];return this.zones[t].groups[e].forEach(o=>{s&&i?Q.distanceToSquared(s,o.centroid)<i*i&&n.push(o.centroid):n.push(o.centroid)}),Q.sample(n)||new x}getClosestNode(t,e,s,i=!1){const n=this.zones[e].vertices;let o=null,a=1/0;return this.zones[e].groups[s].forEach(l=>{const h=Q.distanceToSquared(l.centroid,t);h<a&&(!i||Q.isVectorInPolygon(t,l,n))&&(o=l,a=h)}),o}findPath(t,e,s,i){const n=this.zones[s].groups[i],o=this.zones[s].vertices,a=this.getClosestNode(t,s,i,!0),l=this.getClosestNode(e,s,i,!0);if(!a||!l)return null;const h=class{static init(f){for(let d=0;d<f.length;d++){const m=f[d];m.f=0,m.g=0,m.h=0,m.cost=1,m.visited=!1,m.closed=!1,m.parent=null}}static cleanUp(f){for(let d=0;d<f.length;d++){const m=f[d];delete m.f,delete m.g,delete m.h,delete m.cost,delete m.visited,delete m.closed,delete m.parent}}static heap(){return new fh(function(f){return f.f})}static search(f,d,m){this.init(f);const y=this.heap();for(y.push(d);y.size()>0;){const b=y.pop();if(b===m){let w=b;const v=[];for(;w.parent;)v.push(w),w=w.parent;return this.cleanUp(v),v.reverse()}b.closed=!0;const M=this.neighbours(f,b);for(let w=0,v=M.length;w<v;w++){const z=M[w];if(z.closed)continue;const F=b.g+z.cost,T=z.visited;if(!T||F<z.g){if(z.visited=!0,z.parent=b,!z.centroid||!m.centroid)throw new Error("Unexpected state");z.h=z.h||this.heuristic(z.centroid,m.centroid),z.g=F,z.f=z.g+z.h,T?y.rescoreElement(z):y.push(z)}}}return[]}static heuristic(f,d){return Q.distanceToSquared(f,d)}static neighbours(f,d){const m=[];for(let y=0;y<d.neighbours.length;y++)m.push(f[d.neighbours[y]]);return m}}.search(n,a,l),u=function(f,d){for(var m=0;m<f.neighbours.length;m++)if(f.neighbours[m]===d.id)return f.portals[m]},c=new dh;c.push(t);for(let f=0;f<h.length;f++){const d=h[f],m=h[f+1];if(m){const y=u(d,m);c.push(o[y[0]],o[y[1]])}}c.push(e),c.stringPull();const p=c.path.map(f=>new x(f.x,f.y,f.z));return p.shift(),p}}Hs.prototype.getGroup=function(){const r=new Bn;return function(t,e,s=!1){if(!this.zones[t])return null;let i=null,n=Math.pow(50,2);const o=this.zones[t];for(let a=0;a<o.groups.length;a++){const l=o.groups[a];for(const h of l){if(s&&(r.setFromCoplanarPoints(o.vertices[h.vertexIds[0]],o.vertices[h.vertexIds[1]],o.vertices[h.vertexIds[2]]),Math.abs(r.distanceToPoint(e))<.01)&&Q.isPointInPoly([o.vertices[h.vertexIds[0]],o.vertices[h.vertexIds[1]],o.vertices[h.vertexIds[2]]],e))return a;const u=Q.distanceToSquared(h.centroid,e);u<n&&(i=a,n=u)}}return i}}(),Hs.prototype.clampStep=function(){const r=new x,t=new Bn,e=new bt,s=new x;let i,n,o=new x;return function(a,l,h,u,c,p){const f=this.zones[u].vertices,d=this.zones[u].groups[c],m=[h],y={};y[h.id]=0,i=void 0,o.set(0,0,0),n=1/0,t.setFromCoplanarPoints(f[h.vertexIds[0]],f[h.vertexIds[1]],f[h.vertexIds[2]]),t.projectPoint(l,r),s.copy(r);for(let b=m.pop();b;b=m.pop()){e.set(f[b.vertexIds[0]],f[b.vertexIds[1]],f[b.vertexIds[2]]),e.closestPointToPoint(s,r),r.distanceToSquared(s)<n&&(i=b,o.copy(r),n=r.distanceToSquared(s));const M=y[b.id];if(!(M>2))for(let w=0;w<b.neighbours.length;w++){const v=d[b.neighbours[w]];v.id in y||(m.push(v),y[v.id]=M+1)}}return p.copy(o),i}}(),new Ct(15631215).convertSRGBToLinear().getHex(),new Ct(14469912).convertSRGBToLinear().getHex(),new Ct(41903).convertSRGBToLinear().getHex(),new Ct(41903).convertSRGBToLinear().getHex(),new Ct(14472114).convertSRGBToLinear().getHex(),new Ct(4417387).convertSRGBToLinear().getHex();const mh=new x,Gs=2;function dr(r,t,e){if(t===e)return;let s=r[t];s==null&&(s=[],r[t]=s),s.push(e)}const mr=new x(0,1,0);function yh(r,t,e=mr,s=3){const i=[],n=[];for(const o of r){if(o.type!=t)continue;const a=new x(o.points[0].x,0,o.points[0].y);let l=yr(i,a,o.points[0].size);for(let h=1;h<o.points.length;h++){const u=new x(o.points[h].x,0,o.points[h].y),c=yr(i,u,o.points[h].size);dr(n,l,c),dr(n,c,l),l=c}}for(let o=0;o<n.length;o++){const a=n[o];if(a==null)continue;const l=a.slice(1).map(h=>({index:h,angle:wh(i[o].position,i[a[0]].position,i[h].position,e)})).sort((h,u)=>h.angle-u.angle);n[o]=[a[0],...l.map(({index:h})=>h)]}return{connectionsList:n,points:i}}function yr(r,t,e){let s=r.findIndex(i=>mh.copy(i.position).sub(t).length()*2<i.size+e);return s===-1&&(s=r.length,r.push({position:t,size:e})),s}function $t({x:r,z:t},e){return e.set(r,t)}const we=new _,ns=new _,Wi=new _;function xh(r,t,e=mr){if(r.points.length===0)return null;const s=new Set,i=Di(r.connectionsList.map((n,o)=>{if(n==null||n.length<3)return;const a=r.points[o];$t(a.position,we);const l=new oe(n.map((u,c)=>{const p=new _,f=n[(c+1)%n.length],d=r.points[u],m=r.points[f];return Xi(we,a.size+t,$t(d.position,ns),d.size+t,$t(m.position,Wi),m.size+t,p)}).filter(os)),h=new es(l);return $s(h),Vi(h),h}).filter(os).concat(r.connectionsList.reduce((n,o,a)=>(o!=null&&n.push(...o.map((l,h)=>{const u=`${l}/${a}`,c=`${a}/${l}`;if(s.has(u)||s.has(c))return;s.add(u);const p=r.connectionsList[l],f=p.findIndex(y=>a===y),d=new oe([...xr(r.points,a,h,o,t),...xr(r.points,l,f,p,t)]),m=new es(d);return $s(m),Vi(m),m}).filter(os)),n),[])));return delete i.attributes.uv,qa(i.toNonIndexed(),.1)}function xr(r,t,e,s,i){const n=r[t];$t(n.position,we);const o=s[e],a=r[o];if(s.length<2)return[vr(we,n.size+i,$t(a.position,ns),!0),vr(we,n.size+i,$t(a.position,ns),!1)];const l=s[(e-1+s.length)%s.length],h=s[(e+1)%s.length],u=r[l],c=r[h];return[Xi(we,n.size+i,$t(u.position,Wi),u.size+i,$t(a.position,ns),a.size+i,new _),Xi(we,n.size+i,$t(a.position,ns),a.size+i,$t(c.position,Wi),c.size+i,new _)]}const Zi=new _,gr=new _,br=new _,wr=new _;function Xi(r,t,e,s,i,n,o){return t=Math.max(t,Gs),s=Math.max(s,Gs),n=Math.max(n,Gs),Mr(r,t,e,s,!1,Zi,gr),Mr(r,t,i,n,!0,br,wr),gh(Zi,gr,br,wr,o)||o.copy(Zi),o}const jt=new _;function vr(r,t,e,s,i=new _){t=Math.max(t,Gs),i.copy(r).sub(e);const n=i.x;return i.x=-i.y,i.y=n,i.normalize(),s&&i.negate(),i.multiplyScalar(t/2).add(r)}function Mr(r,t,e,s,i,n,o){jt.copy(r).sub(e);const a=jt.x;jt.x=-jt.y,jt.y=a,jt.normalize(),i&&jt.negate(),n.copy(jt).multiplyScalar(t/2).add(r),o.copy(jt).multiplyScalar(s/2).add(e)}function gh(r,t,e,s,i){const n=e.x-s.x,o=r.x-t.x,a=e.y-s.y,l=r.y-t.y,h=o*a-l*n;if(h==0)return!1;const u=r.x*t.y-r.y*t.x,c=e.x*s.y-e.y*s.x;return i.x=(u*n-o*c)/h,i.y=(u*a-l*c)/h,!0}const Js=new x,Ws=new x,bh=new x;function wh(r,t,e,s){Js.copy(t).sub(r),Ws.copy(e).sub(r);const i=bh.crossVectors(Js,s).dot(Ws)<0;Js.projectOnPlane(s),Ws.projectOnPlane(s);const n=Js.angleTo(Ws);return i?n:Math.PI*2-n}function Yi(r,t,e=0){const s=yh(r,t);return xh(s,e)}function Qi(r){return"points"in r}const vh={pathwayFrom:{defaultParameters:[],includeThis:!0,includeQueue:!1,execute:(r,t,e,s,i,n,o)=>r({points:[{x:i,y:n,size:o,astId:t}],type:s.type})},pathwayTo:{defaultParameters:[],includeThis:!0,includeQueue:!1,execute:(r,t,e,s,i,n,o)=>(s.points.push({x:i,y:n,size:o,astId:t}),r(s))}},le="Default-Zone",ji=new x,Mh=new x;function Sr(r,t,e,s,i,n,o){const a=Ki(r,t,e);if(a==null)return;ji.set(...s.position);let l,h,u;for(let p=0;p<a.zones[le].groups.length;p++){const{centroid:f}=a.getClosestNode(ji,le,p),d=ji.distanceTo(f);(h==null||d<h)&&(h=d,l=f,u=p)}if(l==null||u==null)return;const{centroid:c}=a.getClosestNode(Mh.set(i,n,o),le,u);return a.findPath(l,c,le,u)}function Sh(r,t,e,s){const i=Ki(r,t,e);let n,o;for(let a=0;a<i.zones[le].groups.length;a++){const{centroid:l}=i.getClosestNode(s,le,a),h=s.distanceTo(l);(n==null||h<n)&&(n=h,o=a)}return o}function Ar(r,t,e,s,i=new x,n){const o=Ki(r,t,e);if(o==null)return!1;const a=o.zones[le];n==null&&(n=Math.floor(a.groups.length*js(s+"groupId")));const l=a.groups[n],h=Math.floor(l.length*js(s));return i.copy(l[h].centroid),!0}function Ki(r,t,e){return r.getCached(`${t}-pathfinding-radius-${e}`,()=>{const s=r.getCached(`${t}-radius-${e}`,o=>Yi(o.map(({raw:a})=>a).filter(Qi),t,e*-2));if(s==null)return;const i=new Hs,n=Hs.createZone(s);return i.setZoneData(le,n),i})}const ue=.1,Zs=1.4,Ah={pedestrian:{url:"models/human",radius:1,speed:3},car:{url:"models/car",speed:18,radius:3},bus:{url:"models/bus",speed:12,radius:5},train:{url:"models/train",speed:18,radius:5},cyclist:{url:"models/cyclist",radius:2,speed:6},camera:{url:void 0,radius:0,speed:10}},Ve=new x;function zr(r,t,e){const s=r*r+t*t+e*e;return s===0?0:Math.sqrt(s)}const zh={follow:{defaultParameters:[],includeThis:!0,includeQueue:!0,execute:(r,t,e,s,i,n,o=0,a=0,l=0)=>{var m,y,b,M;const h=((y=(m=i.list.find(({id:w,value:v})=>w===n&&Me(v.raw)))==null?void 0:m.value)==null?void 0:y.raw)??((b=i.results.find(({id:w,raw:v})=>w===n&&Me(v)))==null?void 0:b.raw),u={type:"precomputedOperation",identifier:"follow",astId:t,parameters:[n,o,a,l]};if(h==null)return r(s,{type:"precomputedOperation",astId:t,identifier:"wait",parameters:[.01]},u);const c=s.keyframes[s.keyframes.length-1].speed,p=s.keyframes.slice(0,-1),f=(M=p[p.length-1])==null?void 0:M.t;for(let w=0;w<h.keyframes.length;w++){const v=h.keyframes[w];f!=null&&v.t<f||(Ve.set(...v.position).add(Vt.set(o,a,l).applyQuaternion(ve.set(...v.rotation))),p.push({astId:t,speed:c,t:v.t+.01,position:Ve.toArray(),rotation:v.rotation}))}return p.length>0&&(s.keyframes=p),s.keyframes[s.keyframes.length-1].t===f?r(s,{type:"precomputedOperation",astId:t,identifier:"wait",parameters:[.01]},u):r(s,u)}},moveTo:{defaultParameters:[],includeThis:!0,includeQueue:!1,execute:(r,t,e,s,i,n,o,a)=>{const{position:l,t:h,speed:u}=s.keyframes[s.keyframes.length-1],[c,p,f]=l,d=a??zr(c-i,p-n,f-o)/u,m=[i,n,o];return s.keyframes.push({position:m,rotation:Cr(l,m,ve).toArray(),t:h+Math.max(.01,d),astId:t,speed:u}),r(s)}},speed:{defaultParameters:[],includeThis:!0,includeQueue:!1,execute:(r,t,e,s,i)=>(s.keyframes[s.keyframes.length-1].speed=i,r(s))},later:{defaultParameters:[],includeQueue:!1,execute:(r,t,e,s,i)=>(s.keyframes[s.keyframes.length-1].t+=i,r(s)),includeThis:!0},clone:{defaultParameters:[],includeQueue:!1,execute:(r,t,e,s,i)=>r(new Array(i).fill(null).map(()=>structuredClone(s))),includeThis:!0},randomPointOn:{defaultParameters:[],execute:(r,t,e,s,i,n)=>{const{position:o,t:a}=s.keyframes[s.keyframes.length-1];return Ar(i,n,s.radius,e+a,Ve,Sh(i,n,s.radius,vt.set(...o)))?r({x:Ve.x,y:Ve.y,z:Ve.z}):r(void 0)},includeQueue:!0,includeThis:!0},pathOnToAndDodge:{defaultParameters:[],execute:(r,t,e,s,i,n,o)=>{const a={type:"precomputedOperation",identifier:"wait",astId:t,parameters:[1]};if(o==null)return r(a);const l=s.keyframes[s.keyframes.length-1];vt.set(...l.position);let h=Sr(i,n,s.radius,l,o.x,o.y,o.z);return h=h==null?void 0:h.filter((u,c)=>u.distanceTo(c===0?vt:h[c-1])>.01),h!=null&&h.length>0?r(s,...h.map(({x:u,y:c,z:p})=>({type:"precomputedOperation",identifier:"moveOnToAndDodge",parameters:[n,u,c,p],astId:t}))):r(s,a)},includeQueue:!0,includeThis:!0},target:{defaultParameters:[],execute:(r,t,e,s=0,i=0,n=0)=>r({x:s,y:i,z:n}),includeQueue:!1,includeThis:!1},pathOnTo:{defaultParameters:[],execute:(r,t,e,s,i,n,o)=>{const a={type:"precomputedOperation",identifier:"wait",astId:t,parameters:[1]};if(o==null)return r(s,a);const l=s.keyframes[s.keyframes.length-1];vt.set(...l.position);let h=Sr(i,n,s.radius,l,o.x,o.y,o.z);return h=h==null?void 0:h.filter((u,c)=>u.distanceTo(c===0?vt:h[c-1])>.01),h!=null&&h.length>0?r(s,...h.map(({x:u,y:c,z:p})=>({type:"precomputedOperation",identifier:"moveTo",parameters:[u,c,p],astId:t}))):r(s,a)},includeQueue:!0,includeThis:!0},spawnOn:{defaultParameters:[],execute:(r,t,e,s,i,n="street",o=1)=>{const a=i.list.map(({value:{raw:c}})=>c).concat(i.results.map(({raw:c})=>c)),l=s.keyframes[s.keyframes.length-1];let h=0;const u=[];t:for(let c=0;c<o;c++){do{if(h>1e4||!Ar(i,n,s.radius,e+l.t+h,vt))break t;h++}while(Bh(vt,s.radius,u)||Eh(vt,s,a,l.t));u.push(vt.toArray())}return r(u.map(c=>({keyframes:[{position:c,rotation:Er,astId:t,t:l.t,speed:l.speed}],type:s.type,radius:s.radius,url:s.url,id:""})))},includeQueue:!0,includeThis:!0},wait:{defaultParameters:[],includeQueue:!1,execute:(r,t,e,s,i)=>{const{position:n,rotation:o,t:a,speed:l}=s.keyframes[s.keyframes.length-1];return s.keyframes.push({astId:t,position:n,rotation:o,t:a+i,speed:l}),r(s)},includeThis:!0},moveBy:{defaultParameters:[],includeThis:!0,includeQueue:!1,execute:(r,t,e,s,i,n,o)=>{const{position:a,t:l,speed:h}=s.keyframes[s.keyframes.length-1],u=zr(i,n,o)/h,c=[a[0]+i,a[1]+n,a[2]+o];return s.keyframes.push({position:c,rotation:Cr(a,c,ve).toArray(),t:l+u,astId:t,speed:h}),r(s)}},moveOnToAndDodge:{defaultParameters:[],includeThis:!0,includeQueue:!0,execute:(r,t,e,s,i,n,o,a,l)=>{const h={type:"precomputedOperation",identifier:"moveOnToAndDodge",parameters:[n,o,a,l],astId:t},u=s.keyframes[s.keyframes.length-1],{position:c,rotation:p,speed:f,t:d}=u;Vt.set(o-c[0],a-c[1],l-c[2]);const m=Vt.length(),y=Math.min(ue*f,m);m===0?Vt.set(0,0,0):Vt.multiplyScalar(y/m);const b=d+Math.max(.01,y/f),M=i.list.map(({value:{raw:$}})=>$).concat(i.results.map(({raw:$})=>$));ce.set(...c),kt.set(...p);const w=Br(s,M,ce,b);let v=!1,z=!1;if(w!=null&&w.distance<s.radius*1){if(_r.copy(Xs).applyQuaternion(kt).angleTo(w.directionVector)<Vr(45)||w.distance<=0){const L=_r.set(1,0,0).applyQuaternion(kt).dot(w.directionVector)>=0;kt.multiply(L?_h:Tr),z=!0}Vt.set(0,0,1).multiplyScalar(y).applyQuaternion(kt),ce.add(Vt);const Z=Br(s,M,ce,b);Z!=null&&Z.distance<=0?ce.set(...c):v=!0}else{ve.setFromUnitVectors(Xs,vt.copy(Vt).normalize());const $=ve.angleTo(kt);$>=Zs*ue?(z=!0,kt.rotateTowards(ve,Zs*ue)):kt.copy(ve),$>=Zs*ue?Vt.copy(Xs).multiplyScalar(ue*f*.3).applyQuaternion(kt):v=!0,ce.add(Vt)}const F=ce.toArray(),T=kt.toArray();return z||!v?s.keyframes.push({position:F,rotation:T,t:b,astId:t,speed:f}):(ce.toArray(c),kt.toArray(p),u.t=b),Math.abs(m-y)<s.radius?r(s):r(s,h)}}},Th=new x(0,1,0),Tr=new zt().setFromAxisAngle(Th,Zs*ue),_h=Tr.clone().invert(),ce=new x,kt=new zt,Vt=new x,_r=new x,qe=new x;function Br(r,t,e,s){let i;for(const n of t){if(n==r||!Me(n)||n.type==="camera")continue;const o=pr(n.keyframes,s,ue+.001);if(o==null)continue;fr(n.keyframes,s,o,qe),qe.sub(e);let a=qe.length();if(qe.divideScalar(a),a=Math.max(0,a-r.radius-n.radius),i==null){i={entity:n,distance:a,directionVector:qe.clone()};continue}a<i.distance&&(i.distance=a,i.directionVector.copy(qe),i.entity=n)}return i}const Er=[0,0,0,1],vt=new x,pe=new x,ve=new zt,Xs=new x(0,0,1);function Cr(r,t,e=new zt){return Array.isArray(r)?vt.set(...r):vt.copy(r),Array.isArray(t)?pe.set(...t):pe.copy(t),pe.sub(vt),pe.normalize(),e.setFromUnitVectors(Xs,pe),e}function Bh(r,t,e){const s=t*2;for(const i of e)if(pe.set(...i).distanceTo(r)<s)return!0;return!1}function Eh(r,t,e,s){for(const i of e){if(i===t||!Me(i))continue;const n=pr(i.keyframes,s,ue+.001);if(n!=null&&(fr(i.keyframes,s,n,pe),pe.distanceTo(r)<t.radius+i.radius))return!0}return!1}function Ch({type:r,x:t,y:e,z:s,time:i},n){const o=Ah[r??"pedestrian"];if(o==null)throw new Error(`unknown type "${r}"`);return{keyframes:[{position:[t??0,e??0,s??0],t:i??0,rotation:Er,astId:n,speed:o.speed}],radius:o.radius,url:o.url,type:r,id:""}}function Me(r){return typeof r=="object"&&r!=null&&"keyframes"in r}new La,Gr({cloneValue(r){return r instanceof Le?r.clone():structuredClone(r)},compareProgress(r,t){return t-r},computeProgress(r){return Me(r)?r.keyframes[r.keyframes.length-1].t:-1},computeDurationMS:1e3,createValue(r,t){switch(r.type??"pedestrian"){case"building":return new $e(be(r.x??0,r.y??0,r.z??0,new K));case"footwalk":case"street":return{points:[{x:r.x??0,y:r.y??0,size:r.size??0,astId:t}],type:r.type};default:return Ch(r,t)}},operations:{...uh,...zh,...vh},shouldInterrrupt(r,t){return t-r>3},serialize(r,t,e){var i,n,o;const s=[];for(const a of r.list)Me(a.value.raw)&&(a.value.raw.id=a.id,s.push(a.value.raw));for(const a of r.results)Me(a.raw)&&(a.raw.id=a.id,s.push(a.raw));return{building:(i=r.getCached("building",a=>ph(a.map(({raw:l})=>l).filter(ch))))==null?void 0:i.toJSON(),street:(n=r.getCached("street",a=>Yi(a.map(({raw:l})=>l).filter(Qi),"street")))==null?void 0:n.toJSON(),footwalk:(o=r.getCached("footwalk",a=>Yi(a.map(({raw:l})=>l).filter(Qi),"footwalk")))==null?void 0:o.toJSON(),agents:s}}})})();
